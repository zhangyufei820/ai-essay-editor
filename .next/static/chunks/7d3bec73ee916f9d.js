(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90768,e=>{"use strict";let s=(0,e.i(10965).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],90768)},35301,e=>{"use strict";let s=(0,e.i(10965).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>s],35301)},62412,e=>{"use strict";let s=(0,e.i(10965).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>s],62412)},86591,e=>{"use strict";let s=(0,e.i(10965).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],86591)},95751,e=>{"use strict";let s=(0,e.i(10965).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>s],95751)},83272,e=>{"use strict";let s=(0,e.i(10965).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>s],83272)},13083,e=>{"use strict";var s=e.i(62893),t=e.i(58846),a=e.i(83272),l=e.i(62412),r=e.i(90768),i=e.i(86591),c=e.i(35301),o=e.i(95751),d=e.i(60791);function n(){let[n,m]=(0,t.useState)("idle"),[h,x]=(0,t.useState)(""),[u,p]=(0,t.useState)([]),[b,g]=(0,t.useState)(""),f=(0,t.useRef)(null),j=(0,t.useRef)(null),v=()=>{j.current?.scrollIntoView({behavior:"smooth"})},N=async s=>{try{let{supabase:t}=await e.A(3204);if(!t)return void console.warn("[v0] Supabase not configured, skipping save");let{error:a}=await t.from("submissions").insert({original_text:`File: ${b}`,ai_result:s,status:"completed"});a?(console.error("[v0] Error saving to Supabase:",a),y("保存失败: "+a.message,"error")):y("已保存到数据库","success")}catch(e){console.error("[v0] Error in saveToSupabase:",e)}},y=(e,s="info")=>{let t=new Date().toLocaleTimeString("zh-CN"),a="success"===s?"✓":"error"===s?"✗":"➜";p(s=>[...s,`${a} [${t}] ${e}`]),setTimeout(v,100)},w=async e=>{g(e.name),m("uploading"),x(""),p([]),y(`开始上传文件: ${e.name}`);try{let s=new FormData;s.append("file",e),y("文件上传完成","success"),m("processing"),y("正在连接AI批改引擎...");let t=await fetch("/api/analyze",{method:"POST",body:s});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let a=t.body?.getReader(),l=new TextDecoder;if(!a)throw Error("No response body");y("开始接收批改结果...","success");let r="";for(;;){let{done:e,value:s}=await a.read();if(e)break;for(let e of l.decode(s,{stream:!0}).split("\n").filter(e=>e.trim()))if(e.startsWith("data: "))try{let s=JSON.parse(e.slice(6));if("text_chunk"===s.event){let e=s.data?.text||"";e&&(r+=e,x(r),y(`收到批改内容 (${r.length} 字符)`))}else if("workflow_finished"===s.event)y("批改完成","success"),m("completed"),await N(r);else if("error"===s.event)throw y(`错误: ${s.message}`,"error"),Error(s.message)}catch(e){console.error("[v0] Error parsing chunk:",e)}}"completed"!==n&&(m("completed"),y("所有任务已完成","success"))}catch(e){console.error("[v0] Error in handleFileUpload:",e),y(`错误: ${e instanceof Error?e.message:"未知错误"}`,"error"),m("idle")}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-50 p-4 sm:p-8",children:(0,s.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,s.jsxs)("div",{className:"mb-8 text-center",children:[(0,s.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-800 mb-2",children:"AI 作文智能批改"}),(0,s.jsx)("p",{className:"text-slate-600",children:"上传作文图片或文档，获取专业的AI批改建议"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-8 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-6",children:[(0,s.jsx)("input",{ref:f,type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:e=>{let s=e.target.files?.[0];s&&w(s)},className:"hidden"}),(0,s.jsx)("div",{onClick:"idle"===n?()=>{f.current?.click()}:void 0,className:`
                  border-2 border-dashed rounded-xl p-12 text-center
                  transition-all duration-200
                  ${"idle"===n?"border-blue-300 bg-blue-50/50 hover:border-blue-400 hover:bg-blue-50 cursor-pointer":"border-slate-300 bg-slate-50 cursor-not-allowed"}
                `,children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:["processing"===n?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(r.Loader2,{className:"w-16 h-16 text-blue-600 animate-spin"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-blue-500/20 rounded-full animate-ping"})]}):"completed"===n?(0,s.jsx)(c.CheckCircle2,{className:"w-16 h-16 text-emerald-600"}):(0,s.jsx)(a.Upload,{className:"w-16 h-16 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-lg font-semibold text-slate-800 mb-1",children:["idle"===n&&"点击上传作文文件","uploading"===n&&"正在上传文件...","processing"===n&&"AI批改进行中...","completed"===n&&"批改完成！"]}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:b||"支持 JPG、PNG、PDF、Word 格式"})]}),"idle"===n&&(0,s.jsx)("button",{className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-sm",children:"选择文件"})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-slate-200",children:[(0,s.jsx)(l.FileText,{className:"w-5 h-5 text-blue-600"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"批改结果"})]}),(0,s.jsx)("div",{className:"max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-slate-100",children:h?(0,s.jsx)("div",{className:"prose prose-slate max-w-none",children:(0,s.jsx)(d.default,{children:h})}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px] text-slate-400",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(l.FileText,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"processing"===n?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["等待AI批改结果",(0,s.jsxs)("span",{className:"inline-flex gap-1",children:[(0,s.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,s.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,s.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}):"上传文件后，批改结果将显示在此处"})]})})})]})]}),(0,s.jsx)("div",{className:"lg:col-span-4",children:(0,s.jsxs)("div",{className:"bg-slate-900 rounded-xl border-2 border-slate-700 shadow-lg p-6 h-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-slate-700",children:[(0,s.jsx)(i.Clock,{className:"w-5 h-5 text-emerald-400"}),(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"系统日志"})]}),(0,s.jsxs)("div",{className:"h-[calc(100vh-280px)] min-h-[400px] overflow-y-auto font-mono text-xs space-y-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-800",children:[0===u.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,s.jsx)("p",{className:"text-slate-500 text-center",children:"等待操作..."})}):(0,s.jsxs)(s.Fragment,{children:[u.map((e,t)=>{let a=e.startsWith("✓"),l=e.startsWith("✗");return(0,s.jsxs)("div",{className:`flex items-start gap-2 ${a?"text-emerald-400":l?"text-red-400":"text-slate-300"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:[(0,s.jsx)(o.ArrowRight,{className:"w-3 h-3 mt-0.5 shrink-0"}),(0,s.jsx)("span",{className:"break-all",children:e})]},t)}),(0,s.jsx)("div",{ref:j})]}),"completed"===n&&(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-2 p-3 bg-emerald-900/30 border border-emerald-700 rounded-lg",children:[(0,s.jsx)(c.CheckCircle2,{className:"w-5 h-5 text-emerald-400 shrink-0"}),(0,s.jsx)("span",{className:"text-sm font-medium text-emerald-300",children:"所有任务已完成"})]}),"processing"===n&&(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-700 rounded-lg",children:[(0,s.jsx)(r.Loader2,{className:"w-5 h-5 text-blue-400 animate-spin shrink-0"}),(0,s.jsx)("span",{className:"text-sm font-medium text-blue-300",children:"正在处理中..."})]})]})]})})]})]})})}e.s(["default",()=>n])},3204,e=>{e.v(s=>Promise.all(["static/chunks/4543f082c3ad7926.js"].map(s=>e.l(s))).then(()=>s(17927)))}]);