module.exports=[69964,a=>{"use strict";let b=(0,a.i(61237).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);a.s(["CheckCircle2",()=>b],69964)},70854,a=>{"use strict";let b=(0,a.i(61237).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);a.s(["FileText",()=>b],70854)},76929,a=>{"use strict";let b=(0,a.i(61237).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],76929)},6966,a=>{"use strict";let b=(0,a.i(61237).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);a.s(["ArrowRight",()=>b],6966)},84435,a=>{"use strict";let b=(0,a.i(61237).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],84435)},97568,a=>{"use strict";let b=(0,a.i(61237).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a.s(["Upload",()=>b],97568)},59957,a=>{"use strict";var b=a.i(8398),c=a.i(11523),d=a.i(97568),e=a.i(70854),f=a.i(84435),g=a.i(76929),h=a.i(69964),i=a.i(6966),j=a.i(52400);function k(){let[k,l]=(0,c.useState)("idle"),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(""),s=(0,c.useRef)(null),t=(0,c.useRef)(null),u=()=>{t.current?.scrollIntoView({behavior:"smooth"})},v=async b=>{try{let{supabase:c}=await a.A(98511);if(!c)return void console.warn("[v0] Supabase not configured, skipping save");let{error:d}=await c.from("submissions").insert({original_text:`File: ${q}`,ai_result:b,status:"completed"});d?(console.error("[v0] Error saving to Supabase:",d),w("保存失败: "+d.message,"error")):w("已保存到数据库","success")}catch(a){console.error("[v0] Error in saveToSupabase:",a)}},w=(a,b="info")=>{let c=new Date().toLocaleTimeString("zh-CN"),d="success"===b?"✓":"error"===b?"✗":"➜";p(b=>[...b,`${d} [${c}] ${a}`]),setTimeout(u,100)},x=async a=>{r(a.name),l("uploading"),n(""),p([]),w(`开始上传文件: ${a.name}`);try{let b=new FormData;b.append("file",a),w("文件上传完成","success"),l("processing"),w("正在连接AI批改引擎...");let c=await fetch("/api/analyze",{method:"POST",body:b});if(!c.ok)throw Error(`HTTP error! status: ${c.status}`);let d=c.body?.getReader(),e=new TextDecoder;if(!d)throw Error("No response body");w("开始接收批改结果...","success");let f="";for(;;){let{done:a,value:b}=await d.read();if(a)break;for(let a of e.decode(b,{stream:!0}).split("\n").filter(a=>a.trim()))if(a.startsWith("data: "))try{let b=JSON.parse(a.slice(6));if("text_chunk"===b.event){let a=b.data?.text||"";a&&(f+=a,n(f),w(`收到批改内容 (${f.length} 字符)`))}else if("workflow_finished"===b.event)w("批改完成","success"),l("completed"),await v(f);else if("error"===b.event)throw w(`错误: ${b.message}`,"error"),Error(b.message)}catch(a){console.error("[v0] Error parsing chunk:",a)}}"completed"!==k&&(l("completed"),w("所有任务已完成","success"))}catch(a){console.error("[v0] Error in handleFileUpload:",a),w(`错误: ${a instanceof Error?a.message:"未知错误"}`,"error"),l("idle")}};return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-50 p-4 sm:p-8",children:(0,b.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8 text-center",children:[(0,b.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-800 mb-2",children:"AI 作文智能批改"}),(0,b.jsx)("p",{className:"text-slate-600",children:"上传作文图片或文档，获取专业的AI批改建议"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-8 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-6",children:[(0,b.jsx)("input",{ref:s,type:"file",accept:"image/*,.pdf,.doc,.docx",onChange:a=>{let b=a.target.files?.[0];b&&x(b)},className:"hidden"}),(0,b.jsx)("div",{onClick:"idle"===k?()=>{s.current?.click()}:void 0,className:`
                  border-2 border-dashed rounded-xl p-12 text-center
                  transition-all duration-200
                  ${"idle"===k?"border-blue-300 bg-blue-50/50 hover:border-blue-400 hover:bg-blue-50 cursor-pointer":"border-slate-300 bg-slate-50 cursor-not-allowed"}
                `,children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:["processing"===k?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.Loader2,{className:"w-16 h-16 text-blue-600 animate-spin"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-blue-500/20 rounded-full animate-ping"})]}):"completed"===k?(0,b.jsx)(h.CheckCircle2,{className:"w-16 h-16 text-emerald-600"}):(0,b.jsx)(d.Upload,{className:"w-16 h-16 text-blue-600"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-lg font-semibold text-slate-800 mb-1",children:["idle"===k&&"点击上传作文文件","uploading"===k&&"正在上传文件...","processing"===k&&"AI批改进行中...","completed"===k&&"批改完成！"]}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:q||"支持 JPG、PNG、PDF、Word 格式"})]}),"idle"===k&&(0,b.jsx)("button",{className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors shadow-sm",children:"选择文件"})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border-2 border-slate-200 shadow-lg p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-slate-200",children:[(0,b.jsx)(e.FileText,{className:"w-5 h-5 text-blue-600"}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-800",children:"批改结果"})]}),(0,b.jsx)("div",{className:"max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-slate-100",children:m?(0,b.jsx)("div",{className:"prose prose-slate max-w-none",children:(0,b.jsx)(j.default,{children:m})}):(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px] text-slate-400",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(e.FileText,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"processing"===k?(0,b.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["等待AI批改结果",(0,b.jsxs)("span",{className:"inline-flex gap-1",children:[(0,b.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,b.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,b.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}):"上传文件后，批改结果将显示在此处"})]})})})]})]}),(0,b.jsx)("div",{className:"lg:col-span-4",children:(0,b.jsxs)("div",{className:"bg-slate-900 rounded-xl border-2 border-slate-700 shadow-lg p-6 h-full",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4 pb-4 border-b border-slate-700",children:[(0,b.jsx)(g.Clock,{className:"w-5 h-5 text-emerald-400"}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-white",children:"系统日志"})]}),(0,b.jsxs)("div",{className:"h-[calc(100vh-280px)] min-h-[400px] overflow-y-auto font-mono text-xs space-y-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-800",children:[0===o.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,b.jsx)("p",{className:"text-slate-500 text-center",children:"等待操作..."})}):(0,b.jsxs)(b.Fragment,{children:[o.map((a,c)=>{let d=a.startsWith("✓"),e=a.startsWith("✗");return(0,b.jsxs)("div",{className:`flex items-start gap-2 ${d?"text-emerald-400":e?"text-red-400":"text-slate-300"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:[(0,b.jsx)(i.ArrowRight,{className:"w-3 h-3 mt-0.5 shrink-0"}),(0,b.jsx)("span",{className:"break-all",children:a})]},c)}),(0,b.jsx)("div",{ref:t})]}),"completed"===k&&(0,b.jsxs)("div",{className:"mt-4 flex items-center gap-2 p-3 bg-emerald-900/30 border border-emerald-700 rounded-lg",children:[(0,b.jsx)(h.CheckCircle2,{className:"w-5 h-5 text-emerald-400 shrink-0"}),(0,b.jsx)("span",{className:"text-sm font-medium text-emerald-300",children:"所有任务已完成"})]}),"processing"===k&&(0,b.jsxs)("div",{className:"mt-4 flex items-center gap-2 p-3 bg-blue-900/30 border border-blue-700 rounded-lg",children:[(0,b.jsx)(f.Loader2,{className:"w-5 h-5 text-blue-400 animate-spin shrink-0"}),(0,b.jsx)("span",{className:"text-sm font-medium text-blue-300",children:"正在处理中..."})]})]})]})})]})]})})}a.s(["default",()=>k])},98511,a=>{a.v(b=>Promise.all(["server/chunks/ssr/lib_supabase_ts_2a54012c._.js","server/chunks/ssr/_fb6c389e._.js"].map(b=>a.l(b))).then(()=>b(78560)))}];

//# sourceMappingURL=_2be0fa33._.js.map