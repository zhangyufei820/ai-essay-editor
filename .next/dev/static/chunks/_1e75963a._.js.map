{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/ui/textarea.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAyC;IACzE,qBACE,sYAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,ucACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS","debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/ModelSelector.tsx"],"sourcesContent":["/**\n * ğŸ¯ æ²ˆç¿”æ™ºå­¦ - æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶ (Model Selector)\n * \n * é‡æ–°è®¾è®¡çš„AIæ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå•ï¼ŒåŒ…å«æµç•…åŠ¨ç”»å’Œç»Ÿä¸€è§†è§‰é£æ ¼\n */\n\n\"use client\"\n\nimport { useState, useRef, useEffect } from \"react\"\nimport { Check, ChevronDown } from \"lucide-react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\n// ============================================\n// è®¾è®¡ç³»ç»Ÿé¢œè‰²å¸¸é‡\n// ============================================\n\nconst COLORS = {\n  primary: {\n    main: \"#4CAF50\",\n    dark: \"#2E7D32\",\n    light: \"#E8F5E9\",\n    hover: \"rgba(76, 175, 80, 0.08)\",\n  },\n  gray: {\n    50: \"#FAFAFA\",\n    100: \"#F5F5F5\",\n    200: \"#EEEEEE\",\n    300: \"#E0E0E0\",\n    400: \"#BDBDBD\",\n    500: \"#9E9E9E\",\n    600: \"#757575\",\n    700: \"#616161\",\n    800: \"#424242\",\n    900: \"#212121\",\n  },\n  badges: {\n    recommended: { bg: \"#E8F5E9\", text: \"#2E7D32\" },\n    new: { bg: \"#E3F2FD\", text: \"#1976D2\" },\n    hot: { bg: \"#FFF3E0\", text: \"#F57C00\" },\n    pro: { bg: \"#F3E5F5\", text: \"#7B1FA2\" },\n  }\n}\n\n// ============================================\n// ç±»å‹å®šä¹‰\n// ============================================\n\ninterface Model {\n  key: string\n  name: string\n  icon: React.ComponentType<{ className?: string; style?: React.CSSProperties }>\n  color: string\n  description?: string\n  badge?: string\n  group?: string\n}\n\ninterface ModelSelectorProps {\n  selectedModel: string\n  onModelChange: (model: string) => void\n  models: Model[]\n  disabled?: boolean\n  className?: string\n  dailyFreeInfo?: {\n    used: number\n    total: number\n  }\n}\n\n// ============================================\n// Badge ç»„ä»¶\n// ============================================\n\nfunction ModelBadge({ text }: { text: string }) {\n  const getBadgeStyle = (badgeText: string) => {\n    switch (badgeText) {\n      case \"æ¨è\":\n        return { backgroundColor: COLORS.badges.recommended.bg, color: COLORS.badges.recommended.text }\n      case \"æ–°\":\n        return { backgroundColor: COLORS.badges.new.bg, color: COLORS.badges.new.text }\n      case \"çƒ­é—¨\":\n        return { backgroundColor: COLORS.badges.hot.bg, color: COLORS.badges.hot.text }\n      case \"Pro\":\n        return { backgroundColor: COLORS.badges.pro.bg, color: COLORS.badges.pro.text }\n      default:\n        return { backgroundColor: COLORS.gray[100], color: COLORS.gray[600] }\n    }\n  }\n\n  const style = getBadgeStyle(text)\n\n  return (\n    <span \n      className=\"px-2 py-0.5 text-[10px] font-medium rounded-full\"\n      style={style}\n    >\n      {text}\n    </span>\n  )\n}\n\n// ============================================\n// æ¨¡å‹é€‰æ‹©å™¨ä¸»ç»„ä»¶\n// ============================================\n\nexport function ModelSelector({\n  selectedModel,\n  onModelChange,\n  models,\n  disabled,\n  className,\n  dailyFreeInfo\n}: ModelSelectorProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const currentModel = models.find(m => m.key === selectedModel)\n\n  // ç‚¹å‡»å¤–éƒ¨å…³é—­\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false)\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside)\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside)\n  }, [])\n\n  // æŒ‰åˆ†ç»„ç»„ç»‡æ¨¡å‹\n  const groupedModels = models.reduce((acc, model) => {\n    const group = model.group || \"é»˜è®¤\"\n    if (!acc[group]) acc[group] = []\n    acc[group].push(model)\n    return acc\n  }, {} as Record<string, Model[]>)\n\n  const groups = Object.keys(groupedModels)\n\n  const handleSelect = (modelKey: string) => {\n    onModelChange(modelKey)\n    setIsOpen(false)\n  }\n\n  return (\n    <div ref={containerRef} className={cn(\"relative\", className)}>\n      {/* è§¦å‘æŒ‰é’® */}\n      <motion.button\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n        disabled={disabled}\n        className={cn(\n          \"flex items-center gap-2 px-3 py-1.5 rounded-lg\",\n          \"text-sm hover:bg-[#F5F5F5]\",\n          \"transition-all duration-150 ease-out\",\n          \"disabled:opacity-50 disabled:cursor-not-allowed\",\n          \"focus:outline-none\"\n        )}\n        style={{ color: COLORS.gray[700] }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {/* é¢œè‰²æŒ‡ç¤ºç‚¹ */}\n        <span\n          className=\"w-2 h-2 rounded-full shrink-0\"\n          style={{ backgroundColor: currentModel?.color }}\n        />\n        \n        {/* æ¨¡å‹åç§° */}\n        <span className=\"font-medium\">{currentModel?.name || \"é€‰æ‹©æ¨¡å‹\"}</span>\n        \n        {/* ä¸‹æ‹‰ç®­å¤´ */}\n        <motion.div\n          animate={{ rotate: isOpen ? 180 : 0 }}\n          transition={{ duration: 0.2, ease: \"easeOut\" }}\n        >\n          <ChevronDown className=\"w-3.5 h-3.5 opacity-50\" />\n        </motion.div>\n      </motion.button>\n\n      {/* å‘ä¸Šå¼¹å‡ºèœå• */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 8, scale: 0.96 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 8, scale: 0.96 }}\n            transition={{ duration: 0.2, ease: \"easeOut\" }}\n            className=\"absolute bottom-full left-0 mb-2 z-50\"\n            style={{\n              width: \"360px\",\n              maxHeight: \"480px\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 -8px 24px rgba(0,0,0,0.12)\",\n              backgroundColor: \"#FFFFFF\",\n              border: `1px solid ${COLORS.gray[200]}`,\n              overflow: \"hidden\",\n            }}\n          >\n            {/* æ ‡é¢˜å’Œå…è´¹é¢åº¦ä¿¡æ¯ */}\n            <div \n              className=\"flex items-center justify-between px-4 py-3\"\n              style={{ borderBottom: `1px solid ${COLORS.gray[200]}` }}\n            >\n              <span \n                className=\"text-xs font-medium\"\n                style={{ color: COLORS.gray[600] }}\n              >\n                é€‰æ‹©æ¨¡å‹\n              </span>\n              {dailyFreeInfo && (\n                <span \n                  className=\"text-[10px]\"\n                  style={{ color: COLORS.gray[500] }}\n                >\n                  ä»Šæ—¥å…è´¹: {dailyFreeInfo.total - dailyFreeInfo.used}/{dailyFreeInfo.total}\n                </span>\n              )}\n            </div>\n\n            {/* å¯æ»šåŠ¨çš„æ¨¡å‹åˆ—è¡¨ */}\n            <div \n              className=\"overflow-y-auto p-4 custom-scrollbar\"\n              style={{\n                maxHeight: \"420px\",\n              }}\n            >\n\n              {groups.map((group, groupIndex) => (\n                <div key={group}>\n                  {/* åˆ†ç»„æ ‡é¢˜ */}\n                  {group !== \"é»˜è®¤\" && (\n                    <div \n                      className=\"flex items-center gap-2 mb-2\"\n                      style={{ \n                        marginTop: groupIndex > 0 ? \"16px\" : \"0\",\n                      }}\n                    >\n                      {/* å·¦ä¾§å“ç‰Œè‰²æ¡ */}\n                      <div \n                        className=\"w-0.5 h-4 rounded-full\"\n                        style={{ backgroundColor: COLORS.primary.main }}\n                      />\n                      <span \n                        className=\"text-xs font-semibold uppercase\"\n                        style={{ \n                          color: COLORS.gray[600],\n                          letterSpacing: \"0.5px\",\n                        }}\n                      >\n                        {group}\n                      </span>\n                    </div>\n                  )}\n\n                  {/* æ¨¡å‹åˆ—è¡¨ */}\n                  <div className=\"space-y-1\">\n                    {groupedModels[group].map((model) => (\n                      <ModelMenuItem\n                        key={model.key}\n                        model={model}\n                        isSelected={selectedModel === model.key}\n                        onClick={() => handleSelect(model.key)}\n                      />\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\n// ============================================\n// æ¨¡å‹èœå•é¡¹ç»„ä»¶\n// ============================================\n\nfunction ModelMenuItem({\n  model,\n  isSelected,\n  onClick\n}: {\n  model: Model\n  isSelected: boolean\n  onClick: () => void\n}) {\n  const Icon = model.icon\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 rounded-lg cursor-pointer\",\n        \"transition-all duration-150 ease-out\",\n        \"focus:outline-none\"\n      )}\n      style={{\n        height: \"56px\",\n        padding: \"12px 16px\",\n        backgroundColor: isSelected ? COLORS.primary.hover : \"transparent\",\n      }}\n      whileHover={{ \n        backgroundColor: isSelected ? COLORS.primary.hover : COLORS.gray[100],\n      }}\n      whileTap={{ scale: 0.98 }}\n    >\n      {/* æ¨¡å‹å›¾æ ‡ */}\n      <div \n        className=\"flex h-8 w-8 items-center justify-center rounded-lg shrink-0\"\n        style={{ backgroundColor: `${model.color}15` }}\n      >\n        <Icon \n          className=\"h-4 w-4\" \n          style={{ color: model.color }}\n        />\n      </div>\n\n      {/* æ¨¡å‹ä¿¡æ¯ */}\n      <div className=\"flex-1 min-w-0 text-left\">\n        <div className=\"flex items-center gap-2\">\n          <span \n            className=\"text-sm\"\n            style={{ \n              fontWeight: 500,\n              color: COLORS.gray[900],\n            }}\n          >\n            {model.name}\n          </span>\n          {model.badge && <ModelBadge text={model.badge} />}\n        </div>\n        {model.description && (\n          <p \n            className=\"text-xs truncate mt-0.5\"\n            style={{ \n              fontWeight: 400,\n              color: COLORS.gray[600],\n            }}\n          >\n            {model.description}\n          </p>\n        )}\n      </div>\n\n      {/* é€‰ä¸­å›¾æ ‡ */}\n      {isSelected && (\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ duration: 0.15, ease: \"easeOut\" }}\n        >\n          <Check \n            className=\"w-5 h-5 shrink-0\" \n            style={{ color: COLORS.primary.main }}\n          />\n        </motion.div>\n      )}\n    </motion.button>\n  )\n}\n\nexport default ModelSelector\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 530, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/workflow-visual-config.ts"],"sourcesContent":["/**\n * ğŸ¯ ä½œæ–‡æ‰¹æ”¹æ™ºèƒ½ä½“ - Dify Workflow å¯è§†åŒ–é…ç½®\n * \n * å°† Dify åŸå§‹èŠ‚ç‚¹åç§°æ˜ å°„ä¸ºæ•™å­¦é¢†åŸŸä¸“ä¸šæœ¯è¯­\n * è¿™æ˜¯ UI çš„å”¯ä¸€çœŸç†æ¥æº (Single Source of Truth)\n * \n * âš ï¸ ä¸¥ç¦åœ¨æ­¤æ–‡ä»¶æˆ– UI ä¸­å‡ºç°ä»»ä½•åº•å±‚æ¨¡å‹åç§°ï¼ˆå¦‚ Qwenã€Claude ç­‰ï¼‰\n * \n * ğŸ”¥ å…³é”®è®¾è®¡ï¼š\n * - \"æ€»ç¼–è¾‘\"èŠ‚ç‚¹æ˜¯ TRIGGER èŠ‚ç‚¹ï¼Œæ ‡å¿—ç€æ¨ç†é˜¶æ®µç»“æŸã€ç”Ÿæˆé˜¶æ®µå¼€å§‹\n * - å½“æ£€æµ‹åˆ°\"æ€»ç¼–è¾‘\"å¯åŠ¨æ—¶ï¼Œå¿…é¡»å¼ºåˆ¶ç»“æŸæ‰€æœ‰æ€è€ƒåŠ¨ç”»\n */\n\nimport { \n  Scan, Eye, Filter, FileText, Layers, Cog, Brain, Sparkles, CheckCircle,\n  type LucideIcon \n} from \"lucide-react\"\n\n// ============================================\n// ç±»å‹å®šä¹‰\n// ============================================\n\nexport type WorkflowNodeStatus = \"pending\" | \"preparing\" | \"running\" | \"completed\" | \"error\"\n\n/** èŠ‚ç‚¹ç±»å‹ï¼šæ€è€ƒèŠ‚ç‚¹ vs è§¦å‘èŠ‚ç‚¹ */\nexport type NodeType = \"thinking\" | \"trigger\"\n\nexport interface WorkflowNodeConfig {\n  /** Dify åŸå§‹èŠ‚ç‚¹åç§° */\n  originalName: string\n  /** UI æ˜¾ç¤ºçš„ä¸“ä¸šæœ¯è¯­åç§° */\n  displayName: string\n  /** è‹±æ–‡å‰¯æ ‡é¢˜ */\n  englishName: string\n  /** è¿è¡Œä¸­çš„å¾®äº¤äº’æ–‡æ¡ˆæ•°ç»„ï¼ˆè½®æ’­æ˜¾ç¤ºï¼‰ */\n  runningTexts: string[]\n  /** å›¾æ ‡ç»„ä»¶ */\n  icon: LucideIcon\n  /** èŠ‚ç‚¹æ‰€å±è·¯å¾„åˆ†ç»„ */\n  group: \"input\" | \"vision\" | \"document\" | \"core\"\n  /** æ˜¯å¦ä¸ºæ ¸å¿ƒé«˜äº®èŠ‚ç‚¹ */\n  isHighlight?: boolean\n  /** é¢„ä¼°è€—æ—¶ï¼ˆç§’ï¼‰ï¼Œç”¨äºè¿›åº¦æ¡æ¨¡æ‹Ÿ */\n  estimatedDuration?: number\n  /** èŠ‚ç‚¹ç±»å‹ï¼šthinking=æ˜¾ç¤ºåœ¨æ€è€ƒå®¹å™¨ä¸­ï¼Œtrigger=è§¦å‘ç”Ÿæˆé˜¶æ®µ */\n  nodeType: NodeType\n}\n\nexport interface WorkflowState {\n  nodes: WorkflowNodeState[]\n  currentNodeIndex: number\n  isExpanded: boolean\n  startTime?: number\n  /** ğŸ”¥ æ˜¯å¦å¤„äºæ€è€ƒé˜¶æ®µ */\n  isThinking: boolean\n  /** ğŸ”¥ æ˜¯å¦å·²è§¦å‘ç”Ÿæˆé˜¶æ®µ */\n  isGenerating: boolean\n}\n\nexport interface WorkflowNodeState {\n  id: string\n  config: WorkflowNodeConfig\n  status: WorkflowNodeStatus\n  startTime?: number\n  endTime?: number\n  currentTextIndex: number\n  /** å½“å‰æ˜¾ç¤ºçš„ä¼ªæ—¥å¿— */\n  currentFakeLog?: string\n}\n\n// ============================================\n// ğŸ”¥ è§¦å‘èŠ‚ç‚¹åˆ—è¡¨ - è¿™äº›èŠ‚ç‚¹æ ‡å¿—ç€ç”Ÿæˆé˜¶æ®µå¼€å§‹\n// ============================================\n\nexport const TRIGGER_NODES = new Set([\n  \"æ€»ç¼–è¾‘\",\n  \"å¿«é€Ÿå›å¤\",\n  \"ç›´æ¥å›å¤\"\n])\n\n/**\n * æ£€æŸ¥æ˜¯å¦ä¸ºè§¦å‘èŠ‚ç‚¹ï¼ˆç»“æŸæ€è€ƒï¼Œå¼€å§‹ç”Ÿæˆï¼‰\n */\nexport function isTriggerNode(nodeName: string): boolean {\n  return TRIGGER_NODES.has(nodeName)\n}\n\n// ============================================\n// èŠ‚ç‚¹æ˜ å°„é…ç½® (NODE_VISUAL_MAP)\n// åªåŒ…å«\"æ€è€ƒ\"èŠ‚ç‚¹ï¼Œä¸åŒ…å«\"è§¦å‘\"èŠ‚ç‚¹\n// ============================================\n\nexport const NODE_VISUAL_MAP: Record<string, WorkflowNodeConfig> = {\n  // ========== è¾“å…¥è·¯ç”±å±‚ ==========\n  \"æ ¼å¼åˆ¤æ–­\": {\n    originalName: \"æ ¼å¼åˆ¤æ–­\",\n    displayName: \"å¤šæ¨¡æ€ä½œä¸šæ„å›¾è¯†åˆ«\",\n    englishName: \"Multi-modal Assignment Intent Analysis\",\n    runningTexts: [\n      \"æ­£åœ¨æ‰«ææ–‡ä»¶å…ƒæ•°æ®...\",\n      \"è¯†åˆ«ä½œä¸šç±»å‹ä¸­...\",\n      \"åˆ†æè¾“å…¥æ ¼å¼...\",\n      \"æ£€æµ‹æ–‡æ¡£ç»“æ„...\"\n    ],\n    icon: Scan,\n    group: \"input\",\n    estimatedDuration: 2,\n    nodeType: \"thinking\"\n  },\n\n  // ========== è§†è§‰/OCR è·¯å¾„ï¼ˆå¤„ç†æ‰‹å†™ä½œæ–‡ï¼‰==========\n  \"è§†è§‰æå–\": {\n    originalName: \"è§†è§‰æå–\",\n    displayName: \"æ‰‹å†™ä½“ç»“æ„åŒ–è¯†åˆ«å±‚\",\n    englishName: \"Handwriting Structured Recognition Layer\",\n    runningTexts: [\n      \"æ­£åœ¨æå–ç¬”è¿¹ç‰¹å¾...\",\n      \"æ­£åœ¨è¿›è¡Œæ–‡å­—è½¬å½•...\",\n      \"è¯†åˆ«æ‰‹å†™å­—ç¬¦ä¸­...\",\n      \"æ„å»ºæ–‡æœ¬åºåˆ—...\"\n    ],\n    icon: Eye,\n    group: \"vision\",\n    estimatedDuration: 5,\n    nodeType: \"thinking\"\n  },\n\n  \"æ•°æ®æ¸…æ´—\": {\n    originalName: \"æ•°æ®æ¸…æ´—\",\n    displayName: \"OCR å™ªå£°è¿‡æ»¤ä¸æ–‡æœ¬å¯¹é½\",\n    englishName: \"OCR Noise Filtering & Text Alignment\",\n    runningTexts: [\n      \"æ­£åœ¨æ ¡å‡†æ–‡æœ¬è¡Œ...\",\n      \"è¿‡æ»¤è¯†åˆ«å™ªå£°...\",\n      \"å¯¹é½æ®µè½ç»“æ„...\",\n      \"ä¼˜åŒ–æ–‡æœ¬è´¨é‡...\"\n    ],\n    icon: Filter,\n    group: \"vision\",\n    estimatedDuration: 3,\n    nodeType: \"thinking\"\n  },\n\n  // ========== æ–‡æ¡£è·¯å¾„ï¼ˆå¤„ç†ç”µå­æ–‡æ¡£ï¼‰==========\n  \"æ–‡æ¡£æå–å™¨\": {\n    originalName: \"æ–‡æ¡£æå–å™¨\",\n    displayName: \"éç»“æ„åŒ–æ•™å­¦èµ„æºè§£æ\",\n    englishName: \"Unstructured Educational Resource Parsing\",\n    runningTexts: [\n      \"è§£ææ–‡æ¡£ç»“æ„...\",\n      \"æå–æ–‡æœ¬å†…å®¹...\",\n      \"è¯†åˆ«æ ¼å¼å…ƒç´ ...\",\n      \"æ„å»ºå†…å®¹ç´¢å¼•...\"\n    ],\n    icon: FileText,\n    group: \"document\",\n    estimatedDuration: 3,\n    nodeType: \"thinking\"\n  },\n\n  \"å†…å®¹æ±‡èš\": {\n    originalName: \"å†…å®¹æ±‡èš\",\n    displayName: \"ä¸Šä¸‹æ–‡è¯­å¢ƒå‘é‡èšåˆ\",\n    englishName: \"Context Vector Aggregation\",\n    runningTexts: [\n      \"èšåˆä¸Šä¸‹æ–‡ä¿¡æ¯...\",\n      \"æ„å»ºè¯­ä¹‰å‘é‡...\",\n      \"æ•´åˆå†…å®¹ç‰‡æ®µ...\",\n      \"ä¼˜åŒ–è¯­å¢ƒå…³è”...\"\n    ],\n    icon: Layers,\n    group: \"document\",\n    estimatedDuration: 2,\n    nodeType: \"thinking\"\n  },\n\n  // ========== æ ¸å¿ƒæ‰¹æ”¹å±‚ï¼ˆæ€è€ƒèŠ‚ç‚¹ï¼‰==========\n  \"ä»£ç æ‰§è¡Œ 4\": {\n    originalName: \"ä»£ç æ‰§è¡Œ 4\",\n    displayName: \"è¯­æ³•é€»è¾‘æ ¡éªŒå¼•æ“\",\n    englishName: \"Grammar & Logic Validation Engine\",\n    runningTexts: [\n      \"æ­£åœ¨éªŒè¯è¯­è¨€å­¦è§„åˆ™...\",\n      \"æ£€æŸ¥è¯­æ³•ç»“æ„...\",\n      \"åˆ†æé€»è¾‘è¿è´¯æ€§...\",\n      \"åŒ¹é…æ•™å­¦å¤§çº²...\"\n    ],\n    icon: Cog,\n    group: \"core\",\n    estimatedDuration: 4,\n    nodeType: \"thinking\"\n  }\n}\n\n// ============================================\n// é»‘åå•èŠ‚ç‚¹ï¼ˆå®Œå…¨ä¸æ˜¾ç¤ºï¼Œä¹Ÿä¸è§¦å‘ä»»ä½•é€»è¾‘ï¼‰\n// ============================================\n\nexport const HIDDEN_NODES = new Set([\n  \"ç”¨æˆ·è¾“å…¥\",\n  \"æ¡ä»¶åˆ†æ”¯ 2\",\n  \"ç›´æ¥å›å¤ 6\",\n  \"å¼€å§‹\",\n  \"ç»“æŸ\"\n])\n\n// ============================================\n// ğŸ”¥ æ€è€ƒæ­¥éª¤åˆ—è¡¨ï¼ˆç”¨äº ThoughtDrawer æ˜¾ç¤ºï¼‰\n// è¿™äº›æ˜¯ç”¨æˆ·çœ‹åˆ°çš„ç®€åŒ–ç‰ˆæµç¨‹ï¼Œä¸åŒ…å«\"æ€»ç¼–è¾‘\"\n// ============================================\n\nexport const THINKING_STEPS: WorkflowNodeConfig[] = [\n  {\n    originalName: \"æ–‡æ¡£è§£æ\",\n    displayName: \"æ–‡æ¡£è§£æ\",\n    englishName: \"Document Parsing\",\n    runningTexts: [\n      \"æ­£åœ¨è¯†åˆ«æ–‡å­—å†…å®¹å’Œå›¾ç‰‡ä¿¡æ¯...\",\n      \"æ‰«ææ–‡æ¡£å…ƒæ•°æ®...\",\n      \"æ£€æµ‹æ–‡ä»¶æ ¼å¼...\"\n    ],\n    icon: Scan,\n    group: \"input\",\n    estimatedDuration: 2,\n    nodeType: \"thinking\"\n  },\n  {\n    originalName: \"æ™ºèƒ½åˆ†æ\",\n    displayName: \"æ™ºèƒ½åˆ†æ\",\n    englishName: \"Intelligent Analysis\",\n    runningTexts: [\n      \"AIæ­£åœ¨æ·±åº¦ç†è§£æ–‡ç« ç«‹æ„å’Œç»“æ„...\",\n      \"åˆ†æå†™ä½œé£æ ¼...\",\n      \"è¯†åˆ«ä¸»é¢˜æ€æƒ³...\"\n    ],\n    icon: Eye,\n    group: \"vision\",\n    estimatedDuration: 5,\n    nodeType: \"thinking\"\n  },\n  {\n    originalName: \"å…¨é¢è¯„ä¼°\",\n    displayName: \"å…¨é¢è¯„ä¼°\",\n    englishName: \"Comprehensive Evaluation\",\n    runningTexts: [\n      \"åˆ†æè¯­è¨€è¡¨è¾¾ã€è®ºè¯é€»è¾‘å’Œåˆ›æ„äº®ç‚¹...\",\n      \"è¯„ä¼°æ–‡ç« ç»“æ„...\",\n      \"æ£€æŸ¥è®ºæ®æ”¯æ’‘...\"\n    ],\n    icon: Filter,\n    group: \"vision\",\n    isHighlight: true,\n    estimatedDuration: 3,\n    nodeType: \"thinking\"\n  },\n  {\n    originalName: \"ç”Ÿæˆå»ºè®®\",\n    displayName: \"ç”Ÿæˆå»ºè®®\",\n    englishName: \"Generate Suggestions\",\n    runningTexts: [\n      \"æç‚¼ä¼˜ç‚¹å’Œæ”¹è¿›æ–¹å‘...\",\n      \"ç”Ÿæˆä¿®æ”¹å»ºè®®...\",\n      \"ä¼˜åŒ–è¯„è¯­è¡¨è¾¾...\"\n    ],\n    icon: FileText,\n    group: \"document\",\n    estimatedDuration: 3,\n    nodeType: \"thinking\"\n  }\n]\n\n// ============================================\n// è¾…åŠ©å‡½æ•°\n// ============================================\n\n/**\n * æ ¹æ® Dify åŸå§‹èŠ‚ç‚¹åç§°è·å–å¯è§†åŒ–é…ç½®\n */\nexport function getNodeConfig(originalName: string): WorkflowNodeConfig | null {\n  if (HIDDEN_NODES.has(originalName)) {\n    return null\n  }\n  return NODE_VISUAL_MAP[originalName] || null\n}\n\n/**\n * æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åº”è¯¥è¢«éšè—\n */\nexport function shouldHideNode(originalName: string): boolean {\n  return HIDDEN_NODES.has(originalName)\n}\n\n/**\n * è·å–èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªè¿è¡Œæ–‡æ¡ˆï¼ˆè½®æ’­ï¼‰\n */\nexport function getNextRunningText(config: WorkflowNodeConfig, currentIndex: number): {\n  text: string\n  nextIndex: number\n} {\n  const texts = config.runningTexts\n  const nextIndex = (currentIndex + 1) % texts.length\n  return {\n    text: texts[currentIndex],\n    nextIndex\n  }\n}\n\n/**\n * åˆ›å»ºåˆå§‹å·¥ä½œæµçŠ¶æ€\n */\nexport function createInitialWorkflowState(): WorkflowState {\n  return {\n    nodes: [],\n    currentNodeIndex: -1,\n    isExpanded: true,\n    isThinking: false,\n    isGenerating: false\n  }\n}\n\n/**\n * æ ¹æ®èŠ‚ç‚¹åç§°åˆ›å»ºèŠ‚ç‚¹çŠ¶æ€\n */\nexport function createNodeState(originalName: string): WorkflowNodeState | null {\n  const config = getNodeConfig(originalName)\n  if (!config) return null\n  \n  return {\n    id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    config,\n    status: \"pending\",\n    currentTextIndex: 0\n  }\n}\n\n/**\n * è·å–åˆ†ç»„æ˜¾ç¤ºåç§°\n */\nexport function getGroupDisplayName(group: WorkflowNodeConfig[\"group\"]): string {\n  const groupNames: Record<string, string> = {\n    input: \"è¾“å…¥åˆ†æ\",\n    vision: \"è§†è§‰è¯†åˆ«\",\n    document: \"æ–‡æ¡£å¤„ç†\",\n    core: \"æ™ºèƒ½æ‰¹æ”¹\"\n  }\n  return groupNames[group] || group\n}\n\n/**\n * è®¡ç®—å·²å®ŒæˆèŠ‚ç‚¹æ•°é‡\n */\nexport function getCompletedCount(nodes: WorkflowNodeState[]): number {\n  return nodes.filter(n => n.status === \"completed\").length\n}\n\n/**\n * è·å–å½“å‰è¿è¡Œä¸­çš„èŠ‚ç‚¹\n */\nexport function getCurrentRunningNode(nodes: WorkflowNodeState[]): WorkflowNodeState | null {\n  return nodes.find(n => n.status === \"running\") || null\n}\n\n// ============================================\n// ä¼ªæ—¥å¿—æ–‡æ¡ˆåº“ï¼ˆç”¨äºæ¨¡æ‹Ÿè¿›åº¦ï¼‰\n// ============================================\n\nexport const FAKE_LOG_MESSAGES: Record<string, string[]> = {\n  input: [\n    \"æ­£åœ¨åŠ è½½è¯å…¸...\",\n    \"åˆå§‹åŒ–åˆ†æå¼•æ“...\",\n    \"å‡†å¤‡å¤„ç†ç®¡é“...\",\n    \"åŠ è½½è¯­è¨€æ¨¡å‹...\",\n    \"é…ç½®è§£æå™¨...\"\n  ],\n  vision: [\n    \"åŠ è½½è§†è§‰æ¨¡å‹...\",\n    \"é¢„å¤„ç†å›¾åƒæ•°æ®...\",\n    \"æ‰§è¡Œç‰¹å¾æå–...\",\n    \"ä¼˜åŒ–è¯†åˆ«ç²¾åº¦...\",\n    \"æ ¡éªŒæ–‡å­—è¾¹ç•Œ...\"\n  ],\n  document: [\n    \"è§£ææ–‡æ¡£æ ¼å¼...\",\n    \"æå–æ–‡æœ¬å±‚...\",\n    \"æ„å»ºå†…å®¹ç´¢å¼•...\",\n    \"åˆ†ææ®µè½ç»“æ„...\",\n    \"è¯†åˆ«æ ‡é¢˜å±‚çº§...\"\n  ],\n  core: [\n    \"åŒ¹é…æ•™å­¦å¤§çº²...\",\n    \"åŠ è½½è¯„åˆ†æ ‡å‡†...\",\n    \"åˆå§‹åŒ–åé¦ˆæ¨¡æ¿...\",\n    \"ç»¼åˆå¤šç»´åº¦åˆ†æ...\",\n    \"ä¼˜åŒ–è¯„è¯­è¡¨è¾¾...\",\n    \"ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®...\"\n  ]\n}\n\n/**\n * è·å–éšæœºä¼ªæ—¥å¿—\n */\nexport function getRandomFakeLog(group: WorkflowNodeConfig[\"group\"]): string {\n  const logs = FAKE_LOG_MESSAGES[group]\n  return logs[Math.floor(Math.random() * logs.length)]\n}\n\n/**\n * è·å–ä¸‹ä¸€ä¸ªä¼ªæ—¥å¿—ï¼ˆé¡ºåºè½®æ’­ï¼‰\n */\nexport function getNextFakeLog(group: WorkflowNodeConfig[\"group\"], currentIndex: number): {\n  log: string\n  nextIndex: number\n} {\n  const logs = FAKE_LOG_MESSAGES[group]\n  const nextIndex = (currentIndex + 1) % logs.length\n  return {\n    log: logs[currentIndex % logs.length],\n    nextIndex\n  }\n}\n\n// ============================================\n// è¿›åº¦è®¡ç®—è¾…åŠ©å‡½æ•°\n// ============================================\n\n/**\n * è®¡ç®—æ€»ä½“è¿›åº¦ç™¾åˆ†æ¯”\n */\nexport function calculateProgress(completedCount: number, totalSteps: number = THINKING_STEPS.length): number {\n  return Math.round((completedCount / totalSteps) * 100)\n}\n\n/**\n * è·å–æŠ˜å æ€æ‘˜è¦æ–‡æœ¬\n */\nexport function getCollapsedSummary(\n  completedCount: number, \n  isGenerating: boolean,\n  totalSteps: number = THINKING_STEPS.length\n): string {\n  if (isGenerating) {\n    return `âœ… å·²å®Œæˆ ${completedCount} ä¸ªè®¤çŸ¥æ­¥éª¤ï¼Œæ­£åœ¨ç”Ÿæˆæœ€ç»ˆè¯„è¯­...`\n  }\n  \n  if (completedCount === 0) {\n    return \"ğŸ§  AI æ­£åœ¨æ€è€ƒä¸­...\"\n  }\n  \n  if (completedCount === totalSteps) {\n    return `âœ… ${completedCount} ä¸ªè®¤çŸ¥æ­¥éª¤å·²å®Œæˆ`\n  }\n  \n  return `ğŸ§  å·²å®Œæˆ ${completedCount}/${totalSteps} ä¸ªè®¤çŸ¥æ­¥éª¤...`\n}\n\n// ============================================\n// åŠ¨ç”»é…ç½®\n// ============================================\n\nexport const ANIMATION_CONFIG = {\n  /** æ–‡æ¡ˆè½®æ’­é—´éš”ï¼ˆæ¯«ç§’ï¼‰ */\n  textRotationInterval: 2000,\n  /** ä¼ªæ—¥å¿—è½®æ’­é—´éš”ï¼ˆæ¯«ç§’ï¼‰ */\n  fakeLogInterval: 1500,\n  /** è¿›åº¦æ¡åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ */\n  progressBarDuration: 500,\n  /** èŠ‚ç‚¹åˆ‡æ¢åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ */\n  nodeTransitionDuration: 300,\n  /** å‘¼å¸åŠ¨ç”»å‘¨æœŸï¼ˆæ¯«ç§’ï¼‰ */\n  breathingAnimationDuration: 1500,\n  /** ğŸ”¥ æ€è€ƒå®¹å™¨æŠ˜å åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ */\n  drawerCollapseDelay: 200\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 882, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/WorkflowVisualizer.tsx"],"sourcesContent":["/**\n * ğŸ¯ ä½œæ–‡æ‰¹æ”¹æ™ºèƒ½ä½“ - é«˜ä¿çœŸæ²‰æµ¸å¼çŠ¶æ€å¯è§†åŒ–ç»„ä»¶\n * \n * åŸºäº GenSpark é£æ ¼è®¾è®¡çš„å¡ç‰‡å¼è¿›åº¦å±•ç¤º\n * ä¸¥æ ¼ä½¿ç”¨é¡¹ç›®ç°æœ‰é…è‰²æ–¹æ¡ˆï¼ˆCSS å˜é‡ + brandColorsï¼‰\n * \n * ç‰¹æ€§ï¼š\n * - æ€ç»´æŠ˜å é¢æ¿ï¼šå¯å±•å¼€/æŠ˜å çš„è¿›åº¦è¯¦æƒ…\n * - æ­¥éª¤å¡ç‰‡ï¼šå¸¦å‘¼å¸åŠ¨ç”»çš„çŠ¶æ€æŒ‡ç¤º\n * - å‡æ€§æ—¥å¿—æ¨¡æ‹Ÿï¼šè®©ç”¨æˆ·æ„Ÿè§‰ç³»ç»Ÿåœ¨\"åŠªåŠ›å·¥ä½œ\"\n * - ä¹è§‚æ›´æ–°ï¼šä¸‹ä¸€ä¸ªèŠ‚ç‚¹æå‰æ˜¾ç¤ºä¸º\"å‡†å¤‡ä¸­\"\n */\n\n\"use client\"\n\nimport React, { useState, useEffect } from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { Check, ChevronDown, ChevronUp, Loader2, Clock, Sparkles, Terminal } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { \n  WorkflowState, \n  WorkflowNodeState,\n  WorkflowNodeStatus,\n  FIXED_STEPS,\n  ANIMATION_CONFIG,\n  type WorkflowNodeConfig\n} from \"@/lib/workflow-visual-config\"\n\n// ============================================\n// ç±»å‹å®šä¹‰\n// ============================================\n\ninterface WorkflowVisualizerProps {\n  workflowState: WorkflowState\n  isProcessing: boolean\n  onToggleExpanded?: () => void\n  summaryText?: string\n  className?: string\n  /** å½“å‰è¿è¡ŒèŠ‚ç‚¹çš„ä¼ªæ—¥å¿— */\n  currentFakeLog?: string\n  /** å½“å‰è¿è¡ŒèŠ‚ç‚¹çš„æ–‡æ¡ˆ */\n  currentRunningText?: string\n}\n\n// ============================================\n// å¸¸é‡ - ä½¿ç”¨ CSS å˜é‡ç¡®ä¿ä¸€è‡´æ€§\n// ============================================\n\nconst TOTAL_STEPS = 5\n\n// ============================================\n// æ­¥éª¤å›¾æ ‡ç»„ä»¶\n// ============================================\n\ninterface StepIconProps {\n  status: WorkflowNodeStatus\n  icon: React.ComponentType<{ className?: string }>\n  isHighlight?: boolean\n}\n\nconst StepIcon: React.FC<StepIconProps> = ({ status, icon: Icon, isHighlight }) => {\n  // å®ŒæˆçŠ¶æ€\n  if (status === \"completed\") {\n    return (\n      <motion.div\n        initial={{ scale: 0.8, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        transition={{ duration: 0.3, ease: \"easeOut\" }}\n        className=\"flex h-8 w-8 items-center justify-center rounded-full bg-primary\"\n      >\n        <Check className=\"h-4 w-4 text-primary-foreground\" strokeWidth={3} />\n      </motion.div>\n    )\n  }\n\n  // è¿è¡Œä¸­çŠ¶æ€\n  if (status === \"running\") {\n    return (\n      <div className=\"relative flex h-8 w-8 items-center justify-center\">\n        {/* å‘¼å¸åŠ¨ç”»å…‰ç¯ */}\n        <motion.div\n          className=\"absolute inset-0 rounded-full border-2 border-primary\"\n          animate={{\n            scale: [1, 1.4, 1],\n            opacity: [0.6, 0, 0.6]\n          }}\n          transition={{\n            duration: ANIMATION_CONFIG.breathingAnimationDuration / 1000,\n            repeat: Infinity,\n            ease: \"easeInOut\"\n          }}\n        />\n        {/* å†…åœˆ */}\n        <div className={cn(\n          \"flex h-8 w-8 items-center justify-center rounded-full border-2 border-primary\",\n          isHighlight ? \"bg-primary/20\" : \"bg-primary/10\"\n        )}>\n          <Icon className=\"h-4 w-4 text-primary\" />\n        </div>\n      </div>\n    )\n  }\n\n  // å‡†å¤‡ä¸­çŠ¶æ€\n  if (status === \"preparing\") {\n    return (\n      <motion.div\n        initial={{ opacity: 0.5 }}\n        animate={{ opacity: [0.5, 0.8, 0.5] }}\n        transition={{ duration: 1.5, repeat: Infinity }}\n        className=\"flex h-8 w-8 items-center justify-center rounded-full border-2 border-muted-foreground/30 bg-muted/50\"\n      >\n        <Clock className=\"h-4 w-4 text-muted-foreground/50\" />\n      </motion.div>\n    )\n  }\n\n  // é”™è¯¯çŠ¶æ€\n  if (status === \"error\") {\n    return (\n      <div className=\"flex h-8 w-8 items-center justify-center rounded-full border-2 border-destructive bg-destructive/10\">\n        <Icon className=\"h-4 w-4 text-destructive\" />\n      </div>\n    )\n  }\n\n  // å¾…å¤„ç†çŠ¶æ€\n  return (\n    <div className=\"flex h-8 w-8 items-center justify-center rounded-full border-2 border-muted-foreground/20\">\n      <div className=\"h-2 w-2 rounded-full bg-muted-foreground/30\" />\n    </div>\n  )\n}\n\n// ============================================\n// å•ä¸ªæ­¥éª¤å¡ç‰‡\n// ============================================\n\ninterface StepCardProps {\n  step: WorkflowNodeConfig\n  index: number\n  status: WorkflowNodeStatus\n  runningText?: string\n  fakeLog?: string\n  isLast?: boolean\n}\n\nconst StepCard: React.FC<StepCardProps> = ({ \n  step, \n  index, \n  status, \n  runningText, \n  fakeLog,\n  isLast \n}) => {\n  const isActive = status === \"running\"\n  const isCompleted = status === \"completed\"\n  const isPreparing = status === \"preparing\"\n  const isError = status === \"error\"\n  \n  return (\n    <motion.div\n      initial={{ opacity: 0, x: -10 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ delay: index * 0.08, duration: 0.3 }}\n      className=\"relative\"\n    >\n      {/* è¿æ¥çº¿ */}\n      {!isLast && (\n        <div className=\"absolute left-4 top-10 h-full w-px\">\n          <div \n            className={cn(\n              \"h-full w-full transition-colors duration-300\",\n              isCompleted ? \"bg-primary\" : \"bg-border\"\n            )}\n          />\n        </div>\n      )}\n      \n      {/* å¡ç‰‡å†…å®¹ */}\n      <div\n        className={cn(\n          \"relative flex items-start gap-3 rounded-xl px-3 py-3 transition-all duration-300\",\n          isActive && \"bg-primary/5 ring-1 ring-primary/20\",\n          isPreparing && \"opacity-60\",\n          isError && \"bg-destructive/5 ring-1 ring-destructive/20\",\n          !isActive && !isPreparing && !isError && \"hover:bg-muted/50\"\n        )}\n      >\n        <StepIcon \n          status={status} \n          icon={step.icon} \n          isHighlight={step.isHighlight} \n        />\n        \n        <div className=\"flex-1 min-w-0 pt-0.5\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <h4 \n              className={cn(\n                \"font-medium text-sm transition-colors\",\n                isCompleted || isActive ? \"text-foreground\" : \"text-muted-foreground\"\n              )}\n            >\n              {step.displayName}\n            </h4>\n            \n            {/* çŠ¶æ€æŒ‡ç¤ºå™¨ */}\n            {isActive && (\n              <motion.div\n                animate={{ rotate: 360 }}\n                transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n              >\n                <Loader2 className=\"h-4 w-4 text-primary\" />\n              </motion.div>\n            )}\n            {isCompleted && (\n              <span className=\"text-xs text-primary font-medium\">å®Œæˆ</span>\n            )}\n            {isPreparing && (\n              <span className=\"text-xs text-muted-foreground\">å‡†å¤‡ä¸­</span>\n            )}\n          </div>\n          \n          {/* è¿è¡Œä¸­æ–‡æ¡ˆ */}\n          <AnimatePresence mode=\"wait\">\n            {isActive && runningText && (\n              <motion.p\n                key={runningText}\n                initial={{ opacity: 0, y: 5 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -5 }}\n                transition={{ duration: 0.2 }}\n                className=\"text-xs text-muted-foreground mt-1 truncate\"\n              >\n                {runningText}\n              </motion.p>\n            )}\n            {!isActive && (\n              <p className=\"text-xs text-muted-foreground/60 mt-1 truncate\">\n                {step.englishName}\n              </p>\n            )}\n          </AnimatePresence>\n          \n          {/* ä¼ªæ—¥å¿—æ˜¾ç¤º - ä»…åœ¨è¿è¡Œä¸­æ˜¾ç¤º */}\n          <AnimatePresence>\n            {isActive && fakeLog && (\n              <motion.div\n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: \"auto\" }}\n                exit={{ opacity: 0, height: 0 }}\n                transition={{ duration: 0.2 }}\n                className=\"mt-2 flex items-center gap-1.5 text-[10px] text-muted-foreground/70 font-mono\"\n              >\n                <Terminal className=\"h-3 w-3 flex-shrink-0\" />\n                <motion.span\n                  key={fakeLog}\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  transition={{ duration: 0.15 }}\n                >\n                  {fakeLog}\n                </motion.span>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\n// ============================================\n// æŠ˜å æ€æ‘˜è¦æ \n// ============================================\n\ninterface CollapsedSummaryProps {\n  completedCount: number\n  currentStepName?: string\n  isProcessing: boolean\n  onExpand: () => void\n}\n\nconst CollapsedSummary: React.FC<CollapsedSummaryProps> = ({\n  completedCount,\n  currentStepName,\n  isProcessing,\n  onExpand\n}) => {\n  return (\n    <motion.button\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      onClick={onExpand}\n      className=\"w-full flex items-center justify-between px-4 py-3 bg-muted/50 hover:bg-muted/70 rounded-xl transition-colors group\"\n    >\n      <div className=\"flex items-center gap-3\">\n        {isProcessing ? (\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n          >\n            <Loader2 className=\"h-4 w-4 text-primary\" />\n          </motion.div>\n        ) : (\n          <Sparkles className=\"h-4 w-4 text-primary\" />\n        )}\n        <span className=\"text-sm text-foreground\">\n          {isProcessing && currentStepName ? (\n            <>\n              <span className=\"text-muted-foreground\">âœ¨ {completedCount}ä¸ªæ­¥éª¤å·²å®Œæˆ | å½“å‰ï¼š</span>\n              <span className=\"text-primary font-medium\">{currentStepName}...</span>\n            </>\n          ) : completedCount === TOTAL_STEPS ? (\n            <span className=\"text-primary\">âœ… {completedCount}ä¸ªæ‰¹æ”¹æ­¥éª¤å…¨éƒ¨å®Œæˆ</span>\n          ) : (\n            <span className=\"text-muted-foreground\">{completedCount}/{TOTAL_STEPS} æ­¥éª¤å·²å®Œæˆ</span>\n          )}\n        </span>\n      </div>\n      <ChevronDown className=\"h-4 w-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\n    </motion.button>\n  )\n}\n\n// ============================================\n// ä¸»ç»„ä»¶\n// ============================================\n\nexport const WorkflowVisualizer: React.FC<WorkflowVisualizerProps> = ({\n  workflowState,\n  isProcessing,\n  onToggleExpanded,\n  summaryText,\n  className,\n  currentFakeLog,\n  currentRunningText\n}) => {\n  const [isExpanded, setIsExpanded] = useState(true)\n  \n  // è®¡ç®—å½“å‰è¿›åº¦\n  const completedCount = workflowState.nodes.filter(n => n.status === \"completed\").length\n  const runningNode = workflowState.nodes.find(n => n.status === \"running\")\n  const currentStep = runningNode ? completedCount + 1 : completedCount\n  const progress = Math.round((completedCount / TOTAL_STEPS) * 100)\n\n  // åŒæ­¥å±•å¼€çŠ¶æ€\n  useEffect(() => {\n    setIsExpanded(workflowState.isExpanded)\n  }, [workflowState.isExpanded])\n\n  // åˆ‡æ¢å±•å¼€/æŠ˜å \n  const handleToggle = () => {\n    setIsExpanded(!isExpanded)\n    onToggleExpanded?.()\n  }\n\n  // å¦‚æœæ²¡æœ‰èŠ‚ç‚¹ä¸”ä¸åœ¨å¤„ç†ä¸­ï¼Œä¸æ˜¾ç¤º\n  if (!isProcessing && workflowState.nodes.length === 0) {\n    return null\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: -10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -10 }}\n      transition={{ duration: 0.3 }}\n      className={cn(\n        \"rounded-2xl border border-border bg-card overflow-hidden shadow-sm\",\n        className\n      )}\n    >\n      {/* å¤´éƒ¨ï¼šæ ‡é¢˜ + è¿›åº¦ + æŠ˜å æŒ‰é’® */}\n      <div className=\"px-4 py-3 flex items-center justify-between border-b border-border/50\">\n        <div className=\"flex items-center gap-3\">\n          {/* AI å›¾æ ‡ */}\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-primary\">\n            <Sparkles className=\"h-5 w-5 text-primary-foreground\" />\n          </div>\n          \n          <div>\n            <h3 className=\"font-semibold text-foreground text-sm\">\n              AI æ™ºèƒ½æ‰¹æ”¹è¿›è¡Œä¸­\n            </h3>\n            <p className=\"text-xs text-muted-foreground\">\n              é˜¶æ®µ {currentStep} / {TOTAL_STEPS}\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-3\">\n          {/* ç™¾åˆ†æ¯” */}\n          <div className=\"text-right\">\n            <span className=\"text-2xl font-bold text-primary\">\n              {progress}%\n            </span>\n            <p className=\"text-xs text-muted-foreground\">å·²å®Œæˆ</p>\n          </div>\n          \n          {/* æŠ˜å æŒ‰é’® */}\n          <button\n            onClick={handleToggle}\n            className=\"p-1.5 rounded-lg hover:bg-muted transition-colors\"\n            aria-label={isExpanded ? \"æŠ˜å \" : \"å±•å¼€\"}\n          >\n            {isExpanded ? (\n              <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\n            ) : (\n              <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n            )}\n          </button>\n        </div>\n      </div>\n\n      {/* è¿›åº¦æ¡ */}\n      <div className=\"px-4 py-2 bg-muted/30\">\n        <div className=\"h-1.5 rounded-full overflow-hidden bg-muted\">\n          <motion.div\n            className=\"h-full rounded-full bg-gradient-to-r from-primary/80 to-primary\"\n            initial={{ width: 0 }}\n            animate={{ width: `${progress}%` }}\n            transition={{ \n              duration: ANIMATION_CONFIG.progressBarDuration / 1000, \n              ease: \"easeOut\" \n            }}\n          />\n        </div>\n      </div>\n\n      {/* å¯æŠ˜å çš„æ­¥éª¤åˆ—è¡¨ */}\n      <AnimatePresence initial={false}>\n        {isExpanded ? (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: \"easeInOut\" }}\n          >\n            <div className=\"px-3 py-3 space-y-1\">\n              {FIXED_STEPS.map((step, index) => {\n                // ç¡®å®šæ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€\n                let status: WorkflowNodeStatus = \"pending\"\n                const nodeState = workflowState.nodes.find(\n                  n => n.config.displayName === step.displayName\n                )\n                \n                if (nodeState) {\n                  status = nodeState.status\n                } else if (index < completedCount) {\n                  status = \"completed\"\n                } else if (index === completedCount && isProcessing) {\n                  status = \"running\"\n                }\n                \n                return (\n                  <StepCard\n                    key={step.displayName}\n                    step={step}\n                    index={index}\n                    status={status}\n                    runningText={status === \"running\" ? currentRunningText : undefined}\n                    fakeLog={status === \"running\" ? currentFakeLog : undefined}\n                    isLast={index === FIXED_STEPS.length - 1}\n                  />\n                )\n              })}\n            </div>\n          </motion.div>\n        ) : (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: \"easeInOut\" }}\n            className=\"px-3 py-2\"\n          >\n            <CollapsedSummary\n              completedCount={completedCount}\n              currentStepName={runningNode?.config.displayName}\n              isProcessing={isProcessing}\n              onExpand={handleToggle}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* åº•éƒ¨æç¤º - ä»…åœ¨å¤„ç†ä¸­æ˜¾ç¤º */}\n      {isProcessing && (\n        <motion.div \n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          className=\"px-4 py-3 flex items-center gap-2 bg-primary/5 border-t border-border/50\"\n        >\n          <motion.div\n            animate={{ scale: [1, 1.2, 1] }}\n            transition={{ duration: 2, repeat: Infinity }}\n          >\n            <Sparkles className=\"h-4 w-4 flex-shrink-0 text-primary\" />\n          </motion.div>\n          <p className=\"text-xs text-muted-foreground\">\n            AI æ­£åœ¨ä¸ºæ‚¨ç²¾å¿ƒæ‰¹æ”¹ï¼Œè¯·ç¨å€™ç‰‡åˆ»...\n          </p>\n        </motion.div>\n      )}\n    </motion.div>\n  )\n}\n\nexport default WorkflowVisualizer\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1760, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/hooks/useWorkflowVisualizer.ts"],"sourcesContent":["/**\n * ğŸ¯ ä½œæ–‡æ‰¹æ”¹æ™ºèƒ½ä½“ - å·¥ä½œæµå¯è§†åŒ– Hook\n * \n * è§£æ Dify SSE äº‹ä»¶æµï¼Œç®¡ç†å·¥ä½œæµçŠ¶æ€æœº\n * å®ç°é€æ˜åŒ–çš„ AI æ€è€ƒè·¯å¾„å¯è§†åŒ–\n * \n * ğŸ”¥ å…³é”®è®¾è®¡ï¼š\n * - å½“æ£€æµ‹åˆ°\"æ€»ç¼–è¾‘\"èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œè§¦å‘\"äº¤æ¥\"(The Handover)\n * - å¼ºåˆ¶ç»“æŸæ‰€æœ‰æ€è€ƒåŠ¨ç”»ï¼Œè‡ªåŠ¨æŠ˜å æ€è€ƒå®¹å™¨\n * - å°†ç„¦ç‚¹è½¬ç§»åˆ°ä¸»æ–‡æœ¬åŒºåŸŸï¼Œå¼€å§‹ç”Ÿæˆé˜¶æ®µ\n */\n\nimport { useState, useCallback, useRef, useEffect } from \"react\"\nimport {\n  WorkflowState,\n  WorkflowNodeState,\n  WorkflowNodeStatus,\n  WorkflowNodeConfig,\n  shouldHideNode,\n  getCompletedCount,\n  getCurrentRunningNode,\n  getNextRunningText,\n  getNextFakeLog,\n  THINKING_STEPS,\n  ANIMATION_CONFIG,\n  isTriggerNode\n} from \"@/lib/workflow-visual-config\"\n\n// ============================================\n// ç±»å‹å®šä¹‰\n// ============================================\n\nexport interface UseWorkflowVisualizerReturn {\n  /** å·¥ä½œæµçŠ¶æ€ */\n  workflowState: WorkflowState\n  /** æ˜¯å¦æ­£åœ¨å¤„ç†å·¥ä½œæµ */\n  isProcessing: boolean\n  /** ğŸ”¥ æ˜¯å¦å¤„äºæ€è€ƒé˜¶æ®µ */\n  isThinking: boolean\n  /** ğŸ”¥ æ˜¯å¦å·²è¿›å…¥ç”Ÿæˆé˜¶æ®µ */\n  isGenerating: boolean\n  /** å¤„ç† SSE äº‹ä»¶ */\n  handleSSEEvent: (event: DifySSEEvent) => void\n  /** é‡ç½®å·¥ä½œæµçŠ¶æ€ */\n  resetWorkflow: () => void\n  /** åˆ‡æ¢å±•å¼€/æŠ˜å  */\n  toggleExpanded: () => void\n  /** è·å–æŠ˜å æ€æ‘˜è¦æ–‡æœ¬ */\n  getSummaryText: () => string\n  /** æ‰‹åŠ¨æ ‡è®°å·¥ä½œæµå®Œæˆ */\n  markWorkflowComplete: () => void\n  /** å½“å‰è¿è¡ŒèŠ‚ç‚¹çš„ä¼ªæ—¥å¿— */\n  currentFakeLog: string\n  /** å½“å‰è¿è¡ŒèŠ‚ç‚¹çš„æ–‡æ¡ˆ */\n  currentRunningText: string\n  /** ğŸ”¥ è§¦å‘\"äº¤æ¥\"ï¼šç»“æŸæ€è€ƒï¼Œå¼€å§‹ç”Ÿæˆ */\n  triggerHandover: () => void\n}\n\nexport interface DifySSEEvent {\n  event: string\n  data?: {\n    node_id?: string\n    title?: string\n    status?: string\n    workflow_run_id?: string\n    [key: string]: unknown\n  }\n}\n\n// ============================================\n// åˆå§‹çŠ¶æ€\n// ============================================\n\nconst createInitialState = (): WorkflowState => ({\n  nodes: [],\n  currentNodeIndex: -1,\n  isExpanded: true,\n  startTime: undefined,\n  isThinking: false,\n  isGenerating: false\n})\n\n// ============================================\n// Hook å®ç°\n// ============================================\n\nexport function useWorkflowVisualizer(): UseWorkflowVisualizerReturn {\n  const [workflowState, setWorkflowState] = useState<WorkflowState>(createInitialState())\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [currentFakeLog, setCurrentFakeLog] = useState(\"\")\n  const [currentRunningText, setCurrentRunningText] = useState(\"\")\n  \n  // ç”¨äºé˜²æ­¢é‡å¤æ·»åŠ èŠ‚ç‚¹\n  const processedNodesRef = useRef<Set<string>>(new Set())\n  // æ–‡æ¡ˆè½®æ’­å®šæ—¶å™¨\n  const textRotationTimerRef = useRef<NodeJS.Timeout | null>(null)\n  // ä¼ªæ—¥å¿—è½®æ’­å®šæ—¶å™¨\n  const fakeLogTimerRef = useRef<NodeJS.Timeout | null>(null)\n  // ä¼ªæ—¥å¿—ç´¢å¼•\n  const fakeLogIndexRef = useRef(0)\n  // å½“å‰æ­¥éª¤ç´¢å¼•ï¼ˆç”¨äºå›ºå®šæ­¥éª¤æ¨¡å¼ï¼‰\n  const currentStepIndexRef = useRef(0)\n  // ğŸ”¥ æ˜¯å¦å·²è§¦å‘äº¤æ¥\n  const hasTriggeredHandoverRef = useRef(false)\n\n  // æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨\n  const clearAllTimers = useCallback(() => {\n    if (textRotationTimerRef.current) {\n      clearInterval(textRotationTimerRef.current)\n      textRotationTimerRef.current = null\n    }\n    if (fakeLogTimerRef.current) {\n      clearInterval(fakeLogTimerRef.current)\n      fakeLogTimerRef.current = null\n    }\n  }, [])\n\n  // ç»„ä»¶å¸è½½æ—¶æ¸…ç†\n  useEffect(() => {\n    return () => {\n      clearAllTimers()\n    }\n  }, [clearAllTimers])\n\n  // å¯åŠ¨æ–‡æ¡ˆè½®æ’­\n  const startTextRotation = useCallback(() => {\n    if (textRotationTimerRef.current) {\n      clearInterval(textRotationTimerRef.current)\n    }\n    \n    textRotationTimerRef.current = setInterval(() => {\n      setWorkflowState(prev => {\n        // å¦‚æœå·²è¿›å…¥ç”Ÿæˆé˜¶æ®µï¼Œåœæ­¢è½®æ’­\n        if (prev.isGenerating) return prev\n        \n        const runningNode = prev.nodes.find(n => n.status === \"running\")\n        if (!runningNode) return prev\n        \n        const { text, nextIndex } = getNextRunningText(runningNode.config, runningNode.currentTextIndex)\n        setCurrentRunningText(text)\n        \n        return {\n          ...prev,\n          nodes: prev.nodes.map(node => \n            node.id === runningNode.id \n              ? { ...node, currentTextIndex: nextIndex }\n              : node\n          )\n        }\n      })\n    }, ANIMATION_CONFIG.textRotationInterval)\n  }, [])\n\n  // å¯åŠ¨ä¼ªæ—¥å¿—è½®æ’­\n  const startFakeLogRotation = useCallback((group: \"input\" | \"vision\" | \"document\" | \"core\") => {\n    if (fakeLogTimerRef.current) {\n      clearInterval(fakeLogTimerRef.current)\n    }\n    \n    // ç«‹å³æ˜¾ç¤ºç¬¬ä¸€æ¡\n    const { log: initialLog } = getNextFakeLog(group, 0)\n    setCurrentFakeLog(initialLog)\n    fakeLogIndexRef.current = 1\n    \n    fakeLogTimerRef.current = setInterval(() => {\n      const { log, nextIndex } = getNextFakeLog(group, fakeLogIndexRef.current)\n      setCurrentFakeLog(log)\n      fakeLogIndexRef.current = nextIndex\n    }, ANIMATION_CONFIG.fakeLogInterval)\n  }, [])\n\n  // åœæ­¢æ‰€æœ‰è½®æ’­\n  const stopAllRotations = useCallback(() => {\n    clearAllTimers()\n    setCurrentFakeLog(\"\")\n    setCurrentRunningText(\"\")\n  }, [clearAllTimers])\n\n  // ğŸ”¥ è§¦å‘\"äº¤æ¥\"ï¼šç»“æŸæ€è€ƒï¼Œå¼€å§‹ç”Ÿæˆ\n  const triggerHandover = useCallback(() => {\n    if (hasTriggeredHandoverRef.current) return\n    hasTriggeredHandoverRef.current = true\n    \n    console.log(\"ğŸ”¥ [Handover] è§¦å‘äº¤æ¥ï¼šç»“æŸæ€è€ƒï¼Œå¼€å§‹ç”Ÿæˆ\")\n    \n    // åœæ­¢æ‰€æœ‰è½®æ’­åŠ¨ç”»\n    stopAllRotations()\n    \n    // æ›´æ–°çŠ¶æ€ï¼š\n    // A. å°†æ‰€æœ‰æœªå®Œæˆçš„æ­¥éª¤å¼ºåˆ¶æ ‡è®°ä¸º completed\n    // B. è®¾ç½® isThinking = false\n    // C. è‡ªåŠ¨æŠ˜å æ€è€ƒé¢æ¿ (isExpanded = false)\n    // D. è®¾ç½® isGenerating = true\n    setWorkflowState(prev => ({\n      ...prev,\n      nodes: prev.nodes.map(node => ({\n        ...node,\n        status: \"completed\" as WorkflowNodeStatus,\n        endTime: node.endTime || Date.now()\n      })),\n      isExpanded: false,\n      isThinking: false,\n      isGenerating: true\n    }))\n  }, [stopAllRotations])\n\n  // å¤„ç† SSE äº‹ä»¶\n  const handleSSEEvent = useCallback((event: DifySSEEvent) => {\n    const { event: eventType, data } = event\n\n    // å·¥ä½œæµå¼€å§‹\n    if (eventType === \"workflow_started\") {\n      setIsProcessing(true)\n      processedNodesRef.current.clear()\n      currentStepIndexRef.current = 0\n      hasTriggeredHandoverRef.current = false\n      \n      // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ­¥éª¤ä¸ºè¿è¡Œä¸­\n      const firstStep = THINKING_STEPS[0]\n      const firstNode: WorkflowNodeState = {\n        id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        config: firstStep,\n        status: \"running\",\n        startTime: Date.now(),\n        currentTextIndex: 0\n      }\n      \n      setWorkflowState({\n        nodes: [firstNode],\n        currentNodeIndex: 0,\n        isExpanded: true,\n        startTime: Date.now(),\n        isThinking: true,\n        isGenerating: false\n      })\n      \n      // è®¾ç½®åˆå§‹è¿è¡Œæ–‡æ¡ˆ\n      setCurrentRunningText(firstStep.runningTexts[0])\n      \n      // å¯åŠ¨è½®æ’­\n      startTextRotation()\n      startFakeLogRotation(firstStep.group)\n      \n      return\n    }\n\n    // å·¥ä½œæµç»“æŸ\n    if (eventType === \"workflow_finished\") {\n      setIsProcessing(false)\n      stopAllRotations()\n      \n      // å°†æ‰€æœ‰èŠ‚ç‚¹æ ‡è®°ä¸ºå®Œæˆ\n      setWorkflowState(prev => ({\n        ...prev,\n        nodes: prev.nodes.map(node => ({\n          ...node,\n          status: \"completed\" as WorkflowNodeStatus,\n          endTime: node.endTime || Date.now()\n        })),\n        isThinking: false\n      }))\n      return\n    }\n\n    // èŠ‚ç‚¹å¼€å§‹\n    if (eventType === \"node_started\" && data?.title) {\n      const nodeTitle = data.title\n      \n      // ğŸ”¥ æ£€æŸ¥æ˜¯å¦ä¸ºè§¦å‘èŠ‚ç‚¹ï¼ˆæ€»ç¼–è¾‘ã€å¿«é€Ÿå›å¤ç­‰ï¼‰\n      if (isTriggerNode(nodeTitle)) {\n        console.log(`ğŸ”¥ [Trigger Node] æ£€æµ‹åˆ°è§¦å‘èŠ‚ç‚¹: ${nodeTitle}`)\n        triggerHandover()\n        return\n      }\n      \n      // æ£€æŸ¥æ˜¯å¦åº”è¯¥éšè—\n      if (shouldHideNode(nodeTitle)) return\n      \n      // å¦‚æœå·²è¿›å…¥ç”Ÿæˆé˜¶æ®µï¼Œå¿½ç•¥åç»­æ€è€ƒèŠ‚ç‚¹\n      if (hasTriggeredHandoverRef.current) return\n      \n      // é˜²æ­¢é‡å¤æ·»åŠ \n      const nodeKey = `${nodeTitle}-${data.node_id || ''}`\n      if (processedNodesRef.current.has(nodeKey)) return\n      processedNodesRef.current.add(nodeKey)\n      \n      // æ¨è¿›å›ºå®šæ­¥éª¤\n      const currentIndex = currentStepIndexRef.current\n      if (currentIndex < THINKING_STEPS.length - 1) {\n        currentStepIndexRef.current = currentIndex + 1\n        const nextStep = THINKING_STEPS[currentStepIndexRef.current]\n        \n        setWorkflowState(prev => {\n          // å°†å½“å‰è¿è¡Œçš„èŠ‚ç‚¹æ ‡è®°ä¸ºå®Œæˆ\n          const updatedNodes = prev.nodes.map(node => ({\n            ...node,\n            status: node.status === \"running\" ? \"completed\" as WorkflowNodeStatus : \n                   node.status === \"preparing\" ? \"running\" as WorkflowNodeStatus : \n                   node.status,\n            endTime: node.status === \"running\" ? Date.now() : node.endTime,\n            startTime: node.status === \"preparing\" ? Date.now() : node.startTime\n          }))\n          \n          // æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ æ–°èŠ‚ç‚¹\n          const hasNextStep = updatedNodes.some(n => n.config.displayName === nextStep.displayName)\n          if (!hasNextStep) {\n            const newNode: WorkflowNodeState = {\n              id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n              config: nextStep,\n              status: \"running\",\n              startTime: Date.now(),\n              currentTextIndex: 0\n            }\n            updatedNodes.push(newNode)\n          }\n          \n          return {\n            ...prev,\n            nodes: updatedNodes,\n            currentNodeIndex: currentStepIndexRef.current\n          }\n        })\n        \n        // æ›´æ–°è¿è¡Œæ–‡æ¡ˆ\n        setCurrentRunningText(nextStep.runningTexts[0])\n        \n        // æ›´æ–°ä¼ªæ—¥å¿—åˆ†ç»„\n        startFakeLogRotation(nextStep.group)\n      }\n      \n      return\n    }\n\n    // èŠ‚ç‚¹å®Œæˆ\n    if (eventType === \"node_finished\" && data?.title) {\n      const nodeTitle = data.title\n      \n      if (shouldHideNode(nodeTitle)) return\n      \n      // ä¸éœ€è¦ç‰¹åˆ«å¤„ç†ï¼Œå› ä¸º node_started å·²ç»å¤„ç†äº†çŠ¶æ€è½¬æ¢\n      return\n    }\n\n    // å¤„ç†é”™è¯¯\n    if (eventType === \"error\") {\n      setIsProcessing(false)\n      stopAllRotations()\n      setWorkflowState(prev => ({\n        ...prev,\n        nodes: prev.nodes.map(node => ({\n          ...node,\n          status: node.status === \"running\" || node.status === \"preparing\" \n            ? \"error\" as WorkflowNodeStatus \n            : node.status\n        })),\n        isThinking: false,\n        isGenerating: false\n      }))\n      return\n    }\n  }, [startTextRotation, startFakeLogRotation, stopAllRotations, triggerHandover])\n\n  // é‡ç½®å·¥ä½œæµ\n  const resetWorkflow = useCallback(() => {\n    setIsProcessing(false)\n    stopAllRotations()\n    processedNodesRef.current.clear()\n    currentStepIndexRef.current = 0\n    fakeLogIndexRef.current = 0\n    hasTriggeredHandoverRef.current = false\n    setWorkflowState(createInitialState())\n  }, [stopAllRotations])\n\n  // åˆ‡æ¢å±•å¼€/æŠ˜å \n  const toggleExpanded = useCallback(() => {\n    setWorkflowState(prev => ({\n      ...prev,\n      isExpanded: !prev.isExpanded\n    }))\n  }, [])\n\n  // è·å–æŠ˜å æ€æ‘˜è¦æ–‡æœ¬\n  const getSummaryText = useCallback((): string => {\n    const { nodes, isGenerating } = workflowState\n    const completedCount = getCompletedCount(nodes)\n    const runningNode = getCurrentRunningNode(nodes)\n    const totalSteps = THINKING_STEPS.length\n    \n    if (isGenerating) {\n      return `âœ… å·²å®Œæˆ ${completedCount} ä¸ªè®¤çŸ¥æ­¥éª¤ï¼Œæ­£åœ¨ç”Ÿæˆæœ€ç»ˆè¯„è¯­...`\n    }\n    \n    if (nodes.length === 0) {\n      return \"ğŸ§  AI æ­£åœ¨æ€è€ƒä¸­...\"\n    }\n    \n    if (runningNode) {\n      return `ğŸ§  å·²å®Œæˆ ${completedCount}/${totalSteps} ä¸ªè®¤çŸ¥æ­¥éª¤ | å½“å‰ï¼š${runningNode.config.displayName}...`\n    }\n    \n    if (completedCount === totalSteps) {\n      return `âœ… ${completedCount} ä¸ªè®¤çŸ¥æ­¥éª¤å·²å®Œæˆ`\n    }\n    \n    return `ğŸ§  ${completedCount}/${totalSteps} æ­¥éª¤å·²å®Œæˆ`\n  }, [workflowState])\n\n  // æ‰‹åŠ¨æ ‡è®°å·¥ä½œæµå®Œæˆ\n  const markWorkflowComplete = useCallback(() => {\n    setIsProcessing(false)\n    stopAllRotations()\n    \n    // ç¡®ä¿æ‰€æœ‰å›ºå®šæ­¥éª¤éƒ½æ˜¾ç¤ºä¸ºå®Œæˆ\n    setWorkflowState(prev => {\n      const completedNodes: WorkflowNodeState[] = THINKING_STEPS.map((step: WorkflowNodeConfig, index: number) => {\n        const existingNode = prev.nodes.find(n => n.config.displayName === step.displayName)\n        return {\n          id: existingNode?.id || `node-complete-${index}`,\n          config: step,\n          status: \"completed\" as WorkflowNodeStatus,\n          currentTextIndex: 0,\n          startTime: existingNode?.startTime || Date.now() - (THINKING_STEPS.length - index) * 1000,\n          endTime: existingNode?.endTime || Date.now() - (THINKING_STEPS.length - index - 1) * 1000\n        }\n      })\n      \n      return {\n        ...prev,\n        nodes: completedNodes,\n        currentNodeIndex: THINKING_STEPS.length - 1,\n        isThinking: false,\n        isGenerating: false\n      }\n    })\n  }, [stopAllRotations])\n\n  return {\n    workflowState,\n    isProcessing,\n    isThinking: workflowState.isThinking,\n    isGenerating: workflowState.isGenerating,\n    handleSSEEvent,\n    resetWorkflow,\n    toggleExpanded,\n    getSummaryText,\n    markWorkflowComplete,\n    currentFakeLog,\n    currentRunningText,\n    triggerHandover\n  }\n}\n\nexport default useWorkflowVisualizer\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2188, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/pricing.ts"],"sourcesContent":["/**\n * ç»Ÿä¸€è®¡è´¹ä¸­å¿ƒ v2.0\n * \n * è®¡è´¹è§„åˆ™ï¼š\n * - æ™ºèƒ½ä½“ï¼ˆstandard, teaching-proï¼‰ï¼š10 ç§¯åˆ†/1K Token\n * - ç‹¬ç«‹æ¨¡å‹ï¼ˆgpt-5, claude-opus, gemini-pro ç­‰ï¼‰ï¼š20 ç§¯åˆ†/1K Token\n * - å¤šåª’ä½“æ¨¡å‹ï¼šæŒ‰æ¬¡å›ºå®šæ‰£è´¹ï¼ˆæˆæœ¬/0.4ï¼‰\n * \n * æ‰£è´¹æµç¨‹ï¼š\n * - å‰ç«¯ï¼šæ˜¾ç¤º\"é¢„è®¡æ¶ˆè€—\"ï¼ˆåŸºäºä¼°ç®— Token æ•°ï¼‰\n * - åç«¯ï¼šç­‰ Dify å›ç­”å®Œåæ ¹æ®å®é™… Token æ•°é™é»˜ç»“ç®—\n * \n * åˆ©æ¶¦ä¿éšœï¼š\n * - è±ªåä¼šå‘˜ 12,000 ç§¯åˆ†å…¨é¢æ¶ˆè€—æ—¶ï¼ŒVivaAPI æˆæœ¬å æ¯” â‰¤ 40%\n */\n\n// ============================================\n// 1. ç±»å‹å®šä¹‰\n// ============================================\n\nexport type ModelType = \n  | \"standard\" \n  | \"teaching-pro\"\n  | \"gpt-5\" \n  | \"claude-opus\" \n  | \"gemini-pro\" \n  | \"banana-2-pro\" \n  | \"suno-v5\" \n  | \"sora-2-pro\"\n\nexport type GenMode = \"text\" | \"image\" | \"music\" | \"video\"\n\n/** æ¨¡å‹ç±»åˆ«ï¼šæ™ºèƒ½ä½“ vs ç‹¬ç«‹æ¨¡å‹ */\nexport type ModelCategory = \"agent\" | \"standalone\" | \"media\"\n\ninterface ModelCostConfig {\n  /** æ¨¡å‹ç±»åˆ« */\n  category: ModelCategory\n  /** Token å•ä»·ï¼ˆç§¯åˆ†/1K tokensï¼‰ï¼Œä»…æ–‡æœ¬æ¨¡å‹æœ‰æ•ˆ */\n  tokenRate?: number\n  /** å›ºå®šæˆæœ¬ï¼ˆç”¨äºå¤šåª’ä½“æ¨¡å‹ï¼Œå•ä½ï¼šç§¯åˆ†ï¼‰ */\n  fixedCost?: number\n  /** æ¨¡å‹æ˜¾ç¤ºåç§° */\n  displayName: string\n  /** ç”Ÿæˆæ¨¡å¼ */\n  mode: GenMode\n  /** é¢„ä¼°å¹³å‡ Token æ•°ï¼ˆç”¨äºå‰ç«¯é¢„è§ˆï¼‰ */\n  estimatedTokens?: number\n}\n\n// ============================================\n// 2. è®¡è´¹é…ç½®\n// ============================================\n\n/** æ™ºèƒ½ä½“ Token å•ä»·ï¼š10 ç§¯åˆ†/1K Token */\nexport const AGENT_TOKEN_RATE = 10\n\n/** ç‹¬ç«‹æ¨¡å‹ Token å•ä»·ï¼š20 ç§¯åˆ†/1K Token */\nexport const STANDALONE_TOKEN_RATE = 20\n\n/** åˆ©æ¶¦ç‡ç³»æ•°ï¼ˆæˆæœ¬å æ¯” 40%ï¼Œåˆ©æ¶¦ 60%ï¼‰ */\nexport const PROFIT_MARGIN = 0.4\n\n/**\n * å„æ¨¡å‹é…ç½®\n */\nexport const MODEL_COSTS: Record<ModelType, ModelCostConfig> = {\n  // ========== æ™ºèƒ½ä½“ï¼ˆ10 ç§¯åˆ†/1K Tokenï¼‰==========\n  \"standard\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"ä½œæ–‡æ‰¹æ”¹æ™ºèƒ½ä½“\",\n    mode: \"text\",\n    estimatedTokens: 2000  // é¢„ä¼°å¹³å‡ 2K tokens\n  },\n  \"teaching-pro\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"æ•™å­¦è¯„æ™ºèƒ½åŠ©æ‰‹\",\n    mode: \"text\",\n    estimatedTokens: 2500  // é¢„ä¼°å¹³å‡ 2.5K tokens\n  },\n  \n  // ========== ç‹¬ç«‹æ¨¡å‹ï¼ˆ20 ç§¯åˆ†/1K Tokenï¼‰==========\n  \"gpt-5\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"ChatGPT 5.1\",\n    mode: \"text\",\n    estimatedTokens: 1500  // é¢„ä¼°å¹³å‡ 1.5K tokens\n  },\n  \"claude-opus\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Claude Opus 4.5\",\n    mode: \"text\",\n    estimatedTokens: 2000  // é¢„ä¼°å¹³å‡ 2K tokens\n  },\n  \"gemini-pro\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Gemini 3.0 Pro\",\n    mode: \"text\",\n    estimatedTokens: 1500  // é¢„ä¼°å¹³å‡ 1.5K tokens\n  },\n  \n  // ========== å¤šåª’ä½“æ¨¡å‹ï¼ˆæŒ‰æ¬¡å›ºå®šæ‰£è´¹ï¼‰==========\n  \"banana-2-pro\": { \n    category: \"media\",\n    fixedCost: 50,  // æˆæœ¬ 50 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 125 ç§¯åˆ†\n    displayName: \"Banana 2 Pro\",\n    mode: \"image\"\n  },\n  \"suno-v5\": { \n    category: \"media\",\n    fixedCost: 100, // æˆæœ¬ 100 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 250 ç§¯åˆ†\n    displayName: \"Suno V5\",\n    mode: \"music\"\n  },\n  \"sora-2-pro\": { \n    category: \"media\",\n    fixedCost: 300, // æˆæœ¬ 300 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 750 ç§¯åˆ†\n    displayName: \"Sora 2 Pro\",\n    mode: \"video\"\n  },\n}\n\n// ============================================\n// 3. è®¡è´¹å‡½æ•°\n// ============================================\n\n/**\n * è®¡ç®—é¢„ä¼°æ¶ˆè€—ï¼ˆå‰ç«¯é¢„è§ˆç”¨ï¼‰\n * \n * @param model - æ¨¡å‹ç±»å‹\n * @param options - å¯é€‰å‚æ•°\n * @returns é¢„ä¼°ç§¯åˆ†æ¶ˆè€—\n */\nexport function calculatePreviewCost(\n  model: ModelType,\n  options?: {\n    isLuxury?: boolean\n    estimatedInputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] æœªçŸ¥æ¨¡å‹: ${model}ï¼Œä½¿ç”¨é»˜è®¤ä»·æ ¼`)\n    return 20\n  }\n  \n  // å¤šåª’ä½“æ¨¡å‹ï¼šå›ºå®šä»·æ ¼\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // æ–‡æœ¬æ¨¡å‹ï¼šåŸºäºé¢„ä¼° Token æ•°è®¡ç®—\n  const estimatedTokens = options?.estimatedInputTokens || config.estimatedTokens || 1500\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // é¢„ä¼°æ¶ˆè€— = Token æ•° / 1000 * å•ä»·\n  const estimatedCost = Math.ceil((estimatedTokens / 1000) * tokenRate)\n  \n  return estimatedCost\n}\n\n/**\n * è®¡ç®—å®é™…æ‰£è´¹é‡‘é¢ï¼ˆåç«¯é™é»˜ç»“ç®—ç”¨ï¼‰\n * \n * @param model - æ¨¡å‹ç±»å‹\n * @param tokenUsage - å®é™… Token ä½¿ç”¨é‡\n * @returns åº”æ‰£ç§¯åˆ†æ•°\n */\nexport function calculateActualCost(\n  model: ModelType,\n  tokenUsage?: {\n    totalTokens?: number\n    inputTokens?: number\n    outputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] æœªçŸ¥æ¨¡å‹: ${model}ï¼Œä½¿ç”¨é»˜è®¤ä»·æ ¼`)\n    return 20\n  }\n  \n  // å¤šåª’ä½“æ¨¡å‹ï¼šå›ºå®šä»·æ ¼\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // æ–‡æœ¬æ¨¡å‹ï¼šæ ¹æ®å®é™… Token æ•°è®¡è´¹\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // ä¼˜å…ˆä½¿ç”¨ totalTokensï¼Œå¦åˆ™ä½¿ç”¨ input + output\n  let totalTokens = tokenUsage?.totalTokens || 0\n  if (!totalTokens && tokenUsage) {\n    totalTokens = (tokenUsage.inputTokens || 0) + (tokenUsage.outputTokens || 0)\n  }\n  \n  // å¦‚æœæ²¡æœ‰ Token ä¿¡æ¯ï¼Œä½¿ç”¨é¢„ä¼°å€¼\n  if (!totalTokens) {\n    totalTokens = config.estimatedTokens || 1500\n  }\n  \n  // å®é™…æ¶ˆè€— = Token æ•° / 1000 * å•ä»·\n  const actualCost = Math.ceil((totalTokens / 1000) * tokenRate)\n  \n  // æœ€ä½æ¶ˆè´¹ 5 ç§¯åˆ†\n  return Math.max(actualCost, 5)\n}\n\n/**\n * è·å–æ¨¡å‹æ˜¾ç¤ºåç§°\n */\nexport function getModelDisplayName(model: ModelType): string {\n  return MODEL_COSTS[model]?.displayName || model\n}\n\n/**\n * è·å–æ¨¡å‹ç”Ÿæˆæ¨¡å¼\n */\nexport function getModelMode(model: ModelType): GenMode {\n  return MODEL_COSTS[model]?.mode || \"text\"\n}\n\n/**\n * è·å–æ¨¡å‹ç±»åˆ«\n */\nexport function getModelCategory(model: ModelType): ModelCategory {\n  return MODEL_COSTS[model]?.category || \"agent\"\n}\n\n/**\n * è·å–æ¨¡å‹ Token å•ä»·\n */\nexport function getTokenRate(model: ModelType): number {\n  const config = MODEL_COSTS[model]\n  if (!config || config.category === \"media\") return 0\n  return config.tokenRate || AGENT_TOKEN_RATE\n}\n\n// ============================================\n// 4. ä¼šå‘˜é…ç½®\n// ============================================\n\n/** éè±ªåä¼šå‘˜æ¯æ—¥å…è´¹ä½¿ç”¨é«˜çº§æ¨¡å‹æ¬¡æ•° */\nexport const DAILY_FREE_LIMIT = 20\n\n/** è±ªåä¼šå‘˜ç§¯åˆ†é˜ˆå€¼ï¼ˆç§¯åˆ†è¶…è¿‡æ­¤å€¼è§†ä¸ºè±ªåä¼šå‘˜ï¼‰ */\nexport const LUXURY_THRESHOLD = 1000\n\n/** è±ªåä¼šå‘˜å¥—é¤ç§¯åˆ† */\nexport const LUXURY_CREDITS = 12000\n\n// ============================================\n// 5. åˆ©æ¶¦éªŒè¯å‡½æ•°\n// ============================================\n\n/**\n * éªŒè¯è±ªåä¼šå‘˜ç§¯åˆ†æ¶ˆè€—æ—¶çš„æˆæœ¬å æ¯”\n * \n * å‡è®¾è±ªåä¼šå‘˜ 12,000 ç§¯åˆ†å…¨éƒ¨ç”¨äºæ™ºèƒ½ä½“å¯¹è¯ï¼š\n * - ç”¨æˆ·æ¶ˆè€—ï¼š12,000 ç§¯åˆ†\n * - æŒ‰ 10 ç§¯åˆ†/1K Token è®¡ç®—ï¼Œå¯ä½¿ç”¨ 1,200K Tokens\n * - VivaAPI æˆæœ¬ï¼ˆå‡è®¾ 4 ç§¯åˆ†/1K Tokenï¼‰ï¼š4,800 ç§¯åˆ†\n * - æˆæœ¬å æ¯”ï¼š4,800 / 12,000 = 40%\n * \n * @returns æˆæœ¬å æ¯”æ˜¯å¦ â‰¤ 40%\n */\nexport function validateProfitMargin(): boolean {\n  // å‡è®¾ VivaAPI æˆæœ¬ä¸ºç”¨æˆ·ä»·æ ¼çš„ 40%\n  const vivaApiCostRate = PROFIT_MARGIN  // 0.4\n  \n  // æ™ºèƒ½ä½“åœºæ™¯\n  const agentUserRate = AGENT_TOKEN_RATE  // 10 ç§¯åˆ†/1K Token\n  const agentCostRate = agentUserRate * vivaApiCostRate  // 4 ç§¯åˆ†/1K Token\n  \n  // è±ªåä¼šå‘˜å…¨é¢æ¶ˆè€—\n  const totalCredits = LUXURY_CREDITS  // 12,000 ç§¯åˆ†\n  const totalTokens = totalCredits / agentUserRate * 1000  // 1,200,000 Tokens\n  const totalCost = (totalTokens / 1000) * agentCostRate  // 4,800 ç§¯åˆ†\n  \n  const costRatio = totalCost / totalCredits  // 0.4 = 40%\n  \n  console.log(`[åˆ©æ¶¦éªŒè¯] è±ªåä¼šå‘˜ ${totalCredits} ç§¯åˆ†æ¶ˆè€—:`)\n  console.log(`  - å¯ä½¿ç”¨ Token: ${totalTokens.toLocaleString()}`)\n  console.log(`  - VivaAPI æˆæœ¬: ${totalCost} ç§¯åˆ†`)\n  console.log(`  - æˆæœ¬å æ¯”: ${(costRatio * 100).toFixed(1)}%`)\n  \n  return costRatio <= PROFIT_MARGIN\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2387, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/enhanced-chat-interface.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { useState, useRef, useEffect, Suspense, useCallback } from \"react\"\nimport { useSearchParams, useRouter } from \"next/navigation\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { \n  Send, Paperclip, X, FileText, Copy, Loader2, Sparkles, User, Brain, AlertCircle, \n  ChevronDown, ChevronLeft, Bot, Film, Palette, AudioLines, ArrowDown, GraduationCap\n} from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { toast } from \"sonner\"\nimport { MessageBubble } from \"./MessageBubble\"\nimport { ChatInput } from \"./ChatInput\"\nimport { EmptyState } from \"./EmptyState\"\nimport { AIStatusIndicator } from \"@/components/ai/AIStatusIndicator\"\nimport { ModelSelector } from \"./ModelSelector\"\nimport { WorkflowVisualizer } from \"./WorkflowVisualizer\"\nimport { useWorkflowVisualizer } from \"@/hooks/useWorkflowVisualizer\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { brandColors, slateColors } from \"@/lib/design-tokens\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport { collapseSidebar, refreshCredits } from \"@/components/app-sidebar\"\nimport { \n  calculatePreviewCost, \n  ModelType, \n  GenMode,\n  MODEL_COSTS,\n  DAILY_FREE_LIMIT,\n  LUXURY_THRESHOLD,\n  getModelDisplayName\n} from \"@/lib/pricing\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuLabel\n} from \"@/components/ui/dropdown-menu\"\n\n// ğŸ”¥ å“ç‰Œæ·±ç»¿è‰²ï¼ˆå‚è€ƒä¸»é¡µæ ‡é¢˜ï¼‰\nconst BRAND_GREEN = \"#14532d\"\n\n// --- Supabase åˆå§‹åŒ– ---\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\n// --- ç±»å‹å®šä¹‰ ---\ntype UploadedFile = { name: string; type: string; size: number; data: string; preview?: string; difyFileId?: string }\ntype Message = { id: string; role: \"user\" | \"assistant\"; content: string }\ntype FileProcessingState = { status: \"idle\" | \"uploading\" | \"processing\" | \"recognizing\" | \"complete\" | \"error\"; progress: number; message: string }\n\n// --- è¾…åŠ©ç»„ä»¶ï¼šæ€è€ƒåŠ è½½å™¨ ---\nconst SimpleBrainLoader = () => (\n  <div className=\"flex items-center gap-3 py-4 px-4 bg-slate-50 rounded-2xl\">\n    <div className={`relative flex h-8 w-8 items-center justify-center rounded-xl bg-[${BRAND_GREEN}]/10`}>\n      <Brain className={`h-5 w-5 text-[${BRAND_GREEN}] animate-pulse`} />\n    </div>\n    <span className=\"text-sm text-slate-500 font-medium animate-pulse\">æ€è€ƒä¸­...</span>\n  </div>\n)\n\n// --- è¾…åŠ©ç»„ä»¶ï¼šæ–‡æœ¬æ¸²æŸ“å™¨ ---\nconst InlineText = ({ text }: { text: string }) => {\n  if (!text) return null;\n  const parts = text.split(/(\\*\\*.*?\\*\\*)/g);\n  return (\n    <>\n      {parts.map((part, index) => {\n        if (part.startsWith(\"**\") && part.endsWith(\"**\")) {\n          return <strong key={index} className={`font-semibold text-[${BRAND_GREEN}]`}>{part.slice(2, -2)}</strong>;\n        }\n        return <span key={index}>{part}</span>;\n      })}\n    </>\n  );\n};\n\n// TableBlock å¿…é¡»åœ¨ UltimateRenderer ä¹‹å‰å®šä¹‰\nconst TableBlock = ({ lines }: { lines: string[] }) => {\n  if (lines.length < 2) return null;\n  try {\n    const headerLine = lines.find(l => l.includes(\"|\") && !l.includes(\"---\"));\n    const bodyLines = lines.filter(l => l.includes(\"|\") && !l.includes(\"---\") && l !== headerLine);\n    if (!headerLine) return null;\n    const headers = headerLine.split(\"|\").filter(c => c.trim()).map(c => c.trim());\n    return (\n      <div className=\"my-4 overflow-hidden rounded-xl border border-slate-100 bg-white\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-slate-100\">\n            <thead className=\"bg-slate-50\"><tr>{headers.map((h, i) => (<th key={i} className=\"px-4 py-2.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">{h}</th>))}</tr></thead>\n            <tbody className=\"divide-y divide-slate-50\">{bodyLines.map((line, i) => { const cells = line.split(\"|\").filter(c => c.trim()).map(c => c.trim()); return (<tr key={i} className=\"hover:bg-slate-50/50 transition-colors\">{cells.map((cell, j) => (<td key={j} className=\"px-4 py-2.5 text-sm text-slate-600\"><InlineText text={cell} /></td>))}</tr>); })}</tbody>\n          </table>\n        </div>\n      </div>\n    );\n  } catch (e) { return null; }\n};\n\nfunction UltimateRenderer({ content }: { content: string }) {\n  if (!content) return <span className={`animate-pulse text-[${BRAND_GREEN}]`}>â–Œ</span>;\n  const lines = content.split(\"\\n\");\n  const renderedElements = [];\n  let tableBuffer: string[] = [];\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const isTableLine = line.trim().startsWith(\"|\") && line.includes(\"|\");\n    if (isTableLine) {\n      tableBuffer.push(line);\n      if (i === lines.length - 1 || !lines[i + 1].trim().startsWith(\"|\")) {\n        renderedElements.push(<TableBlock key={`tbl-${i}`} lines={tableBuffer} />);\n        tableBuffer = [];\n      }\n      continue;\n    }\n    if (line.trim().startsWith(\"# \")) {\n      renderedElements.push(<h1 key={i} className=\"mt-8 mb-4 text-xl font-bold text-slate-800\">{line.replace(/^#\\s+/, \"\")}</h1>);\n    } else if (line.trim().startsWith(\"## \")) {\n      renderedElements.push(<h2 key={i} className={`mt-6 mb-3 text-lg font-semibold text-slate-700 flex items-center gap-2`}><span className={`w-1 h-5 bg-[${BRAND_GREEN}] rounded-full`}></span>{line.replace(/^##\\s+/, \"\")}</h2>);\n    } else if (line.trim().startsWith(\"### \")) {\n      renderedElements.push(<h3 key={i} className={`mt-5 mb-2 text-base font-semibold text-[${BRAND_GREEN}]`}>{line.replace(/^###\\s+/, \"\")}</h3>);\n    } else if (line.trim().startsWith(\"- \")) {\n      renderedElements.push(<div key={i} className=\"flex gap-2.5 ml-1 my-2 text-[15px] text-slate-600 leading-relaxed\"><div className={`mt-2 w-1.5 h-1.5 rounded-full bg-[${BRAND_GREEN}]/60 shrink-0`}></div><span><InlineText text={line.replace(/^- /, \"\")} /></span></div>);\n    } else if (line.trim().startsWith(\"> \")) {\n      renderedElements.push(<blockquote key={i} className={`my-4 border-l-2 border-[${BRAND_GREEN}] bg-[${BRAND_GREEN}]/5 px-4 py-3 rounded-r-xl`}><div className=\"text-[15px] text-slate-600 leading-relaxed\"><InlineText text={line.replace(/^> /, \"\")} /></div></blockquote>);\n    } else if (line.trim() === \"---\") {\n      renderedElements.push(<div key={i} className=\"py-4\"><div className=\"h-px bg-slate-100\"></div></div>);\n    } else if (line.trim() === \"\") {\n      renderedElements.push(<div key={i} className=\"h-3\"></div>);\n    } else {\n      renderedElements.push(<p key={i} className=\"text-[15px] leading-[1.8] text-slate-600 my-2\"><InlineText text={line} /></p>);\n    }\n  }\n  return <div className=\"w-full\">{renderedElements}</div>;\n}\n\n// --- å†…éƒ¨èŠå¤©æ ¸å¿ƒç»„ä»¶ ---\nfunction ChatInterfaceInner() {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const urlSessionId = searchParams.get(\"id\")\n  const urlAgent = searchParams.get(\"agent\")\n\n  const [userId, setUserId] = useState<string>(\"\")\n  const [userAvatar, setUserAvatar] = useState<string>(\"\")\n  const [userCredits, setUserCredits] = useState<number>(0)\n  const sessionIdRef = useRef<string | null>(null)\n  const [currentSessionId, setCurrentSessionId] = useState<string>(\"\")\n\n  const [selectedModel, setSelectedModel] = useState<ModelType>(\"standard\")\n  const [genMode, setGenMode] = useState<GenMode>(\"text\")\n  \n  const [dailyUsage, setDailyUsage] = useState<number>(0)\n  const DAILY_LIMIT = 20\n\n  const isLuxury = userCredits > 1000 \n\n  // ğŸ¯ å·¥ä½œæµå¯è§†åŒ– Hook\n  const {\n    workflowState,\n    isProcessing: isWorkflowProcessing,\n    handleSSEEvent,\n    resetWorkflow,\n    toggleExpanded,\n    getSummaryText,\n    markWorkflowComplete,\n    currentFakeLog,\n    currentRunningText\n  } = useWorkflowVisualizer()\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const userStr = localStorage.getItem('currentUser')\n      if (userStr) {\n        try {\n          const user = JSON.parse(userStr)\n          const uid = user.id || user.sub || user.userId || \"\"\n          console.log(\"ğŸ”‘ [ç”¨æˆ·åˆå§‹åŒ–] è§£æç”¨æˆ·:\", { \n            id: user.id, \n            sub: user.sub, \n            userId: user.userId,\n            finalUid: uid \n          })\n          setUserId(uid)\n          if (user.user_metadata?.avatar_url) setUserAvatar(user.user_metadata.avatar_url)\n          if (uid) fetchCredits(uid)\n        } catch (e) {\n          console.error(\"âŒ [ç”¨æˆ·åˆå§‹åŒ–] è§£æå¤±è´¥:\", e)\n        }\n      } else {\n        console.warn(\"âš ï¸ [ç”¨æˆ·åˆå§‹åŒ–] localStorage ä¸­æ—  currentUser\")\n      }\n    }\n  }, [])\n\n  const fetchCredits = async (uid: string) => {\n    console.log(\"ğŸ’° [ç§¯åˆ†æŸ¥è¯¢] æŸ¥è¯¢ç”¨æˆ·:\", uid)\n    const { data, error } = await supabase.from('user_credits').select('credits').eq('user_id', uid).single()\n    if (error) {\n      console.error(\"âŒ [ç§¯åˆ†æŸ¥è¯¢] å¤±è´¥:\", error)\n    } else if (data) {\n      console.log(\"âœ… [ç§¯åˆ†æŸ¥è¯¢] æˆåŠŸ:\", data.credits)\n      setUserCredits(data.credits)\n    } else {\n      console.warn(\"âš ï¸ [ç§¯åˆ†æŸ¥è¯¢] æ— æ•°æ®\")\n    }\n  }\n\n  useEffect(() => {\n    if (urlSessionId && urlSessionId !== currentSessionId) {\n       loadHistorySession(urlSessionId)\n    }\n  }, [urlSessionId])\n\n  const prevUrlAgentRef = useRef<string | null>(null)\n  \n  useEffect(() => {\n    const agentToModel: Record<string, ModelType> = {\n      \"teaching-pro\": \"teaching-pro\",\n      \"standard\": \"standard\",\n    }\n    \n    const targetModel = urlAgent ? (agentToModel[urlAgent] || \"standard\") : \"standard\"\n    \n    console.log(`ğŸ”— [URL Sync] urlAgent=${urlAgent}, prevUrlAgent=${prevUrlAgentRef.current}, targetModel=${targetModel}`)\n    \n    if (urlAgent !== prevUrlAgentRef.current) {\n      prevUrlAgentRef.current = urlAgent\n      \n      console.log(`ğŸ”„ [å¼ºåˆ¶æ¨¡å‹åŒæ­¥] â†’ ${targetModel}`)\n      setSelectedModel(targetModel)\n      setGenMode(\"text\")\n      \n      if (!urlSessionId) {\n        setMessages([])\n        sessionIdRef.current = null\n        setCurrentSessionId(\"\")\n      }\n    }\n  }, [urlAgent, urlSessionId])\n\n  const loadHistorySession = async (sid: string) => {\n    setIsLoading(true)\n    setMessages([]) \n    try {\n      const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('session_id', sid)\n        .order('created_at', { ascending: true })\n      \n      if (error) throw error\n\n      if (data && data.length > 0) {\n        const historyMessages = data.map((m: any) => ({\n           id: m.id,\n           role: m.role,\n           content: m.content\n        }))\n        setMessages(historyMessages)\n        setCurrentSessionId(sid)\n        sessionIdRef.current = sid\n      }\n    } catch (e) {\n      console.error(\"åŠ è½½å†å²ä¼šè¯å¤±è´¥:\", e)\n      toast.error(\"åŠ è½½å†å²ä¼šè¯å¤±è´¥\")\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const [messages, setMessages] = useState<Message[]>([])\n  const [input, setInput] = useState(\"\")\n  const [isLoading, setIsLoading] = useState(false)\n  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([])\n  const [fileProcessing, setFileProcessing] = useState<FileProcessingState>({ status: \"idle\", progress: 0, message: \"\" })\n  const [isComplexMode, setIsComplexMode] = useState(false)\n  const [analysisStage, setAnalysisStage] = useState(0)\n\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n  \n  // ğŸ”¥ æ™ºèƒ½æ»šåŠ¨çŠ¶æ€\n  const [isNearBottom, setIsNearBottom] = useState(true)\n  const [hasNewMessage, setHasNewMessage] = useState(false)\n\n  // æ£€æµ‹æ˜¯å¦åœ¨åº•éƒ¨é™„è¿‘\n  const handleScroll = () => {\n    if (scrollAreaRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = scrollAreaRef.current\n      const isNear = scrollHeight - scrollTop - clientHeight < 100\n      setIsNearBottom(isNear)\n      if (isNear) setHasNewMessage(false)\n    }\n  }\n\n  // æ»šåŠ¨åˆ°åº•éƒ¨çš„å‡½æ•°\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    setHasNewMessage(false)\n  }\n\n  // æ–°æ¶ˆæ¯æ—¶çš„æ™ºèƒ½æ»šåŠ¨å¤„ç†\n  useEffect(() => {\n    if (isNearBottom) {\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    } else if (messages.length > 0) {\n      setHasNewMessage(true)\n    }\n  }, [messages, isNearBottom])\n  useEffect(() => { if (isLoading && isComplexMode && analysisStage < 4) setTimeout(() => setAnalysisStage(p => Math.min(p + 1, 4)), 2000) }, [isLoading, analysisStage, isComplexMode])\n\n  // --- æ¨¡å‹é…ç½®ï¼ˆå¢å¼ºç‰ˆï¼šæ·»åŠ æè¿°å’Œæ ‡ç­¾ï¼‰ ---\n  const modelConfig = {\n    \"standard\": { \n      name: \"ä½œæ–‡æ‰¹æ”¹\", \n      icon: Sparkles, \n      color: BRAND_GREEN,\n      description: \"ä¸“ä¸šä½œæ–‡åˆ†æä¸ç‚¹è¯„\",\n      badge: \"æ¨è\",\n      group: \"æ•™è‚²ä¸“ç”¨\"\n    },\n    \"teaching-pro\": { \n      name: \"æ•™å­¦è¯„åŠ©æ‰‹\", \n      icon: Brain, \n      color: \"#7c3aed\",\n      description: \"æ•™å­¦è¯„ä¼°ä¸åé¦ˆ\",\n      group: \"æ•™è‚²ä¸“ç”¨\"\n    },\n    \"gpt-5\": { \n      name: \"ChatGPT 5.1\", \n      icon: Bot, \n      color: \"#16a34a\",\n      description: \"é€šç”¨æ™ºèƒ½å¯¹è¯\",\n      badge: \"æ–°\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"claude-opus\": { \n      name: \"Claude Opus 4.5\", \n      icon: Bot, \n      color: \"#ea580c\",\n      description: \"æ·±åº¦æ¨ç†ä¸åˆ†æ\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"gemini-pro\": { \n      name: \"Gemini 3.0 Pro\", \n      icon: Sparkles, \n      color: \"#2563eb\",\n      description: \"å¤šæ¨¡æ€ç†è§£\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"banana-2-pro\": { \n      name: \"Banana 2 Pro\", \n      icon: Palette, \n      color: \"#ca8a04\",\n      description: \"AI å›¾åƒç”Ÿæˆ\",\n      badge: \"çƒ­é—¨\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n    \"suno-v5\": { \n      name: \"Suno V5\", \n      icon: AudioLines, \n      color: \"#db2777\",\n      description: \"AI éŸ³ä¹åˆ›ä½œ\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n    \"sora-2-pro\": { \n      name: \"Sora 2 Pro\", \n      icon: Film, \n      color: \"#4f46e5\",\n      description: \"AI è§†é¢‘ç”Ÿæˆ\",\n      badge: \"Pro\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n  }\n\n  // ğŸ”¥ è½¬æ¢ä¸º ModelSelector éœ€è¦çš„æ ¼å¼\n  const modelList = Object.entries(modelConfig).map(([key, config]) => ({\n    key,\n    name: config.name,\n    icon: config.icon,\n    color: config.color,\n    description: config.description,\n    badge: (config as any).badge,\n    group: config.group\n  }))\n\n  const handleModelChange = (model: ModelType) => {\n    if (model !== selectedModel) {\n      sessionIdRef.current = null\n      setCurrentSessionId(\"\")\n      setMessages([])\n      console.log(`ğŸ”„ [æ¨¡å‹åˆ‡æ¢] ${selectedModel} â†’ ${model}ï¼Œå·²æ¸…é™¤ä¼šè¯`)\n    }\n    \n    if (model !== \"standard\") {\n      if (isLuxury) {\n        toast.success(`å·²åˆ‡æ¢è‡³ ${modelConfig[model].name}`)\n      } else {\n        if (dailyUsage < DAILY_LIMIT) {\n          toast.info(`å·²åˆ‡æ¢è‡³ ${modelConfig[model].name}`, { description: `ä»Šæ—¥å…è´¹: ${dailyUsage}/${DAILY_LIMIT}` })\n        } else {\n          toast.warning(`ä»Šæ—¥å…è´¹é¢åº¦å·²ç”¨å®Œ`)\n        }\n      }\n    }\n    \n    if (model === \"banana-2-pro\") setGenMode(\"image\")\n    else if (model === \"suno-v5\") setGenMode(\"music\")\n    else if (model === \"sora-2-pro\") setGenMode(\"video\")\n    else setGenMode(\"text\")\n\n    setSelectedModel(model)\n    \n    if (model === \"standard\" || model === \"teaching-pro\") {\n      const newUrl = model === \"standard\" ? '/chat' : `/chat?agent=${model}`\n      console.log(`ğŸ”— [URL åŒæ­¥] ä¸‹æ‹‰æ¡†åˆ‡æ¢ â†’ ${newUrl}`)\n      router.push(newUrl, { scroll: false })\n    }\n    \n    if (input === \"\" || input.startsWith(\"ç”Ÿæˆ\")) {\n       setInput(\"\")\n    }\n  }\n\n  const calculateCost = () => {\n    if (!userId) return 0\n    return calculatePreviewCost(selectedModel, {\n      isLuxury,\n      estimatedInputTokens: input.length > 0 ? Math.ceil(input.length / 4) * 2 : undefined\n    })\n  }\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files; \n    if (!files || !files.length) return;\n    \n    // ğŸ”¥ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n    if (!userId) {\n      toast.error(\"è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶\")\n      return\n    }\n    \n    setFileProcessing({ status: \"uploading\", progress: 0, message: \"æ­£åœ¨å¤„ç†...\" })\n    \n    try {\n        const uploadPromises = Array.from(files).map(async (file) => {\n            const fileToUpload = file;\n\n            const formData = new FormData(); \n            formData.append(\"file\", fileToUpload); \n            formData.append(\"user\", userId)\n            \n            // ğŸ”¥ æ·»åŠ  X-User-Id header ä»¥é€šè¿‡ middleware éªŒè¯\n            const res = await fetch(\"/api/dify-upload\", { \n              method: \"POST\", \n              headers: {\n                \"X-User-Id\": userId\n              },\n              body: formData \n            })\n            \n            if (!res.ok) {\n                const errText = await res.text();\n                throw new Error(`ä¸Šä¼ å¤±è´¥: ${res.status} ${errText}`);\n            }\n            \n            const data = await res.json()\n            return new Promise<UploadedFile>((resolve) => {\n                if (fileToUpload.type.startsWith(\"image/\")) {\n                    resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: \"\", \n                        difyFileId: data.id, \n                        preview: URL.createObjectURL(fileToUpload) \n                    });\n                } else {\n                    const reader = new FileReader(); \n                    reader.onload = e => resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: e.target?.result as string, \n                        difyFileId: data.id, \n                        preview: undefined \n                    });\n                    reader.readAsDataURL(fileToUpload)\n                }\n            })\n        });\n        \n        const results = await Promise.all(uploadPromises);\n        setUploadedFiles(p => [...p, ...results]);\n        setFileProcessing({ status: \"idle\", progress: 100, message: \"å®Œæˆ\" })\n        setTimeout(() => setFileProcessing({ status: \"idle\", progress: 0, message: \"\" }), 1000)\n    } catch(e: any) {\n        console.error(\"ä¸Šä¼ é”™è¯¯:\", e);\n        toast.error(\"ä¸Šä¼ å¤±è´¥\")\n        setFileProcessing({ status: \"error\", progress: 0, message: \"ä¸Šä¼ å¤±è´¥\" })\n    }\n    if(fileInputRef.current) fileInputRef.current.value=\"\"\n  }\n\n  const removeFile = (i: number) => setUploadedFiles(p => p.filter((_, idx) => idx !== i))\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault(); if (!userId) { toast.error(\"è¯·ç™»å½•\"); return }\n    const txt = (input || \"\").trim(); if (!txt && !uploadedFiles.length) return\n    \n    console.log(\"ğŸ“¤ [onSubmit] å‘é€æ¶ˆæ¯:\", {\n      model: selectedModel,\n      mode: genMode,\n      query: txt.slice(0, 50) + \"...\",\n      urlAgent,\n      sessionId: sessionIdRef.current\n    })\n    \n    const cost = calculateCost()\n    if (userCredits < cost) {\n      toast.error(\"ç§¯åˆ†ä¸è¶³\", { \n        description: `éœ€è¦ ${cost} ç§¯åˆ†ï¼Œå½“å‰ ${userCredits}`,\n        duration: 2000\n      })\n      setTimeout(() => {\n        router.push(\"/pricing\")\n      }, 1500)\n      return\n    }\n\n    setFileProcessing({ status: \"idle\", progress: 0, message: \"\" })\n    setIsLoading(true); setAnalysisStage(0); \n    setIsComplexMode(uploadedFiles.length > 0 || txt.length > 150)\n    \n    // ğŸ¯ é‡ç½®å·¥ä½œæµå¯è§†åŒ–çŠ¶æ€\n    resetWorkflow()\n    \n    // ğŸ”¥ è‡ªåŠ¨æŠ˜å ä¾§è¾¹æ ï¼Œè¿›å…¥ä¸“æ³¨æ¨¡å¼\n    collapseSidebar()\n    \n    let sid = currentSessionId; \n    if (!sid && !urlSessionId) { \n        sid = Date.now().toString(); \n        setCurrentSessionId(sid);\n        sessionIdRef.current = sid;\n    } else if (urlSessionId) {\n        sid = urlSessionId\n        sessionIdRef.current = urlSessionId\n    }\n\n    const userMsg: Message = { id: Date.now().toString(), role: \"user\", content: txt || \"æ‰¹æ”¹ä½œæ–‡\" }\n    setMessages(p => [...p, userMsg]); setInput(\"\"); setUploadedFiles([])\n    \n    const preview = userMsg.content.slice(0, 30)\n    const { data: existing } = await supabase.from('chat_sessions').select('id').eq('id', sid).single()\n    if (!existing) {\n        await supabase.from('chat_sessions').insert({ id: sid, user_id: userId, title: userMsg.content.slice(0, 10)|| \"ä½œæ–‡\", preview })\n    } else {\n        await supabase.from('chat_sessions').update({ preview }).eq('id', sid)\n    }\n    await supabase.from('chat_messages').insert({ session_id: sid, role: \"user\", content: userMsg.content })\n\n    const botId = (Date.now()+1).toString(); setMessages(p => [...p, { id: botId, role: \"assistant\", content: \"\" }])\n    \n    let fullText = \"\"; let hasRec = false\n    try {\n        const fileIds = uploadedFiles.map(f => f.difyFileId).filter(Boolean)\n        const res = await fetch(\"/api/dify-chat\", {\n            method: \"POST\", \n            headers: { \n              \"Content-Type\": \"application/json\",\n              \"X-User-Id\": userId\n            },\n            body: JSON.stringify({ \n              query: userMsg.content, \n              fileIds, \n              userId, \n              conversation_id: sessionIdRef.current, \n              model: selectedModel,\n              mode: genMode\n            })\n        })\n        if (res.status === 402) throw new Error(\"ç§¯åˆ†ä¸è¶³\")\n        if (!res.ok) throw new Error(\"è¯·æ±‚å¤±è´¥\")\n        \n        const reader = res.body?.getReader(); \n        const decoder = new TextDecoder();\n        let buffer = \"\"; \n\n        while (true) {\n            const { done, value } = await reader!.read(); \n            if (done) break;\n            \n            buffer += decoder.decode(value, { stream: true });\n            const lines = buffer.split(\"\\n\");\n            buffer = lines.pop() || \"\";\n\n            for (const line of lines) {\n                if (!line.startsWith(\"data: \")) continue\n                const data = line.slice(6).trim(); if (data === \"[DONE]\") continue\n                try {\n                    const json = JSON.parse(data)\n                    \n                    // ğŸ¯ å·¥ä½œæµäº‹ä»¶å¤„ç† - ä¼ é€’ç»™å¯è§†åŒ– Hook\n                    if (json.event) {\n                      handleSSEEvent({\n                        event: json.event,\n                        data: {\n                          node_id: json.node_id,\n                          title: json.title,\n                          status: json.status,\n                          workflow_run_id: json.workflow_run_id\n                        }\n                      })\n                    }\n                    \n                    if (json.conversation_id && sessionIdRef.current !== json.conversation_id) {\n                        sessionIdRef.current = json.conversation_id\n                    }\n                    if (json.answer) {\n                        if (!hasRec) setAnalysisStage(4); hasRec = true; fullText += json.answer\n                        setMessages(p => p.map(m => m.id === botId ? { ...m, content: fullText } : m))\n                    }\n                } catch {}\n            }\n        }\n        if (hasRec) await supabase.from('chat_messages').insert({ session_id: sid, role: \"assistant\", content: fullText })\n        \n        setUserCredits(prev => prev - cost)\n        if (selectedModel !== \"standard\" && !isLuxury && dailyUsage < DAILY_LIMIT) {\n          setDailyUsage(prev => prev + 1)\n        }\n\n    } catch (e: any) {\n        toast.error(e.message || \"å‡ºé”™äº†\"); setMessages(p => p.filter(m => m.id !== botId))\n    } finally { \n      setIsLoading(false)\n      // ğŸ¯ æ ‡è®°å·¥ä½œæµå®Œæˆ\n      markWorkflowComplete()\n      \n      // ğŸ”¥ ç§¯åˆ†åˆ·æ–°ï¼šå¯¹è¯ç»“æŸåè§¦å‘å…¨å±€ç§¯åˆ†åˆ·æ–°\n      console.log(\"ğŸ”„ [ç§¯åˆ†åˆ·æ–°] å¯¹è¯ç»“æŸï¼Œè§¦å‘ç§¯åˆ†é‡æ–°æŸ¥è¯¢...\")\n      if (userId) {\n        fetchCredits(userId)\n      }\n      // ğŸ”¥ è§¦å‘ä¾§è¾¹æ ç§¯åˆ†åˆ·æ–°\n      refreshCredits()\n      console.log(\"âœ… [ç§¯åˆ†åˆ·æ–°] å·²è§¦å‘å…¨å±€ç§¯åˆ†åˆ·æ–°äº‹ä»¶\")\n      \n      router.refresh()\n      \n      if (genMode !== \"text\") {\n        setGenMode(\"text\")\n        setSelectedModel(\"standard\")\n      }\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) { e.preventDefault(); onSubmit(e as unknown as React.FormEvent) }\n  }\n\n  // ğŸ”¥ è¿”å›æŒ‰é’®\n  const handleBack = () => {\n    router.push(\"/\")\n  }\n\n  return (\n    <div className=\"flex h-screen w-full bg-white overflow-hidden relative\">\n      <div className=\"flex flex-1 flex-col h-full relative min-w-0\">\n        \n        {/* ğŸ”¥ é¡¶éƒ¨å¯¼èˆªæ  - ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ˜¾ç¤ºè¿”å›æŒ‰é’® */}\n        <div className=\"flex items-center h-14 px-4 border-b border-slate-100 bg-white shrink-0\">\n          <button \n            onClick={handleBack}\n            className=\"flex items-center gap-1 text-slate-600 hover:text-slate-800 transition-colors\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n            <span className=\"text-sm font-medium\">è¿”å›</span>\n          </button>\n          <div className=\"flex-1 text-center md:text-left md:ml-4\">\n            <span className=\"text-sm font-medium text-slate-700\">{modelConfig[selectedModel].name}</span>\n          </div>\n          <div className=\"w-16 md:hidden\" />\n        </div>\n\n        {/* ğŸ”¥ æ»šåŠ¨åŒºåŸŸä¼˜åŒ– */}\n        <div className=\"flex-1 h-0 relative overflow-hidden\">\n          <div \n            ref={scrollAreaRef}\n            onScroll={handleScroll}\n            className=\"h-full overflow-y-auto custom-scrollbar\"\n          >\n            <div className=\"mx-auto max-w-3xl px-4 md:px-6 lg:px-10 py-6 md:py-8\">\n              {messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-12 md:py-16 text-center animate-in fade-in duration-500\">\n                  <div className=\"mb-6 flex h-14 w-14 items-center justify-center rounded-2xl\" style={{ backgroundColor: `${BRAND_GREEN}15` }}>\n                    <GraduationCap className=\"h-7 w-7\" style={{ color: BRAND_GREEN }} />\n                  </div>\n                  <h1 className=\"text-xl font-semibold text-slate-800\">æ¬¢è¿ä½¿ç”¨æ²ˆç¿”æ™ºå­¦</h1>\n                </div>\n              ) : (\n                <div className=\"space-y-6 pt-4\">\n                  {messages.map((message) => (\n                    <div key={message.id} className={cn(\"flex gap-3\", message.role === \"user\" ? \"justify-end\" : \"justify-start\")}>\n                      {message.role === \"assistant\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl text-white mt-1\" style={{ backgroundColor: BRAND_GREEN }}>\n                          <Sparkles className=\"h-4 w-4\" />\n                        </div>\n                      )}\n                      <div className={cn(\n                        \"relative rounded-2xl px-4 py-3\",\n                        message.role === \"user\" \n                          ? \"text-white max-w-[75%]\" \n                          : \"bg-slate-50 w-full max-w-full\"\n                      )} style={message.role === \"user\" ? { backgroundColor: BRAND_GREEN } : {}}>\n                        {message.role === \"user\" ? (\n                          <div className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{message.content}</div>\n                        ) : (\n                           <>\n                             {/* ğŸ¯ å·¥ä½œæµå¯è§†åŒ–é¢æ¿ - åœ¨ AI å›å¤ä¸Šæ–¹æ˜¾ç¤º */}\n                             {(isWorkflowProcessing || workflowState.nodes.length > 0) && (\n                               <WorkflowVisualizer\n                                 workflowState={workflowState}\n                                 isProcessing={isWorkflowProcessing}\n                                 onToggleExpanded={toggleExpanded}\n                                 summaryText={getSummaryText()}\n                                 currentFakeLog={currentFakeLog}\n                                 currentRunningText={currentRunningText}\n                                 className=\"mb-4\"\n                               />\n                             )}\n                             {isLoading && !message.content ? (\n                                <SimpleBrainLoader />\n                             ) : <UltimateRenderer content={message.content} />}\n                           </>\n                        )}\n                        {message.role === \"assistant\" && message.content && (\n                          <div className=\"mt-4 flex items-center justify-end border-t border-slate-100 pt-3\">\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-1.5 text-xs text-slate-400 hover:bg-slate-100\" style={{ ['--hover-color' as any]: BRAND_GREEN }} onClick={() => navigator.clipboard.writeText(message.content).then(() => toast.success(\"å·²å¤åˆ¶\"))}>\n                               <Copy className=\"h-3 w-3\" /> å¤åˆ¶\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                      {message.role === \"user\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-slate-200 mt-1 overflow-hidden\">\n                          {userAvatar ? (\n                            <img src={userAvatar} alt=\"Me\" className=\"h-full w-full object-cover\" />\n                          ) : (\n                            <User className=\"h-4 w-4 text-slate-500\" />\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* ğŸ”¥ æ–°æ¶ˆæ¯æç¤ºæŒ‰é’® */}\n          <AnimatePresence>\n            {hasNewMessage && (\n              <motion.button\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                onClick={scrollToBottom}\n                className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 text-white text-sm rounded-full shadow-lg flex items-center gap-2 hover:opacity-90 transition-all\"\n                style={{ backgroundColor: BRAND_GREEN }}\n              >\n                <ArrowDown className=\"w-4 h-4\" />\n                æ–°æ¶ˆæ¯\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* ğŸ”¥ è¾“å…¥æ¡†åŒºåŸŸ */}\n        <div className=\"border-t border-slate-100 bg-white p-3 md:p-6 shrink-0 z-20\">\n          <div className=\"mx-auto max-w-3xl\">\n            {fileProcessing.status !== \"idle\" && (\n              <div className=\"mb-3 rounded-xl bg-slate-50 p-3 animate-in slide-in-from-bottom-2\">\n                <div className=\"flex items-center gap-2\">\n                  {fileProcessing.status === \"error\" ? <AlertCircle className=\"h-4 w-4 text-red-500\" /> : <Loader2 className=\"h-4 w-4 animate-spin\" style={{ color: BRAND_GREEN }} />}\n                  <p className=\"text-sm text-slate-600\">{fileProcessing.message}</p>\n                </div>\n              </div>\n            )}\n            {uploadedFiles.length > 0 && (\n              <div className=\"mb-3 flex flex-wrap gap-2\">\n                {uploadedFiles.map((f, i) => (\n                  <div key={i} className=\"flex items-center gap-2 rounded-lg bg-slate-50 px-3 py-1.5 text-sm\">\n                    <FileText className=\"h-4 w-4\" style={{ color: BRAND_GREEN }} />\n                    <span className=\"max-w-[100px] truncate text-slate-600\">{f.name}</span>\n                    <button onClick={() => removeFile(i)} className=\"text-slate-400 hover:text-red-500\"><X className=\"h-3.5 w-3.5\" /></button>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* ğŸ”¥ å¢å¼ºé˜´å½± + æ¢å¤æ™ºèƒ½ä½“ä¸‹æ‹‰æ¡† */}\n            <form onSubmit={onSubmit} className=\"relative rounded-[24px] bg-white shadow-[0_2px_8px_rgba(0,0,0,0.04),0_8px_24px_rgba(0,0,0,0.08),0_16px_48px_rgba(0,0,0,0.08),0_24px_64px_rgba(0,0,0,0.06),0_32px_80px_rgba(0,0,0,0.04)] border border-slate-100 transition-all duration-300 ease-[cubic-bezier(0.32,0.72,0,1)] focus-within:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_32px_rgba(0,0,0,0.12),0_20px_56px_rgba(0,0,0,0.12),0_28px_72px_rgba(0,0,0,0.08),0_36px_88px_rgba(0,0,0,0.06)]\" style={{ ['--focus-border' as any]: `${BRAND_GREEN}33` }}>\n              \n              {/* ğŸ”¥ ä½¿ç”¨å¢å¼ºç‰ˆ ModelSelector ç»„ä»¶ */}\n              <div className=\"flex items-center px-3 py-2 border-b border-slate-50\">\n                <ModelSelector\n                  selectedModel={selectedModel}\n                  onModelChange={(model) => handleModelChange(model as ModelType)}\n                  models={modelList}\n                  disabled={isLoading}\n                  dailyFreeInfo={{ used: dailyUsage, total: DAILY_LIMIT }}\n                />\n              </div>\n              \n              <div className=\"flex items-end gap-2 p-3\">\n                {/* æ–‡ä»¶ä¸Šä¼ æŒ‰é’® */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">æ–‡ä»¶ä¸Šä¼ </span>\n                  <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-10 w-10 rounded-xl text-slate-400 hover:bg-slate-50\" onClick={() => fileInputRef.current?.click()} disabled={isLoading}>\n                    <Paperclip className=\"h-5 w-5\" />\n                  </Button>\n                </div>\n                <input ref={fileInputRef} type=\"file\" className=\"hidden\" accept=\"image/*,.txt,.doc,.docx,.pdf\" multiple onChange={handleFileUpload} />\n                \n                <Textarea\n                  ref={textareaRef}\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  placeholder={userId ? \"è¾“å…¥å†…å®¹å¼€å§‹å¯¹è¯...\" : \"è¯·å…ˆç™»å½•...\"}\n                  className=\"min-h-[48px] max-h-[160px] flex-1 resize-none border-0 bg-transparent p-2 text-[15px] text-slate-700 placeholder:text-slate-400 focus-visible:ring-0 leading-relaxed\"\n                  disabled={isLoading}\n                  rows={1}\n                />\n                \n                {/* å‘é€æŒ‰é’® */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">å‘é€</span>\n                  <Button \n                    type=\"submit\" \n                    size=\"icon\" \n                    className=\"h-10 w-10 rounded-xl text-white shadow-[0_4px_12px_rgba(20,83,45,0.3)] hover:opacity-90 transition-all disabled:opacity-40\"\n                    style={{ backgroundColor: BRAND_GREEN }}\n                    disabled={isLoading || (!input.trim() && uploadedFiles.length === 0)}\n                  >\n                    {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <Send className=\"h-5 w-5\" />}\n                  </Button>\n                </div>\n              </div>\n            </form>\n\n            {!userId && (\n              <p className=\"mt-3 text-center text-xs text-slate-400\">æœªç™»å½•</p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport function EnhancedChatInterface() {\n  return (\n    <Suspense fallback={<div className=\"flex h-screen w-full items-center justify-center bg-white\"><Loader2 className=\"h-6 w-6 animate-spin\" style={{ color: BRAND_GREEN }} /></div>}>\n      <ChatInterfaceInner />\n    </Suspense>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}