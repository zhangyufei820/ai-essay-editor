{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/ui/textarea.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAyC;IACzE,qBACE,sYAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,ucACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS","debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/analysis-stages.tsx"],"sourcesContent":["\"use client\"\nimport { CheckCircle2, Sparkles } from \"lucide-react\"\nimport { useEffect, useState } from \"react\"\n\ninterface Stage {\n  id: number\n  title: string\n  description: string\n}\n\nconst stages: Stage[] = [\n  {\n    id: 1,\n    title: \"文档解析\",\n    description: \"正在识别文字内容和图片信息...\",\n  },\n  {\n    id: 2,\n    title: \"智能分析\",\n    description: \"AI正在深度理解文章立意和结构...\",\n  },\n  {\n    id: 3,\n    title: \"全面评估\",\n    description: \"分析语言表达、论证逻辑和创意亮点...\",\n  },\n  {\n    id: 4,\n    title: \"生成建议\",\n    description: \"提炼优点和改进方向，打磨批改报告...\",\n  },\n  {\n    id: 5,\n    title: \"完成批改\",\n    description: \"批改报告已生成，正在为您呈现...\",\n  },\n]\n\nexport function AnalysisStages() {\n  const [currentStage, setCurrentStage] = useState(0)\n  const [progress, setProgress] = useState(0)\n\n  useEffect(() => {\n    const stageInterval = setInterval(() => {\n      setCurrentStage((prev) => {\n        if (prev < stages.length - 1) {\n          return prev + 1\n        }\n        return prev\n      })\n    }, 2000)\n\n    const progressInterval = setInterval(() => {\n      setProgress((prev) => {\n        const targetProgress = ((currentStage + 1) / stages.length) * 100\n        if (prev < targetProgress) {\n          return Math.min(prev + 1, 100)\n        }\n        return prev\n      })\n    }, 20)\n\n    return () => {\n      clearInterval(stageInterval)\n      clearInterval(progressInterval)\n    }\n  }, [currentStage])\n\n  return (\n    <div className=\"flex items-center justify-center min-h-[500px] p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"bg-[#f5f1e8] rounded-3xl p-6 shadow-lg border border-amber-200/50\">\n          <div className=\"flex items-start justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-700 to-emerald-900 shadow-md\">\n                <Sparkles className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-bold text-gray-800\">AI 智能批改进行中</h3>\n                <p className=\"text-sm text-gray-600\">\n                  阶段 {currentStage + 1} / {stages.length}\n                </p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-3xl font-bold text-gray-800\">{Math.round(progress)}%</div>\n              <div className=\"text-xs text-gray-600\">已完成</div>\n            </div>\n          </div>\n\n          <div className=\"mb-6 h-2 w-full overflow-hidden rounded-full bg-gray-200\">\n            <div\n              className=\"h-full rounded-full bg-gradient-to-r from-green-500 via-yellow-400 to-orange-500 transition-all duration-300 ease-out\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n\n          <div className=\"space-y-3\">\n            {stages.map((stage, index) => {\n              const isCompleted = index < currentStage\n              const isCurrent = index === currentStage\n\n              return (\n                <div\n                  key={stage.id}\n                  className={`flex items-center gap-3 rounded-2xl border p-4 transition-all ${\n                    isCurrent\n                      ? \"border-emerald-300 bg-emerald-50/80 shadow-md\"\n                      : isCompleted\n                        ? \"border-emerald-200 bg-white\"\n                        : \"border-gray-200 bg-white/50\"\n                  }`}\n                >\n                  <div\n                    className={`flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full ${\n                      isCompleted || isCurrent ? \"bg-emerald-700\" : \"bg-gray-300\"\n                    }`}\n                  >\n                    <CheckCircle2 className={`h-5 w-5 ${isCompleted || isCurrent ? \"text-white\" : \"text-gray-500\"}`} />\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"font-semibold text-gray-800\">{stage.title}</div>\n                    <div className=\"text-sm text-gray-600 truncate\">{stage.description}</div>\n                  </div>\n\n                  {isCurrent && (\n                    <div className=\"flex gap-1\">\n                      {[0, 1, 2].map((i) => (\n                        <div\n                          key={i}\n                          className=\"h-2 w-2 rounded-full bg-emerald-700 animate-bounce\"\n                          style={{\n                            animationDelay: `${i * 150}ms`,\n                            animationDuration: \"600ms\",\n                          }}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )\n            })}\n          </div>\n\n          <div className=\"mt-4 flex items-start gap-2 rounded-xl bg-amber-50 px-4 py-3 border border-amber-200\">\n            <span className=\"text-base\">💡</span>\n            <p className=\"text-xs text-gray-600 leading-relaxed\">AI 正在为您精心打磨批改报告，请稍候片刻...</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/ModelSelector.tsx"],"sourcesContent":["/**\n * 🎯 沈翔智学 - 模型选择器组件 (Model Selector)\n * \n * 重新设计的AI模型选择下拉菜单，包含流畅动画和统一视觉风格\n */\n\n\"use client\"\n\nimport { useState, useRef, useEffect } from \"react\"\nimport { Check, ChevronDown } from \"lucide-react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\n// ============================================\n// 设计系统颜色常量\n// ============================================\n\nconst COLORS = {\n  primary: {\n    main: \"#4CAF50\",\n    dark: \"#2E7D32\",\n    light: \"#E8F5E9\",\n    hover: \"rgba(76, 175, 80, 0.08)\",\n  },\n  gray: {\n    50: \"#FAFAFA\",\n    100: \"#F5F5F5\",\n    200: \"#EEEEEE\",\n    300: \"#E0E0E0\",\n    400: \"#BDBDBD\",\n    500: \"#9E9E9E\",\n    600: \"#757575\",\n    700: \"#616161\",\n    800: \"#424242\",\n    900: \"#212121\",\n  },\n  badges: {\n    recommended: { bg: \"#E8F5E9\", text: \"#2E7D32\" },\n    new: { bg: \"#E3F2FD\", text: \"#1976D2\" },\n    hot: { bg: \"#FFF3E0\", text: \"#F57C00\" },\n    pro: { bg: \"#F3E5F5\", text: \"#7B1FA2\" },\n  }\n}\n\n// ============================================\n// 类型定义\n// ============================================\n\ninterface Model {\n  key: string\n  name: string\n  icon: React.ComponentType<{ className?: string; style?: React.CSSProperties }>\n  color: string\n  description?: string\n  badge?: string\n  group?: string\n}\n\ninterface ModelSelectorProps {\n  selectedModel: string\n  onModelChange: (model: string) => void\n  models: Model[]\n  disabled?: boolean\n  className?: string\n  dailyFreeInfo?: {\n    used: number\n    total: number\n  }\n}\n\n// ============================================\n// Badge 组件\n// ============================================\n\nfunction ModelBadge({ text }: { text: string }) {\n  const getBadgeStyle = (badgeText: string) => {\n    switch (badgeText) {\n      case \"推荐\":\n        return { backgroundColor: COLORS.badges.recommended.bg, color: COLORS.badges.recommended.text }\n      case \"新\":\n        return { backgroundColor: COLORS.badges.new.bg, color: COLORS.badges.new.text }\n      case \"热门\":\n        return { backgroundColor: COLORS.badges.hot.bg, color: COLORS.badges.hot.text }\n      case \"Pro\":\n        return { backgroundColor: COLORS.badges.pro.bg, color: COLORS.badges.pro.text }\n      default:\n        return { backgroundColor: COLORS.gray[100], color: COLORS.gray[600] }\n    }\n  }\n\n  const style = getBadgeStyle(text)\n\n  return (\n    <span \n      className=\"px-2 py-0.5 text-[10px] font-medium rounded-full\"\n      style={style}\n    >\n      {text}\n    </span>\n  )\n}\n\n// ============================================\n// 模型选择器主组件\n// ============================================\n\nexport function ModelSelector({\n  selectedModel,\n  onModelChange,\n  models,\n  disabled,\n  className,\n  dailyFreeInfo\n}: ModelSelectorProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const currentModel = models.find(m => m.key === selectedModel)\n\n  // 点击外部关闭\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false)\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside)\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside)\n  }, [])\n\n  // 按分组组织模型\n  const groupedModels = models.reduce((acc, model) => {\n    const group = model.group || \"默认\"\n    if (!acc[group]) acc[group] = []\n    acc[group].push(model)\n    return acc\n  }, {} as Record<string, Model[]>)\n\n  const groups = Object.keys(groupedModels)\n\n  const handleSelect = (modelKey: string) => {\n    onModelChange(modelKey)\n    setIsOpen(false)\n  }\n\n  return (\n    <div ref={containerRef} className={cn(\"relative\", className)}>\n      {/* 触发按钮 */}\n      <motion.button\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n        disabled={disabled}\n        className={cn(\n          \"flex items-center gap-2 px-3 py-1.5 rounded-lg\",\n          \"text-sm hover:bg-[#F5F5F5]\",\n          \"transition-all duration-150 ease-out\",\n          \"disabled:opacity-50 disabled:cursor-not-allowed\",\n          \"focus:outline-none\"\n        )}\n        style={{ color: COLORS.gray[700] }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {/* 颜色指示点 */}\n        <span\n          className=\"w-2 h-2 rounded-full shrink-0\"\n          style={{ backgroundColor: currentModel?.color }}\n        />\n        \n        {/* 模型名称 */}\n        <span className=\"font-medium\">{currentModel?.name || \"选择模型\"}</span>\n        \n        {/* 下拉箭头 */}\n        <motion.div\n          animate={{ rotate: isOpen ? 180 : 0 }}\n          transition={{ duration: 0.2, ease: \"easeOut\" }}\n        >\n          <ChevronDown className=\"w-3.5 h-3.5 opacity-50\" />\n        </motion.div>\n      </motion.button>\n\n      {/* 向上弹出菜单 */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 8, scale: 0.96 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 8, scale: 0.96 }}\n            transition={{ duration: 0.2, ease: \"easeOut\" }}\n            className=\"absolute bottom-full left-0 mb-2 z-50\"\n            style={{\n              width: \"360px\",\n              maxHeight: \"480px\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 -8px 24px rgba(0,0,0,0.12)\",\n              backgroundColor: \"#FFFFFF\",\n              border: `1px solid ${COLORS.gray[200]}`,\n              overflow: \"hidden\",\n            }}\n          >\n            {/* 标题和免费额度信息 */}\n            <div \n              className=\"flex items-center justify-between px-4 py-3\"\n              style={{ borderBottom: `1px solid ${COLORS.gray[200]}` }}\n            >\n              <span \n                className=\"text-xs font-medium\"\n                style={{ color: COLORS.gray[600] }}\n              >\n                选择模型\n              </span>\n              {dailyFreeInfo && (\n                <span \n                  className=\"text-[10px]\"\n                  style={{ color: COLORS.gray[500] }}\n                >\n                  今日免费: {dailyFreeInfo.total - dailyFreeInfo.used}/{dailyFreeInfo.total}\n                </span>\n              )}\n            </div>\n\n            {/* 可滚动的模型列表 */}\n            <div \n              className=\"overflow-y-auto p-4 custom-scrollbar\"\n              style={{\n                maxHeight: \"420px\",\n              }}\n            >\n\n              {groups.map((group, groupIndex) => (\n                <div key={group}>\n                  {/* 分组标题 */}\n                  {group !== \"默认\" && (\n                    <div \n                      className=\"flex items-center gap-2 mb-2\"\n                      style={{ \n                        marginTop: groupIndex > 0 ? \"16px\" : \"0\",\n                      }}\n                    >\n                      {/* 左侧品牌色条 */}\n                      <div \n                        className=\"w-0.5 h-4 rounded-full\"\n                        style={{ backgroundColor: COLORS.primary.main }}\n                      />\n                      <span \n                        className=\"text-xs font-semibold uppercase\"\n                        style={{ \n                          color: COLORS.gray[600],\n                          letterSpacing: \"0.5px\",\n                        }}\n                      >\n                        {group}\n                      </span>\n                    </div>\n                  )}\n\n                  {/* 模型列表 */}\n                  <div className=\"space-y-1\">\n                    {groupedModels[group].map((model) => (\n                      <ModelMenuItem\n                        key={model.key}\n                        model={model}\n                        isSelected={selectedModel === model.key}\n                        onClick={() => handleSelect(model.key)}\n                      />\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\n// ============================================\n// 模型菜单项组件\n// ============================================\n\nfunction ModelMenuItem({\n  model,\n  isSelected,\n  onClick\n}: {\n  model: Model\n  isSelected: boolean\n  onClick: () => void\n}) {\n  const Icon = model.icon\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 rounded-lg cursor-pointer\",\n        \"transition-all duration-150 ease-out\",\n        \"focus:outline-none\"\n      )}\n      style={{\n        height: \"56px\",\n        padding: \"12px 16px\",\n        backgroundColor: isSelected ? COLORS.primary.hover : \"transparent\",\n      }}\n      whileHover={{ \n        backgroundColor: isSelected ? COLORS.primary.hover : COLORS.gray[100],\n      }}\n      whileTap={{ scale: 0.98 }}\n    >\n      {/* 模型图标 */}\n      <div \n        className=\"flex h-8 w-8 items-center justify-center rounded-lg shrink-0\"\n        style={{ backgroundColor: `${model.color}15` }}\n      >\n        <Icon \n          className=\"h-4 w-4\" \n          style={{ color: model.color }}\n        />\n      </div>\n\n      {/* 模型信息 */}\n      <div className=\"flex-1 min-w-0 text-left\">\n        <div className=\"flex items-center gap-2\">\n          <span \n            className=\"text-sm\"\n            style={{ \n              fontWeight: 500,\n              color: COLORS.gray[900],\n            }}\n          >\n            {model.name}\n          </span>\n          {model.badge && <ModelBadge text={model.badge} />}\n        </div>\n        {model.description && (\n          <p \n            className=\"text-xs truncate mt-0.5\"\n            style={{ \n              fontWeight: 400,\n              color: COLORS.gray[600],\n            }}\n          >\n            {model.description}\n          </p>\n        )}\n      </div>\n\n      {/* 选中图标 */}\n      {isSelected && (\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ duration: 0.15, ease: \"easeOut\" }}\n        >\n          <Check \n            className=\"w-5 h-5 shrink-0\" \n            style={{ color: COLORS.primary.main }}\n          />\n        </motion.div>\n      )}\n    </motion.button>\n  )\n}\n\nexport default ModelSelector\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 858, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/workflow-visual-config.ts"],"sourcesContent":["/**\n * 🎯 作文批改智能体 - Dify Workflow 可视化配置\n * \n * 将 Dify 原始节点名称映射为教学领域专业术语\n * 这是 UI 的唯一真理来源 (Single Source of Truth)\n * \n * ⚠️ 严禁在此文件或 UI 中出现任何底层模型名称（如 Qwen、Claude 等）\n */\n\nimport { \n  Scan, Eye, Filter, FileText, Layers, Cog, Brain, Sparkles,\n  type LucideIcon \n} from \"lucide-react\"\n\n// ============================================\n// 类型定义\n// ============================================\n\nexport type WorkflowNodeStatus = \"pending\" | \"running\" | \"completed\" | \"error\"\n\nexport interface WorkflowNodeConfig {\n  /** Dify 原始节点名称 */\n  originalName: string\n  /** UI 显示的专业术语名称 */\n  displayName: string\n  /** 英文副标题 */\n  englishName: string\n  /** 运行中的微交互文案数组（轮播显示） */\n  runningTexts: string[]\n  /** 图标组件 */\n  icon: LucideIcon\n  /** 节点所属路径分组 */\n  group: \"input\" | \"vision\" | \"document\" | \"core\"\n  /** 是否为核心高亮节点 */\n  isHighlight?: boolean\n  /** 预估耗时（秒），用于进度条模拟 */\n  estimatedDuration?: number\n}\n\nexport interface WorkflowState {\n  nodes: WorkflowNodeState[]\n  currentNodeIndex: number\n  isExpanded: boolean\n  startTime?: number\n}\n\nexport interface WorkflowNodeState {\n  id: string\n  config: WorkflowNodeConfig\n  status: WorkflowNodeStatus\n  startTime?: number\n  endTime?: number\n  currentTextIndex: number\n}\n\n// ============================================\n// 节点映射配置 (NODE_VISUAL_MAP)\n// ============================================\n\nexport const NODE_VISUAL_MAP: Record<string, WorkflowNodeConfig> = {\n  // ========== 输入路由层 ==========\n  \"格式判断\": {\n    originalName: \"格式判断\",\n    displayName: \"多模态作业意图识别\",\n    englishName: \"Multi-modal Assignment Intent Analysis\",\n    runningTexts: [\n      \"正在扫描文件元数据...\",\n      \"识别作业类型中...\",\n      \"分析输入格式...\",\n      \"匹配处理管道...\"\n    ],\n    icon: Scan,\n    group: \"input\",\n    estimatedDuration: 2\n  },\n\n  // ========== 视觉/OCR 路径（处理手写作文）==========\n  \"视觉提取\": {\n    originalName: \"视觉提取\",\n    displayName: \"手写体结构化识别层\",\n    englishName: \"Handwriting Structured Recognition Layer\",\n    runningTexts: [\n      \"正在提取笔迹特征...\",\n      \"正在进行文字转录...\",\n      \"识别手写字符中...\",\n      \"构建文本结构...\"\n    ],\n    icon: Eye,\n    group: \"vision\",\n    estimatedDuration: 5\n  },\n\n  \"数据清洗\": {\n    originalName: \"数据清洗\",\n    displayName: \"OCR 噪声过滤与文本对齐\",\n    englishName: \"OCR Noise Filtering & Text Alignment\",\n    runningTexts: [\n      \"正在校准文本行...\",\n      \"过滤识别噪声...\",\n      \"对齐段落结构...\",\n      \"优化文本质量...\"\n    ],\n    icon: Filter,\n    group: \"vision\",\n    estimatedDuration: 3\n  },\n\n  // ========== 文档路径（处理电子文档）==========\n  \"文档提取器\": {\n    originalName: \"文档提取器\",\n    displayName: \"非结构化教学资源解析\",\n    englishName: \"Unstructured Educational Resource Parsing\",\n    runningTexts: [\n      \"解析文档结构...\",\n      \"提取文本内容...\",\n      \"识别格式元素...\",\n      \"构建内容树...\"\n    ],\n    icon: FileText,\n    group: \"document\",\n    estimatedDuration: 3\n  },\n\n  \"内容汇聚\": {\n    originalName: \"内容汇聚\",\n    displayName: \"上下文语境向量聚合\",\n    englishName: \"Context Vector Aggregation\",\n    runningTexts: [\n      \"聚合上下文信息...\",\n      \"构建语义向量...\",\n      \"整合内容片段...\",\n      \"优化信息密度...\"\n    ],\n    icon: Layers,\n    group: \"document\",\n    estimatedDuration: 2\n  },\n\n  // ========== 核心批改与合成层 ==========\n  \"代码执行 4\": {\n    originalName: \"代码执行 4\",\n    displayName: \"语法逻辑校验引擎\",\n    englishName: \"Grammar & Logic Validation Engine\",\n    runningTexts: [\n      \"正在验证语言学规则...\",\n      \"检查语法结构...\",\n      \"分析逻辑连贯性...\",\n      \"匹配教学大纲...\"\n    ],\n    icon: Cog,\n    group: \"core\",\n    estimatedDuration: 4\n  },\n\n  \"总编辑\": {\n    originalName: \"总编辑\",\n    displayName: \"启发式教学反馈合成\",\n    englishName: \"Heuristic Pedagogical Synthesis\",\n    runningTexts: [\n      \"正在生成修改建议...\",\n      \"正在优化评语语气...\",\n      \"综合教学反馈...\",\n      \"润色批改意见...\",\n      \"生成个性化指导...\"\n    ],\n    icon: Brain,\n    group: \"core\",\n    isHighlight: true,\n    estimatedDuration: 8\n  }\n}\n\n// ============================================\n// 黑名单节点（不显示）\n// ============================================\n\nexport const HIDDEN_NODES = new Set([\n  \"用户输入\",\n  \"条件分支 2\",\n  \"直接回复 6\",\n  \"开始\",\n  \"结束\"\n])\n\n// ============================================\n// 辅助函数\n// ============================================\n\n/**\n * 根据 Dify 原始节点名称获取可视化配置\n */\nexport function getNodeConfig(originalName: string): WorkflowNodeConfig | null {\n  if (HIDDEN_NODES.has(originalName)) {\n    return null\n  }\n  return NODE_VISUAL_MAP[originalName] || null\n}\n\n/**\n * 检查节点是否应该被隐藏\n */\nexport function shouldHideNode(originalName: string): boolean {\n  return HIDDEN_NODES.has(originalName)\n}\n\n/**\n * 获取节点的下一个运行文案（轮播）\n */\nexport function getNextRunningText(config: WorkflowNodeConfig, currentIndex: number): {\n  text: string\n  nextIndex: number\n} {\n  const texts = config.runningTexts\n  const nextIndex = (currentIndex + 1) % texts.length\n  return {\n    text: texts[currentIndex],\n    nextIndex\n  }\n}\n\n/**\n * 创建初始工作流状态\n */\nexport function createInitialWorkflowState(): WorkflowState {\n  return {\n    nodes: [],\n    currentNodeIndex: -1,\n    isExpanded: false\n  }\n}\n\n/**\n * 根据节点名称创建节点状态\n */\nexport function createNodeState(originalName: string): WorkflowNodeState | null {\n  const config = getNodeConfig(originalName)\n  if (!config) return null\n  \n  return {\n    id: `node-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n    config,\n    status: \"pending\",\n    currentTextIndex: 0\n  }\n}\n\n/**\n * 获取分组显示名称\n */\nexport function getGroupDisplayName(group: WorkflowNodeConfig[\"group\"]): string {\n  const groupNames: Record<string, string> = {\n    input: \"输入分析\",\n    vision: \"视觉识别\",\n    document: \"文档处理\",\n    core: \"智能批改\"\n  }\n  return groupNames[group] || group\n}\n\n/**\n * 计算已完成节点数量\n */\nexport function getCompletedCount(nodes: WorkflowNodeState[]): number {\n  return nodes.filter(n => n.status === \"completed\").length\n}\n\n/**\n * 获取当前运行中的节点\n */\nexport function getCurrentRunningNode(nodes: WorkflowNodeState[]): WorkflowNodeState | null {\n  return nodes.find(n => n.status === \"running\") || null\n}\n\n// ============================================\n// 伪日志文案库（用于模拟进度）\n// ============================================\n\nexport const FAKE_LOG_MESSAGES = {\n  input: [\n    \"正在加载词典...\",\n    \"初始化分析引擎...\",\n    \"准备处理管道...\"\n  ],\n  vision: [\n    \"加载视觉模型...\",\n    \"预处理图像数据...\",\n    \"执行特征提取...\"\n  ],\n  document: [\n    \"解析文档格式...\",\n    \"提取文本层...\",\n    \"构建内容索引...\"\n  ],\n  core: [\n    \"匹配教学大纲...\",\n    \"加载评分标准...\",\n    \"初始化反馈模板...\",\n    \"综合多维度分析...\"\n  ]\n}\n\n/**\n * 获取随机伪日志\n */\nexport function getRandomFakeLog(group: WorkflowNodeConfig[\"group\"]): string {\n  const logs = FAKE_LOG_MESSAGES[group]\n  return logs[Math.floor(Math.random() * logs.length)]\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1095, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/hooks/useWorkflowVisualizer.ts"],"sourcesContent":["/**\n * 🎯 作文批改智能体 - 工作流可视化 Hook\n * \n * 解析 Dify SSE 事件流，管理工作流状态机\n * 实现透明化的 AI 思考路径可视化\n */\n\nimport { useState, useCallback, useRef, useEffect } from \"react\"\nimport {\n  WorkflowState,\n  WorkflowNodeState,\n  WorkflowNodeStatus,\n  getNodeConfig,\n  shouldHideNode,\n  createNodeState,\n  getCompletedCount,\n  getCurrentRunningNode,\n  getNextRunningText\n} from \"@/lib/workflow-visual-config\"\n\n// ============================================\n// 类型定义\n// ============================================\n\nexport interface UseWorkflowVisualizerReturn {\n  /** 工作流状态 */\n  workflowState: WorkflowState\n  /** 是否正在处理工作流 */\n  isProcessing: boolean\n  /** 处理 SSE 事件 */\n  handleSSEEvent: (event: DifySSEEvent) => void\n  /** 重置工作流状态 */\n  resetWorkflow: () => void\n  /** 切换展开/折叠 */\n  toggleExpanded: () => void\n  /** 获取折叠态摘要文本 */\n  getSummaryText: () => string\n  /** 手动标记工作流完成 */\n  markWorkflowComplete: () => void\n}\n\nexport interface DifySSEEvent {\n  event: string\n  data?: {\n    node_id?: string\n    title?: string\n    status?: string\n    workflow_run_id?: string\n    [key: string]: unknown\n  }\n}\n\n// ============================================\n// 初始状态\n// ============================================\n\nconst createInitialState = (): WorkflowState => ({\n  nodes: [],\n  currentNodeIndex: -1,\n  isExpanded: true,\n  startTime: undefined\n})\n\n// ============================================\n// Hook 实现\n// ============================================\n\nexport function useWorkflowVisualizer(): UseWorkflowVisualizerReturn {\n  const [workflowState, setWorkflowState] = useState<WorkflowState>(createInitialState())\n  const [isProcessing, setIsProcessing] = useState(false)\n  \n  // 用于防止重复添加节点\n  const processedNodesRef = useRef<Set<string>>(new Set())\n  // 文案轮播定时器\n  const textRotationTimerRef = useRef<NodeJS.Timeout | null>(null)\n\n  // 清理定时器\n  useEffect(() => {\n    return () => {\n      if (textRotationTimerRef.current) {\n        clearInterval(textRotationTimerRef.current)\n      }\n    }\n  }, [])\n\n  // 启动文案轮播\n  const startTextRotation = useCallback(() => {\n    if (textRotationTimerRef.current) {\n      clearInterval(textRotationTimerRef.current)\n    }\n    \n    textRotationTimerRef.current = setInterval(() => {\n      setWorkflowState(prev => {\n        const runningNode = prev.nodes.find(n => n.status === \"running\")\n        if (!runningNode) return prev\n        \n        const { nextIndex } = getNextRunningText(runningNode.config, runningNode.currentTextIndex)\n        \n        return {\n          ...prev,\n          nodes: prev.nodes.map(node => \n            node.id === runningNode.id \n              ? { ...node, currentTextIndex: nextIndex }\n              : node\n          )\n        }\n      })\n    }, 2000) // 每2秒轮播一次\n  }, [])\n\n  // 停止文案轮播\n  const stopTextRotation = useCallback(() => {\n    if (textRotationTimerRef.current) {\n      clearInterval(textRotationTimerRef.current)\n      textRotationTimerRef.current = null\n    }\n  }, [])\n\n  // 处理 SSE 事件\n  const handleSSEEvent = useCallback((event: DifySSEEvent) => {\n    const { event: eventType, data } = event\n\n    // 工作流开始\n    if (eventType === \"workflow_started\") {\n      setIsProcessing(true)\n      processedNodesRef.current.clear()\n      setWorkflowState({\n        nodes: [],\n        currentNodeIndex: -1,\n        isExpanded: true,\n        startTime: Date.now()\n      })\n      startTextRotation()\n      return\n    }\n\n    // 工作流结束\n    if (eventType === \"workflow_finished\") {\n      setIsProcessing(false)\n      stopTextRotation()\n      // 将所有运行中的节点标记为完成\n      setWorkflowState(prev => ({\n        ...prev,\n        nodes: prev.nodes.map(node => ({\n          ...node,\n          status: node.status === \"running\" ? \"completed\" : node.status,\n          endTime: node.status === \"running\" ? Date.now() : node.endTime\n        }))\n      }))\n      return\n    }\n\n    // 节点开始\n    if (eventType === \"node_started\" && data?.title) {\n      const nodeTitle = data.title\n      \n      // 检查是否应该隐藏\n      if (shouldHideNode(nodeTitle)) return\n      \n      // 防止重复添加\n      const nodeKey = `${nodeTitle}-${data.node_id || ''}`\n      if (processedNodesRef.current.has(nodeKey)) return\n      processedNodesRef.current.add(nodeKey)\n      \n      // 创建节点状态\n      const nodeState = createNodeState(nodeTitle)\n      if (!nodeState) return\n      \n      setWorkflowState(prev => {\n        // 将之前运行中的节点标记为完成\n        const updatedNodes = prev.nodes.map(node => ({\n          ...node,\n          status: node.status === \"running\" ? \"completed\" as WorkflowNodeStatus : node.status,\n          endTime: node.status === \"running\" ? Date.now() : node.endTime\n        }))\n        \n        // 添加新节点并设为运行中\n        const newNode: WorkflowNodeState = {\n          ...nodeState,\n          status: \"running\",\n          startTime: Date.now()\n        }\n        \n        return {\n          ...prev,\n          nodes: [...updatedNodes, newNode],\n          currentNodeIndex: updatedNodes.length\n        }\n      })\n      return\n    }\n\n    // 节点完成\n    if (eventType === \"node_finished\" && data?.title) {\n      const nodeTitle = data.title\n      \n      if (shouldHideNode(nodeTitle)) return\n      \n      setWorkflowState(prev => ({\n        ...prev,\n        nodes: prev.nodes.map(node => \n          node.config.originalName === nodeTitle && node.status === \"running\"\n            ? { ...node, status: \"completed\" as WorkflowNodeStatus, endTime: Date.now() }\n            : node\n        )\n      }))\n      return\n    }\n\n    // 处理错误\n    if (eventType === \"error\") {\n      setIsProcessing(false)\n      stopTextRotation()\n      setWorkflowState(prev => ({\n        ...prev,\n        nodes: prev.nodes.map(node => ({\n          ...node,\n          status: node.status === \"running\" ? \"error\" : node.status\n        }))\n      }))\n      return\n    }\n  }, [startTextRotation, stopTextRotation])\n\n  // 重置工作流\n  const resetWorkflow = useCallback(() => {\n    setIsProcessing(false)\n    stopTextRotation()\n    processedNodesRef.current.clear()\n    setWorkflowState(createInitialState())\n  }, [stopTextRotation])\n\n  // 切换展开/折叠\n  const toggleExpanded = useCallback(() => {\n    setWorkflowState(prev => ({\n      ...prev,\n      isExpanded: !prev.isExpanded\n    }))\n  }, [])\n\n  // 获取折叠态摘要文本\n  const getSummaryText = useCallback((): string => {\n    const { nodes } = workflowState\n    const completedCount = getCompletedCount(nodes)\n    const runningNode = getCurrentRunningNode(nodes)\n    \n    if (nodes.length === 0) {\n      return \"准备中...\"\n    }\n    \n    if (runningNode) {\n      return `✨ ${completedCount}个批改步骤已完成 | 当前：${runningNode.config.displayName}...`\n    }\n    \n    if (completedCount === nodes.length && nodes.length > 0) {\n      return `✅ ${completedCount}个批改步骤全部完成`\n    }\n    \n    return `${completedCount}/${nodes.length} 步骤已完成`\n  }, [workflowState])\n\n  // 手动标记工作流完成\n  const markWorkflowComplete = useCallback(() => {\n    setIsProcessing(false)\n    stopTextRotation()\n    setWorkflowState(prev => ({\n      ...prev,\n      nodes: prev.nodes.map(node => ({\n        ...node,\n        status: \"completed\" as WorkflowNodeStatus,\n        endTime: node.endTime || Date.now()\n      }))\n    }))\n  }, [stopTextRotation])\n\n  return {\n    workflowState,\n    isProcessing,\n    handleSSEEvent,\n    resetWorkflow,\n    toggleExpanded,\n    getSummaryText,\n    markWorkflowComplete\n  }\n}\n\nexport default useWorkflowVisualizer\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1377, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/pricing.ts"],"sourcesContent":["/**\n * 统一计费中心 v2.0\n * \n * 计费规则：\n * - 智能体（standard, teaching-pro）：10 积分/1K Token\n * - 独立模型（gpt-5, claude-opus, gemini-pro 等）：20 积分/1K Token\n * - 多媒体模型：按次固定扣费（成本/0.4）\n * \n * 扣费流程：\n * - 前端：显示\"预计消耗\"（基于估算 Token 数）\n * - 后端：等 Dify 回答完后根据实际 Token 数静默结算\n * \n * 利润保障：\n * - 豪华会员 12,000 积分全额消耗时，VivaAPI 成本占比 ≤ 40%\n */\n\n// ============================================\n// 1. 类型定义\n// ============================================\n\nexport type ModelType = \n  | \"standard\" \n  | \"teaching-pro\"\n  | \"gpt-5\" \n  | \"claude-opus\" \n  | \"gemini-pro\" \n  | \"banana-2-pro\" \n  | \"suno-v5\" \n  | \"sora-2-pro\"\n\nexport type GenMode = \"text\" | \"image\" | \"music\" | \"video\"\n\n/** 模型类别：智能体 vs 独立模型 */\nexport type ModelCategory = \"agent\" | \"standalone\" | \"media\"\n\ninterface ModelCostConfig {\n  /** 模型类别 */\n  category: ModelCategory\n  /** Token 单价（积分/1K tokens），仅文本模型有效 */\n  tokenRate?: number\n  /** 固定成本（用于多媒体模型，单位：积分） */\n  fixedCost?: number\n  /** 模型显示名称 */\n  displayName: string\n  /** 生成模式 */\n  mode: GenMode\n  /** 预估平均 Token 数（用于前端预览） */\n  estimatedTokens?: number\n}\n\n// ============================================\n// 2. 计费配置\n// ============================================\n\n/** 智能体 Token 单价：10 积分/1K Token */\nexport const AGENT_TOKEN_RATE = 10\n\n/** 独立模型 Token 单价：20 积分/1K Token */\nexport const STANDALONE_TOKEN_RATE = 20\n\n/** 利润率系数（成本占比 40%，利润 60%） */\nexport const PROFIT_MARGIN = 0.4\n\n/**\n * 各模型配置\n */\nexport const MODEL_COSTS: Record<ModelType, ModelCostConfig> = {\n  // ========== 智能体（10 积分/1K Token）==========\n  \"standard\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"作文批改智能体\",\n    mode: \"text\",\n    estimatedTokens: 2000  // 预估平均 2K tokens\n  },\n  \"teaching-pro\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"教学评智能助手\",\n    mode: \"text\",\n    estimatedTokens: 2500  // 预估平均 2.5K tokens\n  },\n  \n  // ========== 独立模型（20 积分/1K Token）==========\n  \"gpt-5\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"ChatGPT 5.1\",\n    mode: \"text\",\n    estimatedTokens: 1500  // 预估平均 1.5K tokens\n  },\n  \"claude-opus\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Claude Opus 4.5\",\n    mode: \"text\",\n    estimatedTokens: 2000  // 预估平均 2K tokens\n  },\n  \"gemini-pro\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Gemini 3.0 Pro\",\n    mode: \"text\",\n    estimatedTokens: 1500  // 预估平均 1.5K tokens\n  },\n  \n  // ========== 多媒体模型（按次固定扣费）==========\n  \"banana-2-pro\": { \n    category: \"media\",\n    fixedCost: 50,  // 成本 50 积分 → 用户扣费 125 积分\n    displayName: \"Banana 2 Pro\",\n    mode: \"image\"\n  },\n  \"suno-v5\": { \n    category: \"media\",\n    fixedCost: 100, // 成本 100 积分 → 用户扣费 250 积分\n    displayName: \"Suno V5\",\n    mode: \"music\"\n  },\n  \"sora-2-pro\": { \n    category: \"media\",\n    fixedCost: 300, // 成本 300 积分 → 用户扣费 750 积分\n    displayName: \"Sora 2 Pro\",\n    mode: \"video\"\n  },\n}\n\n// ============================================\n// 3. 计费函数\n// ============================================\n\n/**\n * 计算预估消耗（前端预览用）\n * \n * @param model - 模型类型\n * @param options - 可选参数\n * @returns 预估积分消耗\n */\nexport function calculatePreviewCost(\n  model: ModelType,\n  options?: {\n    isLuxury?: boolean\n    estimatedInputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] 未知模型: ${model}，使用默认价格`)\n    return 20\n  }\n  \n  // 多媒体模型：固定价格\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // 文本模型：基于预估 Token 数计算\n  const estimatedTokens = options?.estimatedInputTokens || config.estimatedTokens || 1500\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // 预估消耗 = Token 数 / 1000 * 单价\n  const estimatedCost = Math.ceil((estimatedTokens / 1000) * tokenRate)\n  \n  return estimatedCost\n}\n\n/**\n * 计算实际扣费金额（后端静默结算用）\n * \n * @param model - 模型类型\n * @param tokenUsage - 实际 Token 使用量\n * @returns 应扣积分数\n */\nexport function calculateActualCost(\n  model: ModelType,\n  tokenUsage?: {\n    totalTokens?: number\n    inputTokens?: number\n    outputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] 未知模型: ${model}，使用默认价格`)\n    return 20\n  }\n  \n  // 多媒体模型：固定价格\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // 文本模型：根据实际 Token 数计费\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // 优先使用 totalTokens，否则使用 input + output\n  let totalTokens = tokenUsage?.totalTokens || 0\n  if (!totalTokens && tokenUsage) {\n    totalTokens = (tokenUsage.inputTokens || 0) + (tokenUsage.outputTokens || 0)\n  }\n  \n  // 如果没有 Token 信息，使用预估值\n  if (!totalTokens) {\n    totalTokens = config.estimatedTokens || 1500\n  }\n  \n  // 实际消耗 = Token 数 / 1000 * 单价\n  const actualCost = Math.ceil((totalTokens / 1000) * tokenRate)\n  \n  // 最低消费 5 积分\n  return Math.max(actualCost, 5)\n}\n\n/**\n * 获取模型显示名称\n */\nexport function getModelDisplayName(model: ModelType): string {\n  return MODEL_COSTS[model]?.displayName || model\n}\n\n/**\n * 获取模型生成模式\n */\nexport function getModelMode(model: ModelType): GenMode {\n  return MODEL_COSTS[model]?.mode || \"text\"\n}\n\n/**\n * 获取模型类别\n */\nexport function getModelCategory(model: ModelType): ModelCategory {\n  return MODEL_COSTS[model]?.category || \"agent\"\n}\n\n/**\n * 获取模型 Token 单价\n */\nexport function getTokenRate(model: ModelType): number {\n  const config = MODEL_COSTS[model]\n  if (!config || config.category === \"media\") return 0\n  return config.tokenRate || AGENT_TOKEN_RATE\n}\n\n// ============================================\n// 4. 会员配置\n// ============================================\n\n/** 非豪华会员每日免费使用高级模型次数 */\nexport const DAILY_FREE_LIMIT = 20\n\n/** 豪华会员积分阈值（积分超过此值视为豪华会员） */\nexport const LUXURY_THRESHOLD = 1000\n\n/** 豪华会员套餐积分 */\nexport const LUXURY_CREDITS = 12000\n\n// ============================================\n// 5. 利润验证函数\n// ============================================\n\n/**\n * 验证豪华会员积分消耗时的成本占比\n * \n * 假设豪华会员 12,000 积分全部用于智能体对话：\n * - 用户消耗：12,000 积分\n * - 按 10 积分/1K Token 计算，可使用 1,200K Tokens\n * - VivaAPI 成本（假设 4 积分/1K Token）：4,800 积分\n * - 成本占比：4,800 / 12,000 = 40%\n * \n * @returns 成本占比是否 ≤ 40%\n */\nexport function validateProfitMargin(): boolean {\n  // 假设 VivaAPI 成本为用户价格的 40%\n  const vivaApiCostRate = PROFIT_MARGIN  // 0.4\n  \n  // 智能体场景\n  const agentUserRate = AGENT_TOKEN_RATE  // 10 积分/1K Token\n  const agentCostRate = agentUserRate * vivaApiCostRate  // 4 积分/1K Token\n  \n  // 豪华会员全额消耗\n  const totalCredits = LUXURY_CREDITS  // 12,000 积分\n  const totalTokens = totalCredits / agentUserRate * 1000  // 1,200,000 Tokens\n  const totalCost = (totalTokens / 1000) * agentCostRate  // 4,800 积分\n  \n  const costRatio = totalCost / totalCredits  // 0.4 = 40%\n  \n  console.log(`[利润验证] 豪华会员 ${totalCredits} 积分消耗:`)\n  console.log(`  - 可使用 Token: ${totalTokens.toLocaleString()}`)\n  console.log(`  - VivaAPI 成本: ${totalCost} 积分`)\n  console.log(`  - 成本占比: ${(costRatio * 100).toFixed(1)}%`)\n  \n  return costRatio <= PROFIT_MARGIN\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1576, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/enhanced-chat-interface.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { useState, useRef, useEffect, Suspense, useCallback } from \"react\"\nimport { useSearchParams, useRouter } from \"next/navigation\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { \n  Send, Paperclip, X, FileText, Copy, Loader2, Sparkles, User, Brain, AlertCircle, \n  ChevronDown, ChevronLeft, Bot, Film, Palette, AudioLines, ArrowDown, GraduationCap\n} from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { toast } from \"sonner\"\nimport { AnalysisStages } from \"./analysis-stages\"\nimport { MessageBubble } from \"./MessageBubble\"\nimport { ChatInput } from \"./ChatInput\"\nimport { EmptyState } from \"./EmptyState\"\nimport { AIStatusIndicator } from \"@/components/ai/AIStatusIndicator\"\nimport { ModelSelector } from \"./ModelSelector\"\nimport { WorkflowVisualizer } from \"./WorkflowVisualizer\"\nimport { useWorkflowVisualizer } from \"@/hooks/useWorkflowVisualizer\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { brandColors, slateColors } from \"@/lib/design-tokens\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport { collapseSidebar, refreshCredits } from \"@/components/app-sidebar\"\nimport { \n  calculatePreviewCost, \n  ModelType, \n  GenMode,\n  MODEL_COSTS,\n  DAILY_FREE_LIMIT,\n  LUXURY_THRESHOLD,\n  getModelDisplayName\n} from \"@/lib/pricing\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuLabel\n} from \"@/components/ui/dropdown-menu\"\n\n// 🔥 品牌深绿色（参考主页标题）\nconst BRAND_GREEN = \"#14532d\"\n\n// --- Supabase 初始化 ---\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\n// --- 类型定义 ---\ntype UploadedFile = { name: string; type: string; size: number; data: string; preview?: string; difyFileId?: string }\ntype Message = { id: string; role: \"user\" | \"assistant\"; content: string }\ntype FileProcessingState = { status: \"idle\" | \"uploading\" | \"processing\" | \"recognizing\" | \"complete\" | \"error\"; progress: number; message: string }\n\n// --- 辅助组件：思考加载器 ---\nconst SimpleBrainLoader = () => (\n  <div className=\"flex items-center gap-3 py-4 px-4 bg-slate-50 rounded-2xl\">\n    <div className={`relative flex h-8 w-8 items-center justify-center rounded-xl bg-[${BRAND_GREEN}]/10`}>\n      <Brain className={`h-5 w-5 text-[${BRAND_GREEN}] animate-pulse`} />\n    </div>\n    <span className=\"text-sm text-slate-500 font-medium animate-pulse\">思考中...</span>\n  </div>\n)\n\n// --- 辅助组件：文本渲染器 ---\nconst InlineText = ({ text }: { text: string }) => {\n  if (!text) return null;\n  const parts = text.split(/(\\*\\*.*?\\*\\*)/g);\n  return (\n    <>\n      {parts.map((part, index) => {\n        if (part.startsWith(\"**\") && part.endsWith(\"**\")) {\n          return <strong key={index} className={`font-semibold text-[${BRAND_GREEN}]`}>{part.slice(2, -2)}</strong>;\n        }\n        return <span key={index}>{part}</span>;\n      })}\n    </>\n  );\n};\n\n// TableBlock 必须在 UltimateRenderer 之前定义\nconst TableBlock = ({ lines }: { lines: string[] }) => {\n  if (lines.length < 2) return null;\n  try {\n    const headerLine = lines.find(l => l.includes(\"|\") && !l.includes(\"---\"));\n    const bodyLines = lines.filter(l => l.includes(\"|\") && !l.includes(\"---\") && l !== headerLine);\n    if (!headerLine) return null;\n    const headers = headerLine.split(\"|\").filter(c => c.trim()).map(c => c.trim());\n    return (\n      <div className=\"my-4 overflow-hidden rounded-xl border border-slate-100 bg-white\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-slate-100\">\n            <thead className=\"bg-slate-50\"><tr>{headers.map((h, i) => (<th key={i} className=\"px-4 py-2.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">{h}</th>))}</tr></thead>\n            <tbody className=\"divide-y divide-slate-50\">{bodyLines.map((line, i) => { const cells = line.split(\"|\").filter(c => c.trim()).map(c => c.trim()); return (<tr key={i} className=\"hover:bg-slate-50/50 transition-colors\">{cells.map((cell, j) => (<td key={j} className=\"px-4 py-2.5 text-sm text-slate-600\"><InlineText text={cell} /></td>))}</tr>); })}</tbody>\n          </table>\n        </div>\n      </div>\n    );\n  } catch (e) { return null; }\n};\n\nfunction UltimateRenderer({ content }: { content: string }) {\n  if (!content) return <span className={`animate-pulse text-[${BRAND_GREEN}]`}>▌</span>;\n  const lines = content.split(\"\\n\");\n  const renderedElements = [];\n  let tableBuffer: string[] = [];\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const isTableLine = line.trim().startsWith(\"|\") && line.includes(\"|\");\n    if (isTableLine) {\n      tableBuffer.push(line);\n      if (i === lines.length - 1 || !lines[i + 1].trim().startsWith(\"|\")) {\n        renderedElements.push(<TableBlock key={`tbl-${i}`} lines={tableBuffer} />);\n        tableBuffer = [];\n      }\n      continue;\n    }\n    if (line.trim().startsWith(\"# \")) {\n      renderedElements.push(<h1 key={i} className=\"mt-8 mb-4 text-xl font-bold text-slate-800\">{line.replace(/^#\\s+/, \"\")}</h1>);\n    } else if (line.trim().startsWith(\"## \")) {\n      renderedElements.push(<h2 key={i} className={`mt-6 mb-3 text-lg font-semibold text-slate-700 flex items-center gap-2`}><span className={`w-1 h-5 bg-[${BRAND_GREEN}] rounded-full`}></span>{line.replace(/^##\\s+/, \"\")}</h2>);\n    } else if (line.trim().startsWith(\"### \")) {\n      renderedElements.push(<h3 key={i} className={`mt-5 mb-2 text-base font-semibold text-[${BRAND_GREEN}]`}>{line.replace(/^###\\s+/, \"\")}</h3>);\n    } else if (line.trim().startsWith(\"- \")) {\n      renderedElements.push(<div key={i} className=\"flex gap-2.5 ml-1 my-2 text-[15px] text-slate-600 leading-relaxed\"><div className={`mt-2 w-1.5 h-1.5 rounded-full bg-[${BRAND_GREEN}]/60 shrink-0`}></div><span><InlineText text={line.replace(/^- /, \"\")} /></span></div>);\n    } else if (line.trim().startsWith(\"> \")) {\n      renderedElements.push(<blockquote key={i} className={`my-4 border-l-2 border-[${BRAND_GREEN}] bg-[${BRAND_GREEN}]/5 px-4 py-3 rounded-r-xl`}><div className=\"text-[15px] text-slate-600 leading-relaxed\"><InlineText text={line.replace(/^> /, \"\")} /></div></blockquote>);\n    } else if (line.trim() === \"---\") {\n      renderedElements.push(<div key={i} className=\"py-4\"><div className=\"h-px bg-slate-100\"></div></div>);\n    } else if (line.trim() === \"\") {\n      renderedElements.push(<div key={i} className=\"h-3\"></div>);\n    } else {\n      renderedElements.push(<p key={i} className=\"text-[15px] leading-[1.8] text-slate-600 my-2\"><InlineText text={line} /></p>);\n    }\n  }\n  return <div className=\"w-full\">{renderedElements}</div>;\n}\n\n// --- 内部聊天核心组件 ---\nfunction ChatInterfaceInner() {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const urlSessionId = searchParams.get(\"id\")\n  const urlAgent = searchParams.get(\"agent\")\n\n  const [userId, setUserId] = useState<string>(\"\")\n  const [userAvatar, setUserAvatar] = useState<string>(\"\")\n  const [userCredits, setUserCredits] = useState<number>(0)\n  const sessionIdRef = useRef<string | null>(null)\n  const [currentSessionId, setCurrentSessionId] = useState<string>(\"\")\n\n  const [selectedModel, setSelectedModel] = useState<ModelType>(\"standard\")\n  const [genMode, setGenMode] = useState<GenMode>(\"text\")\n  \n  const [dailyUsage, setDailyUsage] = useState<number>(0)\n  const DAILY_LIMIT = 20\n\n  const isLuxury = userCredits > 1000 \n\n  // 🎯 工作流可视化 Hook\n  const {\n    workflowState,\n    isProcessing: isWorkflowProcessing,\n    handleSSEEvent,\n    resetWorkflow,\n    toggleExpanded,\n    getSummaryText,\n    markWorkflowComplete\n  } = useWorkflowVisualizer()\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const userStr = localStorage.getItem('currentUser')\n      if (userStr) {\n        try {\n          const user = JSON.parse(userStr)\n          const uid = user.id || user.sub || user.userId || \"\"\n          console.log(\"🔑 [用户初始化] 解析用户:\", { \n            id: user.id, \n            sub: user.sub, \n            userId: user.userId,\n            finalUid: uid \n          })\n          setUserId(uid)\n          if (user.user_metadata?.avatar_url) setUserAvatar(user.user_metadata.avatar_url)\n          if (uid) fetchCredits(uid)\n        } catch (e) {\n          console.error(\"❌ [用户初始化] 解析失败:\", e)\n        }\n      } else {\n        console.warn(\"⚠️ [用户初始化] localStorage 中无 currentUser\")\n      }\n    }\n  }, [])\n\n  const fetchCredits = async (uid: string) => {\n    console.log(\"💰 [积分查询] 查询用户:\", uid)\n    const { data, error } = await supabase.from('user_credits').select('credits').eq('user_id', uid).single()\n    if (error) {\n      console.error(\"❌ [积分查询] 失败:\", error)\n    } else if (data) {\n      console.log(\"✅ [积分查询] 成功:\", data.credits)\n      setUserCredits(data.credits)\n    } else {\n      console.warn(\"⚠️ [积分查询] 无数据\")\n    }\n  }\n\n  useEffect(() => {\n    if (urlSessionId && urlSessionId !== currentSessionId) {\n       loadHistorySession(urlSessionId)\n    }\n  }, [urlSessionId])\n\n  const prevUrlAgentRef = useRef<string | null>(null)\n  \n  useEffect(() => {\n    const agentToModel: Record<string, ModelType> = {\n      \"teaching-pro\": \"teaching-pro\",\n      \"standard\": \"standard\",\n    }\n    \n    const targetModel = urlAgent ? (agentToModel[urlAgent] || \"standard\") : \"standard\"\n    \n    console.log(`🔗 [URL Sync] urlAgent=${urlAgent}, prevUrlAgent=${prevUrlAgentRef.current}, targetModel=${targetModel}`)\n    \n    if (urlAgent !== prevUrlAgentRef.current) {\n      prevUrlAgentRef.current = urlAgent\n      \n      console.log(`🔄 [强制模型同步] → ${targetModel}`)\n      setSelectedModel(targetModel)\n      setGenMode(\"text\")\n      \n      if (!urlSessionId) {\n        setMessages([])\n        sessionIdRef.current = null\n        setCurrentSessionId(\"\")\n      }\n    }\n  }, [urlAgent, urlSessionId])\n\n  const loadHistorySession = async (sid: string) => {\n    setIsLoading(true)\n    setMessages([]) \n    try {\n      const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('session_id', sid)\n        .order('created_at', { ascending: true })\n      \n      if (error) throw error\n\n      if (data && data.length > 0) {\n        const historyMessages = data.map((m: any) => ({\n           id: m.id,\n           role: m.role,\n           content: m.content\n        }))\n        setMessages(historyMessages)\n        setCurrentSessionId(sid)\n        sessionIdRef.current = sid\n      }\n    } catch (e) {\n      console.error(\"加载历史会话失败:\", e)\n      toast.error(\"加载历史会话失败\")\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const [messages, setMessages] = useState<Message[]>([])\n  const [input, setInput] = useState(\"\")\n  const [isLoading, setIsLoading] = useState(false)\n  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([])\n  const [fileProcessing, setFileProcessing] = useState<FileProcessingState>({ status: \"idle\", progress: 0, message: \"\" })\n  const [isComplexMode, setIsComplexMode] = useState(false)\n  const [analysisStage, setAnalysisStage] = useState(0)\n\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n  \n  // 🔥 智能滚动状态\n  const [isNearBottom, setIsNearBottom] = useState(true)\n  const [hasNewMessage, setHasNewMessage] = useState(false)\n\n  // 检测是否在底部附近\n  const handleScroll = () => {\n    if (scrollAreaRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = scrollAreaRef.current\n      const isNear = scrollHeight - scrollTop - clientHeight < 100\n      setIsNearBottom(isNear)\n      if (isNear) setHasNewMessage(false)\n    }\n  }\n\n  // 滚动到底部的函数\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    setHasNewMessage(false)\n  }\n\n  // 新消息时的智能滚动处理\n  useEffect(() => {\n    if (isNearBottom) {\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    } else if (messages.length > 0) {\n      setHasNewMessage(true)\n    }\n  }, [messages, isNearBottom])\n  useEffect(() => { if (isLoading && isComplexMode && analysisStage < 4) setTimeout(() => setAnalysisStage(p => Math.min(p + 1, 4)), 2000) }, [isLoading, analysisStage, isComplexMode])\n\n  // --- 模型配置（增强版：添加描述和标签） ---\n  const modelConfig = {\n    \"standard\": { \n      name: \"作文批改\", \n      icon: Sparkles, \n      color: BRAND_GREEN,\n      description: \"专业作文分析与点评\",\n      badge: \"推荐\",\n      group: \"教育专用\"\n    },\n    \"teaching-pro\": { \n      name: \"教学评助手\", \n      icon: Brain, \n      color: \"#7c3aed\",\n      description: \"教学评估与反馈\",\n      group: \"教育专用\"\n    },\n    \"gpt-5\": { \n      name: \"ChatGPT 5.1\", \n      icon: Bot, \n      color: \"#16a34a\",\n      description: \"通用智能对话\",\n      badge: \"新\",\n      group: \"通用模型\"\n    },\n    \"claude-opus\": { \n      name: \"Claude Opus 4.5\", \n      icon: Bot, \n      color: \"#ea580c\",\n      description: \"深度推理与分析\",\n      group: \"通用模型\"\n    },\n    \"gemini-pro\": { \n      name: \"Gemini 3.0 Pro\", \n      icon: Sparkles, \n      color: \"#2563eb\",\n      description: \"多模态理解\",\n      group: \"通用模型\"\n    },\n    \"banana-2-pro\": { \n      name: \"Banana 2 Pro\", \n      icon: Palette, \n      color: \"#ca8a04\",\n      description: \"AI 图像生成\",\n      badge: \"热门\",\n      group: \"创意生成\"\n    },\n    \"suno-v5\": { \n      name: \"Suno V5\", \n      icon: AudioLines, \n      color: \"#db2777\",\n      description: \"AI 音乐创作\",\n      group: \"创意生成\"\n    },\n    \"sora-2-pro\": { \n      name: \"Sora 2 Pro\", \n      icon: Film, \n      color: \"#4f46e5\",\n      description: \"AI 视频生成\",\n      badge: \"Pro\",\n      group: \"创意生成\"\n    },\n  }\n\n  // 🔥 转换为 ModelSelector 需要的格式\n  const modelList = Object.entries(modelConfig).map(([key, config]) => ({\n    key,\n    name: config.name,\n    icon: config.icon,\n    color: config.color,\n    description: config.description,\n    badge: (config as any).badge,\n    group: config.group\n  }))\n\n  const handleModelChange = (model: ModelType) => {\n    if (model !== selectedModel) {\n      sessionIdRef.current = null\n      setCurrentSessionId(\"\")\n      setMessages([])\n      console.log(`🔄 [模型切换] ${selectedModel} → ${model}，已清除会话`)\n    }\n    \n    if (model !== \"standard\") {\n      if (isLuxury) {\n        toast.success(`已切换至 ${modelConfig[model].name}`)\n      } else {\n        if (dailyUsage < DAILY_LIMIT) {\n          toast.info(`已切换至 ${modelConfig[model].name}`, { description: `今日免费: ${dailyUsage}/${DAILY_LIMIT}` })\n        } else {\n          toast.warning(`今日免费额度已用完`)\n        }\n      }\n    }\n    \n    if (model === \"banana-2-pro\") setGenMode(\"image\")\n    else if (model === \"suno-v5\") setGenMode(\"music\")\n    else if (model === \"sora-2-pro\") setGenMode(\"video\")\n    else setGenMode(\"text\")\n\n    setSelectedModel(model)\n    \n    if (model === \"standard\" || model === \"teaching-pro\") {\n      const newUrl = model === \"standard\" ? '/chat' : `/chat?agent=${model}`\n      console.log(`🔗 [URL 同步] 下拉框切换 → ${newUrl}`)\n      router.push(newUrl, { scroll: false })\n    }\n    \n    if (input === \"\" || input.startsWith(\"生成\")) {\n       setInput(\"\")\n    }\n  }\n\n  const calculateCost = () => {\n    if (!userId) return 0\n    return calculatePreviewCost(selectedModel, {\n      isLuxury,\n      estimatedInputTokens: input.length > 0 ? Math.ceil(input.length / 4) * 2 : undefined\n    })\n  }\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files; \n    if (!files || !files.length) return;\n    \n    // 🔥 检查用户是否已登录\n    if (!userId) {\n      toast.error(\"请先登录后再上传文件\")\n      return\n    }\n    \n    setFileProcessing({ status: \"uploading\", progress: 0, message: \"正在处理...\" })\n    \n    try {\n        const uploadPromises = Array.from(files).map(async (file) => {\n            const fileToUpload = file;\n\n            const formData = new FormData(); \n            formData.append(\"file\", fileToUpload); \n            formData.append(\"user\", userId)\n            \n            // 🔥 添加 X-User-Id header 以通过 middleware 验证\n            const res = await fetch(\"/api/dify-upload\", { \n              method: \"POST\", \n              headers: {\n                \"X-User-Id\": userId\n              },\n              body: formData \n            })\n            \n            if (!res.ok) {\n                const errText = await res.text();\n                throw new Error(`上传失败: ${res.status} ${errText}`);\n            }\n            \n            const data = await res.json()\n            return new Promise<UploadedFile>((resolve) => {\n                if (fileToUpload.type.startsWith(\"image/\")) {\n                    resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: \"\", \n                        difyFileId: data.id, \n                        preview: URL.createObjectURL(fileToUpload) \n                    });\n                } else {\n                    const reader = new FileReader(); \n                    reader.onload = e => resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: e.target?.result as string, \n                        difyFileId: data.id, \n                        preview: undefined \n                    });\n                    reader.readAsDataURL(fileToUpload)\n                }\n            })\n        });\n        \n        const results = await Promise.all(uploadPromises);\n        setUploadedFiles(p => [...p, ...results]);\n        setFileProcessing({ status: \"idle\", progress: 100, message: \"完成\" })\n        setTimeout(() => setFileProcessing({ status: \"idle\", progress: 0, message: \"\" }), 1000)\n    } catch(e: any) {\n        console.error(\"上传错误:\", e);\n        toast.error(\"上传失败\")\n        setFileProcessing({ status: \"error\", progress: 0, message: \"上传失败\" })\n    }\n    if(fileInputRef.current) fileInputRef.current.value=\"\"\n  }\n\n  const removeFile = (i: number) => setUploadedFiles(p => p.filter((_, idx) => idx !== i))\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault(); if (!userId) { toast.error(\"请登录\"); return }\n    const txt = (input || \"\").trim(); if (!txt && !uploadedFiles.length) return\n    \n    console.log(\"📤 [onSubmit] 发送消息:\", {\n      model: selectedModel,\n      mode: genMode,\n      query: txt.slice(0, 50) + \"...\",\n      urlAgent,\n      sessionId: sessionIdRef.current\n    })\n    \n    const cost = calculateCost()\n    if (userCredits < cost) {\n      toast.error(\"积分不足\", { \n        description: `需要 ${cost} 积分，当前 ${userCredits}`,\n        duration: 2000\n      })\n      setTimeout(() => {\n        router.push(\"/pricing\")\n      }, 1500)\n      return\n    }\n\n    setFileProcessing({ status: \"idle\", progress: 0, message: \"\" })\n    setIsLoading(true); setAnalysisStage(0); \n    setIsComplexMode(uploadedFiles.length > 0 || txt.length > 150)\n    \n    // 🎯 重置工作流可视化状态\n    resetWorkflow()\n    \n    // 🔥 自动折叠侧边栏，进入专注模式\n    collapseSidebar()\n    \n    let sid = currentSessionId; \n    if (!sid && !urlSessionId) { \n        sid = Date.now().toString(); \n        setCurrentSessionId(sid);\n        sessionIdRef.current = sid;\n    } else if (urlSessionId) {\n        sid = urlSessionId\n        sessionIdRef.current = urlSessionId\n    }\n\n    const userMsg: Message = { id: Date.now().toString(), role: \"user\", content: txt || \"批改作文\" }\n    setMessages(p => [...p, userMsg]); setInput(\"\"); setUploadedFiles([])\n    \n    const preview = userMsg.content.slice(0, 30)\n    const { data: existing } = await supabase.from('chat_sessions').select('id').eq('id', sid).single()\n    if (!existing) {\n        await supabase.from('chat_sessions').insert({ id: sid, user_id: userId, title: userMsg.content.slice(0, 10)|| \"作文\", preview })\n    } else {\n        await supabase.from('chat_sessions').update({ preview }).eq('id', sid)\n    }\n    await supabase.from('chat_messages').insert({ session_id: sid, role: \"user\", content: userMsg.content })\n\n    const botId = (Date.now()+1).toString(); setMessages(p => [...p, { id: botId, role: \"assistant\", content: \"\" }])\n    \n    let fullText = \"\"; let hasRec = false\n    try {\n        const fileIds = uploadedFiles.map(f => f.difyFileId).filter(Boolean)\n        const res = await fetch(\"/api/dify-chat\", {\n            method: \"POST\", \n            headers: { \n              \"Content-Type\": \"application/json\",\n              \"X-User-Id\": userId\n            },\n            body: JSON.stringify({ \n              query: userMsg.content, \n              fileIds, \n              userId, \n              conversation_id: sessionIdRef.current, \n              model: selectedModel,\n              mode: genMode\n            })\n        })\n        if (res.status === 402) throw new Error(\"积分不足\")\n        if (!res.ok) throw new Error(\"请求失败\")\n        \n        const reader = res.body?.getReader(); \n        const decoder = new TextDecoder();\n        let buffer = \"\"; \n\n        while (true) {\n            const { done, value } = await reader!.read(); \n            if (done) break;\n            \n            buffer += decoder.decode(value, { stream: true });\n            const lines = buffer.split(\"\\n\");\n            buffer = lines.pop() || \"\";\n\n            for (const line of lines) {\n                if (!line.startsWith(\"data: \")) continue\n                const data = line.slice(6).trim(); if (data === \"[DONE]\") continue\n                try {\n                    const json = JSON.parse(data)\n                    \n                    // 🎯 工作流事件处理 - 传递给可视化 Hook\n                    if (json.event) {\n                      handleSSEEvent({\n                        event: json.event,\n                        data: {\n                          node_id: json.node_id,\n                          title: json.title,\n                          status: json.status,\n                          workflow_run_id: json.workflow_run_id\n                        }\n                      })\n                    }\n                    \n                    if (json.conversation_id && sessionIdRef.current !== json.conversation_id) {\n                        sessionIdRef.current = json.conversation_id\n                    }\n                    if (json.answer) {\n                        if (!hasRec) setAnalysisStage(4); hasRec = true; fullText += json.answer\n                        setMessages(p => p.map(m => m.id === botId ? { ...m, content: fullText } : m))\n                    }\n                } catch {}\n            }\n        }\n        if (hasRec) await supabase.from('chat_messages').insert({ session_id: sid, role: \"assistant\", content: fullText })\n        \n        setUserCredits(prev => prev - cost)\n        if (selectedModel !== \"standard\" && !isLuxury && dailyUsage < DAILY_LIMIT) {\n          setDailyUsage(prev => prev + 1)\n        }\n\n    } catch (e: any) {\n        toast.error(e.message || \"出错了\"); setMessages(p => p.filter(m => m.id !== botId))\n    } finally { \n      setIsLoading(false)\n      // 🎯 标记工作流完成\n      markWorkflowComplete()\n      \n      // 🔥 积分刷新：对话结束后触发全局积分刷新\n      console.log(\"🔄 [积分刷新] 对话结束，触发积分重新查询...\")\n      if (userId) {\n        fetchCredits(userId)\n      }\n      // 🔥 触发侧边栏积分刷新\n      refreshCredits()\n      console.log(\"✅ [积分刷新] 已触发全局积分刷新事件\")\n      \n      router.refresh()\n      \n      if (genMode !== \"text\") {\n        setGenMode(\"text\")\n        setSelectedModel(\"standard\")\n      }\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) { e.preventDefault(); onSubmit(e as unknown as React.FormEvent) }\n  }\n\n  // 🔥 返回按钮\n  const handleBack = () => {\n    router.push(\"/\")\n  }\n\n  return (\n    <div className=\"flex h-screen w-full bg-white overflow-hidden relative\">\n      <div className=\"flex flex-1 flex-col h-full relative min-w-0\">\n        \n        {/* 🔥 顶部导航栏 - 移动端和桌面端都显示返回按钮 */}\n        <div className=\"flex items-center h-14 px-4 border-b border-slate-100 bg-white shrink-0\">\n          <button \n            onClick={handleBack}\n            className=\"flex items-center gap-1 text-slate-600 hover:text-slate-800 transition-colors\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n            <span className=\"text-sm font-medium\">返回</span>\n          </button>\n          <div className=\"flex-1 text-center md:text-left md:ml-4\">\n            <span className=\"text-sm font-medium text-slate-700\">{modelConfig[selectedModel].name}</span>\n          </div>\n          <div className=\"w-16 md:hidden\" />\n        </div>\n\n        {/* 🔥 滚动区域优化 */}\n        <div className=\"flex-1 h-0 relative overflow-hidden\">\n          <div \n            ref={scrollAreaRef}\n            onScroll={handleScroll}\n            className=\"h-full overflow-y-auto custom-scrollbar\"\n          >\n            <div className=\"mx-auto max-w-3xl px-4 md:px-6 lg:px-10 py-6 md:py-8\">\n              {messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-12 md:py-16 text-center animate-in fade-in duration-500\">\n                  <div className=\"mb-6 flex h-14 w-14 items-center justify-center rounded-2xl\" style={{ backgroundColor: `${BRAND_GREEN}15` }}>\n                    <GraduationCap className=\"h-7 w-7\" style={{ color: BRAND_GREEN }} />\n                  </div>\n                  <h1 className=\"text-xl font-semibold text-slate-800\">欢迎使用沈翔智学</h1>\n                </div>\n              ) : (\n                <div className=\"space-y-6 pt-4\">\n                  {messages.map((message) => (\n                    <div key={message.id} className={cn(\"flex gap-3\", message.role === \"user\" ? \"justify-end\" : \"justify-start\")}>\n                      {message.role === \"assistant\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl text-white mt-1\" style={{ backgroundColor: BRAND_GREEN }}>\n                          <Sparkles className=\"h-4 w-4\" />\n                        </div>\n                      )}\n                      <div className={cn(\n                        \"relative rounded-2xl px-4 py-3\",\n                        message.role === \"user\" \n                          ? \"text-white max-w-[75%]\" \n                          : \"bg-slate-50 w-full max-w-full\"\n                      )} style={message.role === \"user\" ? { backgroundColor: BRAND_GREEN } : {}}>\n                        {message.role === \"user\" ? (\n                          <div className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{message.content}</div>\n                        ) : (\n                           isLoading && !message.content ? (\n                              isComplexMode ? <AnalysisStages /> : <SimpleBrainLoader />\n                           ) : <UltimateRenderer content={message.content} />\n                        )}\n                        {message.role === \"assistant\" && message.content && (\n                          <div className=\"mt-4 flex items-center justify-end border-t border-slate-100 pt-3\">\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-1.5 text-xs text-slate-400 hover:bg-slate-100\" style={{ ['--hover-color' as any]: BRAND_GREEN }} onClick={() => navigator.clipboard.writeText(message.content).then(() => toast.success(\"已复制\"))}>\n                               <Copy className=\"h-3 w-3\" /> 复制\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                      {message.role === \"user\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-slate-200 mt-1 overflow-hidden\">\n                          {userAvatar ? (\n                            <img src={userAvatar} alt=\"Me\" className=\"h-full w-full object-cover\" />\n                          ) : (\n                            <User className=\"h-4 w-4 text-slate-500\" />\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* 🔥 新消息提示按钮 */}\n          <AnimatePresence>\n            {hasNewMessage && (\n              <motion.button\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                onClick={scrollToBottom}\n                className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 text-white text-sm rounded-full shadow-lg flex items-center gap-2 hover:opacity-90 transition-all\"\n                style={{ backgroundColor: BRAND_GREEN }}\n              >\n                <ArrowDown className=\"w-4 h-4\" />\n                新消息\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* 🔥 输入框区域 */}\n        <div className=\"border-t border-slate-100 bg-white p-3 md:p-6 shrink-0 z-20\">\n          <div className=\"mx-auto max-w-3xl\">\n            {fileProcessing.status !== \"idle\" && (\n              <div className=\"mb-3 rounded-xl bg-slate-50 p-3 animate-in slide-in-from-bottom-2\">\n                <div className=\"flex items-center gap-2\">\n                  {fileProcessing.status === \"error\" ? <AlertCircle className=\"h-4 w-4 text-red-500\" /> : <Loader2 className=\"h-4 w-4 animate-spin\" style={{ color: BRAND_GREEN }} />}\n                  <p className=\"text-sm text-slate-600\">{fileProcessing.message}</p>\n                </div>\n              </div>\n            )}\n            {uploadedFiles.length > 0 && (\n              <div className=\"mb-3 flex flex-wrap gap-2\">\n                {uploadedFiles.map((f, i) => (\n                  <div key={i} className=\"flex items-center gap-2 rounded-lg bg-slate-50 px-3 py-1.5 text-sm\">\n                    <FileText className=\"h-4 w-4\" style={{ color: BRAND_GREEN }} />\n                    <span className=\"max-w-[100px] truncate text-slate-600\">{f.name}</span>\n                    <button onClick={() => removeFile(i)} className=\"text-slate-400 hover:text-red-500\"><X className=\"h-3.5 w-3.5\" /></button>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* 🔥 增强阴影 + 恢复智能体下拉框 */}\n            <form onSubmit={onSubmit} className=\"relative rounded-[24px] bg-white shadow-[0_2px_8px_rgba(0,0,0,0.04),0_8px_24px_rgba(0,0,0,0.08),0_16px_48px_rgba(0,0,0,0.08),0_24px_64px_rgba(0,0,0,0.06),0_32px_80px_rgba(0,0,0,0.04)] border border-slate-100 transition-all duration-300 ease-[cubic-bezier(0.32,0.72,0,1)] focus-within:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_32px_rgba(0,0,0,0.12),0_20px_56px_rgba(0,0,0,0.12),0_28px_72px_rgba(0,0,0,0.08),0_36px_88px_rgba(0,0,0,0.06)]\" style={{ ['--focus-border' as any]: `${BRAND_GREEN}33` }}>\n              \n              {/* 🔥 使用增强版 ModelSelector 组件 */}\n              <div className=\"flex items-center px-3 py-2 border-b border-slate-50\">\n                <ModelSelector\n                  selectedModel={selectedModel}\n                  onModelChange={(model) => handleModelChange(model as ModelType)}\n                  models={modelList}\n                  disabled={isLoading}\n                  dailyFreeInfo={{ used: dailyUsage, total: DAILY_LIMIT }}\n                />\n              </div>\n              \n              <div className=\"flex items-end gap-2 p-3\">\n                {/* 文件上传按钮 */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">文件上传</span>\n                  <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-10 w-10 rounded-xl text-slate-400 hover:bg-slate-50\" onClick={() => fileInputRef.current?.click()} disabled={isLoading}>\n                    <Paperclip className=\"h-5 w-5\" />\n                  </Button>\n                </div>\n                <input ref={fileInputRef} type=\"file\" className=\"hidden\" accept=\"image/*,.txt,.doc,.docx,.pdf\" multiple onChange={handleFileUpload} />\n                \n                <Textarea\n                  ref={textareaRef}\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  placeholder={userId ? \"输入内容开始对话...\" : \"请先登录...\"}\n                  className=\"min-h-[48px] max-h-[160px] flex-1 resize-none border-0 bg-transparent p-2 text-[15px] text-slate-700 placeholder:text-slate-400 focus-visible:ring-0 leading-relaxed\"\n                  disabled={isLoading}\n                  rows={1}\n                />\n                \n                {/* 发送按钮 */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">发送</span>\n                  <Button \n                    type=\"submit\" \n                    size=\"icon\" \n                    className=\"h-10 w-10 rounded-xl text-white shadow-[0_4px_12px_rgba(20,83,45,0.3)] hover:opacity-90 transition-all disabled:opacity-40\"\n                    style={{ backgroundColor: BRAND_GREEN }}\n                    disabled={isLoading || (!input.trim() && uploadedFiles.length === 0)}\n                  >\n                    {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <Send className=\"h-5 w-5\" />}\n                  </Button>\n                </div>\n              </div>\n            </form>\n\n            {!userId && (\n              <p className=\"mt-3 text-center text-xs text-slate-400\">未登录</p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport function EnhancedChatInterface() {\n  return (\n    <Suspense fallback={<div className=\"flex h-screen w-full items-center justify-center bg-white\"><Loader2 className=\"h-6 w-6 animate-spin\" style={{ color: BRAND_GREEN }} /></div>}>\n      <ChatInterfaceInner />\n    </Suspense>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}