{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/ui/textarea.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Textarea({ className, ...props }: React.ComponentProps<'textarea'>) {\n  return (\n    <textarea\n      data-slot=\"textarea\"\n      className={cn(\n        'border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,SAAS,EAAE,SAAS,EAAE,GAAG,OAAyC;IACzE,qBACE,sYAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EACX,ucACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS","debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/analysis-stages.tsx"],"sourcesContent":["\"use client\"\nimport { CheckCircle2, Sparkles } from \"lucide-react\"\nimport { useEffect, useState } from \"react\"\n\ninterface Stage {\n  id: number\n  title: string\n  description: string\n}\n\nconst stages: Stage[] = [\n  {\n    id: 1,\n    title: \"æ–‡æ¡£è§£æ\",\n    description: \"æ­£åœ¨è¯†åˆ«æ–‡å­—å†…å®¹å’Œå›¾ç‰‡ä¿¡æ¯...\",\n  },\n  {\n    id: 2,\n    title: \"æ™ºèƒ½åˆ†æ\",\n    description: \"AIæ­£åœ¨æ·±åº¦ç†è§£æ–‡ç« ç«‹æ„å’Œç»“æ„...\",\n  },\n  {\n    id: 3,\n    title: \"å…¨é¢è¯„ä¼°\",\n    description: \"åˆ†æè¯­è¨€è¡¨è¾¾ã€è®ºè¯é€»è¾‘å’Œåˆ›æ„äº®ç‚¹...\",\n  },\n  {\n    id: 4,\n    title: \"ç”Ÿæˆå»ºè®®\",\n    description: \"æç‚¼ä¼˜ç‚¹å’Œæ”¹è¿›æ–¹å‘ï¼Œæ‰“ç£¨æ‰¹æ”¹æŠ¥å‘Š...\",\n  },\n  {\n    id: 5,\n    title: \"å®Œæˆæ‰¹æ”¹\",\n    description: \"æ‰¹æ”¹æŠ¥å‘Šå·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸ºæ‚¨å‘ˆç°...\",\n  },\n]\n\nexport function AnalysisStages() {\n  const [currentStage, setCurrentStage] = useState(0)\n  const [progress, setProgress] = useState(0)\n\n  useEffect(() => {\n    const stageInterval = setInterval(() => {\n      setCurrentStage((prev) => {\n        if (prev < stages.length - 1) {\n          return prev + 1\n        }\n        return prev\n      })\n    }, 2000)\n\n    const progressInterval = setInterval(() => {\n      setProgress((prev) => {\n        const targetProgress = ((currentStage + 1) / stages.length) * 100\n        if (prev < targetProgress) {\n          return Math.min(prev + 1, 100)\n        }\n        return prev\n      })\n    }, 20)\n\n    return () => {\n      clearInterval(stageInterval)\n      clearInterval(progressInterval)\n    }\n  }, [currentStage])\n\n  return (\n    <div className=\"flex items-center justify-center min-h-[500px] p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"bg-[#f5f1e8] rounded-3xl p-6 shadow-lg border border-amber-200/50\">\n          <div className=\"flex items-start justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-700 to-emerald-900 shadow-md\">\n                <Sparkles className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-bold text-gray-800\">AI æ™ºèƒ½æ‰¹æ”¹è¿›è¡Œä¸­</h3>\n                <p className=\"text-sm text-gray-600\">\n                  é˜¶æ®µ {currentStage + 1} / {stages.length}\n                </p>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-3xl font-bold text-gray-800\">{Math.round(progress)}%</div>\n              <div className=\"text-xs text-gray-600\">å·²å®Œæˆ</div>\n            </div>\n          </div>\n\n          <div className=\"mb-6 h-2 w-full overflow-hidden rounded-full bg-gray-200\">\n            <div\n              className=\"h-full rounded-full bg-gradient-to-r from-green-500 via-yellow-400 to-orange-500 transition-all duration-300 ease-out\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n\n          <div className=\"space-y-3\">\n            {stages.map((stage, index) => {\n              const isCompleted = index < currentStage\n              const isCurrent = index === currentStage\n\n              return (\n                <div\n                  key={stage.id}\n                  className={`flex items-center gap-3 rounded-2xl border p-4 transition-all ${\n                    isCurrent\n                      ? \"border-emerald-300 bg-emerald-50/80 shadow-md\"\n                      : isCompleted\n                        ? \"border-emerald-200 bg-white\"\n                        : \"border-gray-200 bg-white/50\"\n                  }`}\n                >\n                  <div\n                    className={`flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full ${\n                      isCompleted || isCurrent ? \"bg-emerald-700\" : \"bg-gray-300\"\n                    }`}\n                  >\n                    <CheckCircle2 className={`h-5 w-5 ${isCompleted || isCurrent ? \"text-white\" : \"text-gray-500\"}`} />\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"font-semibold text-gray-800\">{stage.title}</div>\n                    <div className=\"text-sm text-gray-600 truncate\">{stage.description}</div>\n                  </div>\n\n                  {isCurrent && (\n                    <div className=\"flex gap-1\">\n                      {[0, 1, 2].map((i) => (\n                        <div\n                          key={i}\n                          className=\"h-2 w-2 rounded-full bg-emerald-700 animate-bounce\"\n                          style={{\n                            animationDelay: `${i * 150}ms`,\n                            animationDuration: \"600ms\",\n                          }}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )\n            })}\n          </div>\n\n          <div className=\"mt-4 flex items-start gap-2 rounded-xl bg-amber-50 px-4 py-3 border border-amber-200\">\n            <span className=\"text-base\">ğŸ’¡</span>\n            <p className=\"text-xs text-gray-600 leading-relaxed\">AI æ­£åœ¨ä¸ºæ‚¨ç²¾å¿ƒæ‰“ç£¨æ‰¹æ”¹æŠ¥å‘Šï¼Œè¯·ç¨å€™ç‰‡åˆ»...</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/ModelSelector.tsx"],"sourcesContent":["/**\n * ğŸ¯ æ²ˆç¿”æ™ºå­¦ - æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶ (Model Selector)\n * \n * é‡æ–°è®¾è®¡çš„AIæ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå•ï¼ŒåŒ…å«æµç•…åŠ¨ç”»å’Œç»Ÿä¸€è§†è§‰é£æ ¼\n */\n\n\"use client\"\n\nimport { useState, useRef, useEffect } from \"react\"\nimport { Check, ChevronDown } from \"lucide-react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\n// ============================================\n// è®¾è®¡ç³»ç»Ÿé¢œè‰²å¸¸é‡\n// ============================================\n\nconst COLORS = {\n  primary: {\n    main: \"#4CAF50\",\n    dark: \"#2E7D32\",\n    light: \"#E8F5E9\",\n    hover: \"rgba(76, 175, 80, 0.08)\",\n  },\n  gray: {\n    50: \"#FAFAFA\",\n    100: \"#F5F5F5\",\n    200: \"#EEEEEE\",\n    300: \"#E0E0E0\",\n    400: \"#BDBDBD\",\n    500: \"#9E9E9E\",\n    600: \"#757575\",\n    700: \"#616161\",\n    800: \"#424242\",\n    900: \"#212121\",\n  },\n  badges: {\n    recommended: { bg: \"#E8F5E9\", text: \"#2E7D32\" },\n    new: { bg: \"#E3F2FD\", text: \"#1976D2\" },\n    hot: { bg: \"#FFF3E0\", text: \"#F57C00\" },\n    pro: { bg: \"#F3E5F5\", text: \"#7B1FA2\" },\n  }\n}\n\n// ============================================\n// ç±»å‹å®šä¹‰\n// ============================================\n\ninterface Model {\n  key: string\n  name: string\n  icon: React.ComponentType<{ className?: string; style?: React.CSSProperties }>\n  color: string\n  description?: string\n  badge?: string\n  group?: string\n}\n\ninterface ModelSelectorProps {\n  selectedModel: string\n  onModelChange: (model: string) => void\n  models: Model[]\n  disabled?: boolean\n  className?: string\n  dailyFreeInfo?: {\n    used: number\n    total: number\n  }\n}\n\n// ============================================\n// Badge ç»„ä»¶\n// ============================================\n\nfunction ModelBadge({ text }: { text: string }) {\n  const getBadgeStyle = (badgeText: string) => {\n    switch (badgeText) {\n      case \"æ¨è\":\n        return { backgroundColor: COLORS.badges.recommended.bg, color: COLORS.badges.recommended.text }\n      case \"æ–°\":\n        return { backgroundColor: COLORS.badges.new.bg, color: COLORS.badges.new.text }\n      case \"çƒ­é—¨\":\n        return { backgroundColor: COLORS.badges.hot.bg, color: COLORS.badges.hot.text }\n      case \"Pro\":\n        return { backgroundColor: COLORS.badges.pro.bg, color: COLORS.badges.pro.text }\n      default:\n        return { backgroundColor: COLORS.gray[100], color: COLORS.gray[600] }\n    }\n  }\n\n  const style = getBadgeStyle(text)\n\n  return (\n    <span \n      className=\"px-2 py-0.5 text-[10px] font-medium rounded-full\"\n      style={style}\n    >\n      {text}\n    </span>\n  )\n}\n\n// ============================================\n// æ¨¡å‹é€‰æ‹©å™¨ä¸»ç»„ä»¶\n// ============================================\n\nexport function ModelSelector({\n  selectedModel,\n  onModelChange,\n  models,\n  disabled,\n  className,\n  dailyFreeInfo\n}: ModelSelectorProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const currentModel = models.find(m => m.key === selectedModel)\n\n  // ç‚¹å‡»å¤–éƒ¨å…³é—­\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false)\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside)\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside)\n  }, [])\n\n  // æŒ‰åˆ†ç»„ç»„ç»‡æ¨¡å‹\n  const groupedModels = models.reduce((acc, model) => {\n    const group = model.group || \"é»˜è®¤\"\n    if (!acc[group]) acc[group] = []\n    acc[group].push(model)\n    return acc\n  }, {} as Record<string, Model[]>)\n\n  const groups = Object.keys(groupedModels)\n\n  const handleSelect = (modelKey: string) => {\n    onModelChange(modelKey)\n    setIsOpen(false)\n  }\n\n  return (\n    <div ref={containerRef} className={cn(\"relative\", className)}>\n      {/* è§¦å‘æŒ‰é’® */}\n      <motion.button\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n        disabled={disabled}\n        className={cn(\n          \"flex items-center gap-2 px-3 py-1.5 rounded-lg\",\n          \"text-sm hover:bg-[#F5F5F5]\",\n          \"transition-all duration-150 ease-out\",\n          \"disabled:opacity-50 disabled:cursor-not-allowed\",\n          \"focus:outline-none\"\n        )}\n        style={{ color: COLORS.gray[700] }}\n        whileTap={{ scale: 0.98 }}\n      >\n        {/* é¢œè‰²æŒ‡ç¤ºç‚¹ */}\n        <span\n          className=\"w-2 h-2 rounded-full shrink-0\"\n          style={{ backgroundColor: currentModel?.color }}\n        />\n        \n        {/* æ¨¡å‹åç§° */}\n        <span className=\"font-medium\">{currentModel?.name || \"é€‰æ‹©æ¨¡å‹\"}</span>\n        \n        {/* ä¸‹æ‹‰ç®­å¤´ */}\n        <motion.div\n          animate={{ rotate: isOpen ? 180 : 0 }}\n          transition={{ duration: 0.2, ease: \"easeOut\" }}\n        >\n          <ChevronDown className=\"w-3.5 h-3.5 opacity-50\" />\n        </motion.div>\n      </motion.button>\n\n      {/* å‘ä¸Šå¼¹å‡ºèœå• */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 8, scale: 0.96 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 8, scale: 0.96 }}\n            transition={{ duration: 0.2, ease: \"easeOut\" }}\n            className=\"absolute bottom-full left-0 mb-2 z-50\"\n            style={{\n              width: \"360px\",\n              maxHeight: \"480px\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 -8px 24px rgba(0,0,0,0.12)\",\n              backgroundColor: \"#FFFFFF\",\n              border: `1px solid ${COLORS.gray[200]}`,\n              overflow: \"hidden\",\n            }}\n          >\n            {/* æ ‡é¢˜å’Œå…è´¹é¢åº¦ä¿¡æ¯ */}\n            <div \n              className=\"flex items-center justify-between px-4 py-3\"\n              style={{ borderBottom: `1px solid ${COLORS.gray[200]}` }}\n            >\n              <span \n                className=\"text-xs font-medium\"\n                style={{ color: COLORS.gray[600] }}\n              >\n                é€‰æ‹©æ¨¡å‹\n              </span>\n              {dailyFreeInfo && (\n                <span \n                  className=\"text-[10px]\"\n                  style={{ color: COLORS.gray[500] }}\n                >\n                  ä»Šæ—¥å…è´¹: {dailyFreeInfo.total - dailyFreeInfo.used}/{dailyFreeInfo.total}\n                </span>\n              )}\n            </div>\n\n            {/* å¯æ»šåŠ¨çš„æ¨¡å‹åˆ—è¡¨ */}\n            <div \n              className=\"overflow-y-auto p-4 custom-scrollbar\"\n              style={{\n                maxHeight: \"420px\",\n              }}\n            >\n\n              {groups.map((group, groupIndex) => (\n                <div key={group}>\n                  {/* åˆ†ç»„æ ‡é¢˜ */}\n                  {group !== \"é»˜è®¤\" && (\n                    <div \n                      className=\"flex items-center gap-2 mb-2\"\n                      style={{ \n                        marginTop: groupIndex > 0 ? \"16px\" : \"0\",\n                      }}\n                    >\n                      {/* å·¦ä¾§å“ç‰Œè‰²æ¡ */}\n                      <div \n                        className=\"w-0.5 h-4 rounded-full\"\n                        style={{ backgroundColor: COLORS.primary.main }}\n                      />\n                      <span \n                        className=\"text-xs font-semibold uppercase\"\n                        style={{ \n                          color: COLORS.gray[600],\n                          letterSpacing: \"0.5px\",\n                        }}\n                      >\n                        {group}\n                      </span>\n                    </div>\n                  )}\n\n                  {/* æ¨¡å‹åˆ—è¡¨ */}\n                  <div className=\"space-y-1\">\n                    {groupedModels[group].map((model) => (\n                      <ModelMenuItem\n                        key={model.key}\n                        model={model}\n                        isSelected={selectedModel === model.key}\n                        onClick={() => handleSelect(model.key)}\n                      />\n                    ))}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n\n// ============================================\n// æ¨¡å‹èœå•é¡¹ç»„ä»¶\n// ============================================\n\nfunction ModelMenuItem({\n  model,\n  isSelected,\n  onClick\n}: {\n  model: Model\n  isSelected: boolean\n  onClick: () => void\n}) {\n  const Icon = model.icon\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 rounded-lg cursor-pointer\",\n        \"transition-all duration-150 ease-out\",\n        \"focus:outline-none\"\n      )}\n      style={{\n        height: \"56px\",\n        padding: \"12px 16px\",\n        backgroundColor: isSelected ? COLORS.primary.hover : \"transparent\",\n      }}\n      whileHover={{ \n        backgroundColor: isSelected ? COLORS.primary.hover : COLORS.gray[100],\n      }}\n      whileTap={{ scale: 0.98 }}\n    >\n      {/* æ¨¡å‹å›¾æ ‡ */}\n      <div \n        className=\"flex h-8 w-8 items-center justify-center rounded-lg shrink-0\"\n        style={{ backgroundColor: `${model.color}15` }}\n      >\n        <Icon \n          className=\"h-4 w-4\" \n          style={{ color: model.color }}\n        />\n      </div>\n\n      {/* æ¨¡å‹ä¿¡æ¯ */}\n      <div className=\"flex-1 min-w-0 text-left\">\n        <div className=\"flex items-center gap-2\">\n          <span \n            className=\"text-sm\"\n            style={{ \n              fontWeight: 500,\n              color: COLORS.gray[900],\n            }}\n          >\n            {model.name}\n          </span>\n          {model.badge && <ModelBadge text={model.badge} />}\n        </div>\n        {model.description && (\n          <p \n            className=\"text-xs truncate mt-0.5\"\n            style={{ \n              fontWeight: 400,\n              color: COLORS.gray[600],\n            }}\n          >\n            {model.description}\n          </p>\n        )}\n      </div>\n\n      {/* é€‰ä¸­å›¾æ ‡ */}\n      {isSelected && (\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ duration: 0.15, ease: \"easeOut\" }}\n        >\n          <Check \n            className=\"w-5 h-5 shrink-0\" \n            style={{ color: COLORS.primary.main }}\n          />\n        </motion.div>\n      )}\n    </motion.button>\n  )\n}\n\nexport default ModelSelector\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;AAID;AACA;AAAA;AACA;AAAA;AACA;;;AALA;;;;;AAOA,+CAA+C;AAC/C,WAAW;AACX,+CAA+C;AAE/C,MAAM,SAAS;IACb,SAAS;QACP,MAAM;QACN,MAAM;QACN,OAAO;QACP,OAAO;IACT;IACA,MAAM;QACJ,IAAI;QACJ,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;IACP;IACA,QAAQ;QACN,aAAa;YAAE,IAAI;YAAW,MAAM;QAAU;QAC9C,KAAK;YAAE,IAAI;YAAW,MAAM;QAAU;QACtC,KAAK;YAAE,IAAI;YAAW,MAAM;QAAU;QACtC,KAAK;YAAE,IAAI;YAAW,MAAM;QAAU;IACxC;AACF;AA4BA,+CAA+C;AAC/C,WAAW;AACX,+CAA+C;AAE/C,SAAS,WAAW,EAAE,IAAI,EAAoB;IAC5C,MAAM,gBAAgB,CAAC;QACrB,OAAQ;YACN,KAAK;gBACH,OAAO;oBAAE,iBAAiB,OAAO,MAAM,CAAC,WAAW,CAAC,EAAE;oBAAE,OAAO,OAAO,MAAM,CAAC,WAAW,CAAC,IAAI;gBAAC;YAChG,KAAK;gBACH,OAAO;oBAAE,iBAAiB,OAAO,MAAM,CAAC,GAAG,CAAC,EAAE;oBAAE,OAAO,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI;gBAAC;YAChF,KAAK;gBACH,OAAO;oBAAE,iBAAiB,OAAO,MAAM,CAAC,GAAG,CAAC,EAAE;oBAAE,OAAO,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI;gBAAC;YAChF,KAAK;gBACH,OAAO;oBAAE,iBAAiB,OAAO,MAAM,CAAC,GAAG,CAAC,EAAE;oBAAE,OAAO,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI;gBAAC;YAChF;gBACE,OAAO;oBAAE,iBAAiB,OAAO,IAAI,CAAC,IAAI;oBAAE,OAAO,OAAO,IAAI,CAAC,IAAI;gBAAC;QACxE;IACF;IAEA,MAAM,QAAQ,cAAc;IAE5B,qBACE,sYAAC;QACC,WAAU;QACV,OAAO;kBAEN;;;;;;AAGP;KA1BS;AAgCF,SAAS,cAAc,EAC5B,aAAa,EACb,aAAa,EACb,MAAM,EACN,QAAQ,EACR,SAAS,EACT,aAAa,EACM;;IACnB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,kXAAQ,EAAC;IACrC,MAAM,eAAe,IAAA,gXAAM,EAAiB;IAC5C,MAAM,eAAe,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,GAAG,KAAK;IAEhD,SAAS;IACT,IAAA,mXAAS;mCAAC;YACR,MAAM;8DAAqB,CAAC;oBAC1B,IAAI,aAAa,OAAO,IAAI,CAAC,aAAa,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBAChF,UAAU;oBACZ;gBACF;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;2CAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;;QACzD;kCAAG,EAAE;IAEL,UAAU;IACV,MAAM,gBAAgB,OAAO,MAAM,CAAC,CAAC,KAAK;QACxC,MAAM,QAAQ,MAAM,KAAK,IAAI;QAC7B,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,MAAM,GAAG,EAAE;QAChC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC;QAChB,OAAO;IACT,GAAG,CAAC;IAEJ,MAAM,SAAS,OAAO,IAAI,CAAC;IAE3B,MAAM,eAAe,CAAC;QACpB,cAAc;QACd,UAAU;IACZ;IAEA,qBACE,sYAAC;QAAI,KAAK;QAAc,WAAW,IAAA,qHAAE,EAAC,YAAY;;0BAEhD,sYAAC,oVAAM,CAAC,MAAM;gBACZ,SAAS,IAAM,CAAC,YAAY,UAAU,CAAC;gBACvC,UAAU;gBACV,WAAW,IAAA,qHAAE,EACX,kDACA,8BACA,wCACA,mDACA;gBAEF,OAAO;oBAAE,OAAO,OAAO,IAAI,CAAC,IAAI;gBAAC;gBACjC,UAAU;oBAAE,OAAO;gBAAK;;kCAGxB,sYAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,iBAAiB,cAAc;wBAAM;;;;;;kCAIhD,sYAAC;wBAAK,WAAU;kCAAe,cAAc,QAAQ;;;;;;kCAGrD,sYAAC,oVAAM,CAAC,GAAG;wBACT,SAAS;4BAAE,QAAQ,SAAS,MAAM;wBAAE;wBACpC,YAAY;4BAAE,UAAU;4BAAK,MAAM;wBAAU;kCAE7C,cAAA,sYAAC,0TAAW;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAK3B,sYAAC,4VAAe;0BACb,wBACC,sYAAC,oVAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;wBAAG,GAAG;wBAAG,OAAO;oBAAK;oBACzC,SAAS;wBAAE,SAAS;wBAAG,GAAG;wBAAG,OAAO;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,GAAG;wBAAG,OAAO;oBAAK;oBACtC,YAAY;wBAAE,UAAU;wBAAK,MAAM;oBAAU;oBAC7C,WAAU;oBACV,OAAO;wBACL,OAAO;wBACP,WAAW;wBACX,cAAc;wBACd,WAAW;wBACX,iBAAiB;wBACjB,QAAQ,CAAC,UAAU,EAAE,OAAO,IAAI,CAAC,IAAI,EAAE;wBACvC,UAAU;oBACZ;;sCAGA,sYAAC;4BACC,WAAU;4BACV,OAAO;gCAAE,cAAc,CAAC,UAAU,EAAE,OAAO,IAAI,CAAC,IAAI,EAAE;4BAAC;;8CAEvD,sYAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO,OAAO,IAAI,CAAC,IAAI;oCAAC;8CAClC;;;;;;gCAGA,+BACC,sYAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO,OAAO,IAAI,CAAC,IAAI;oCAAC;;wCAClC;wCACQ,cAAc,KAAK,GAAG,cAAc,IAAI;wCAAC;wCAAE,cAAc,KAAK;;;;;;;;;;;;;sCAM3E,sYAAC;4BACC,WAAU;4BACV,OAAO;gCACL,WAAW;4BACb;sCAGC,OAAO,GAAG,CAAC,CAAC,OAAO,2BAClB,sYAAC;;wCAEE,UAAU,sBACT,sYAAC;4CACC,WAAU;4CACV,OAAO;gDACL,WAAW,aAAa,IAAI,SAAS;4CACvC;;8DAGA,sYAAC;oDACC,WAAU;oDACV,OAAO;wDAAE,iBAAiB,OAAO,OAAO,CAAC,IAAI;oDAAC;;;;;;8DAEhD,sYAAC;oDACC,WAAU;oDACV,OAAO;wDACL,OAAO,OAAO,IAAI,CAAC,IAAI;wDACvB,eAAe;oDACjB;8DAEC;;;;;;;;;;;;sDAMP,sYAAC;4CAAI,WAAU;sDACZ,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,sBACzB,sYAAC;oDAEC,OAAO;oDACP,YAAY,kBAAkB,MAAM,GAAG;oDACvC,SAAS,IAAM,aAAa,MAAM,GAAG;mDAHhC,MAAM,GAAG;;;;;;;;;;;mCA9BZ;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6C1B;GAtKgB;MAAA;AAwKhB,+CAA+C;AAC/C,UAAU;AACV,+CAA+C;AAE/C,SAAS,cAAc,EACrB,KAAK,EACL,UAAU,EACV,OAAO,EAKR;IACC,MAAM,OAAO,MAAM,IAAI;IAEvB,qBACE,sYAAC,oVAAM,CAAC,MAAM;QACZ,SAAS;QACT,WAAW,IAAA,qHAAE,EACX,4DACA,wCACA;QAEF,OAAO;YACL,QAAQ;YACR,SAAS;YACT,iBAAiB,aAAa,OAAO,OAAO,CAAC,KAAK,GAAG;QACvD;QACA,YAAY;YACV,iBAAiB,aAAa,OAAO,OAAO,CAAC,KAAK,GAAG,OAAO,IAAI,CAAC,IAAI;QACvE;QACA,UAAU;YAAE,OAAO;QAAK;;0BAGxB,sYAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,iBAAiB,GAAG,MAAM,KAAK,CAAC,EAAE,CAAC;gBAAC;0BAE7C,cAAA,sYAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO,MAAM,KAAK;oBAAC;;;;;;;;;;;0BAKhC,sYAAC;gBAAI,WAAU;;kCACb,sYAAC;wBAAI,WAAU;;0CACb,sYAAC;gCACC,WAAU;gCACV,OAAO;oCACL,YAAY;oCACZ,OAAO,OAAO,IAAI,CAAC,IAAI;gCACzB;0CAEC,MAAM,IAAI;;;;;;4BAEZ,MAAM,KAAK,kBAAI,sYAAC;gCAAW,MAAM,MAAM,KAAK;;;;;;;;;;;;oBAE9C,MAAM,WAAW,kBAChB,sYAAC;wBACC,WAAU;wBACV,OAAO;4BACL,YAAY;4BACZ,OAAO,OAAO,IAAI,CAAC,IAAI;wBACzB;kCAEC,MAAM,WAAW;;;;;;;;;;;;YAMvB,4BACC,sYAAC,oVAAM,CAAC,GAAG;gBACT,SAAS;oBAAE,OAAO;gBAAE;gBACpB,SAAS;oBAAE,OAAO;gBAAE;gBACpB,YAAY;oBAAE,UAAU;oBAAM,MAAM;gBAAU;0BAE9C,cAAA,sYAAC,oSAAK;oBACJ,WAAU;oBACV,OAAO;wBAAE,OAAO,OAAO,OAAO,CAAC,IAAI;oBAAC;;;;;;;;;;;;;;;;;AAMhD;MAlFS;uCAoFM","debugId":null}},
    {"offset": {"line": 858, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/pricing.ts"],"sourcesContent":["/**\n * ç»Ÿä¸€è®¡è´¹ä¸­å¿ƒ v2.0\n * \n * è®¡è´¹è§„åˆ™ï¼š\n * - æ™ºèƒ½ä½“ï¼ˆstandard, teaching-proï¼‰ï¼š10 ç§¯åˆ†/1K Token\n * - ç‹¬ç«‹æ¨¡å‹ï¼ˆgpt-5, claude-opus, gemini-pro ç­‰ï¼‰ï¼š20 ç§¯åˆ†/1K Token\n * - å¤šåª’ä½“æ¨¡å‹ï¼šæŒ‰æ¬¡å›ºå®šæ‰£è´¹ï¼ˆæˆæœ¬/0.4ï¼‰\n * \n * æ‰£è´¹æµç¨‹ï¼š\n * - å‰ç«¯ï¼šæ˜¾ç¤º\"é¢„è®¡æ¶ˆè€—\"ï¼ˆåŸºäºä¼°ç®— Token æ•°ï¼‰\n * - åç«¯ï¼šç­‰ Dify å›ç­”å®Œåæ ¹æ®å®é™… Token æ•°é™é»˜ç»“ç®—\n * \n * åˆ©æ¶¦ä¿éšœï¼š\n * - è±ªåä¼šå‘˜ 12,000 ç§¯åˆ†å…¨é¢æ¶ˆè€—æ—¶ï¼ŒVivaAPI æˆæœ¬å æ¯” â‰¤ 40%\n */\n\n// ============================================\n// 1. ç±»å‹å®šä¹‰\n// ============================================\n\nexport type ModelType = \n  | \"standard\" \n  | \"teaching-pro\"\n  | \"gpt-5\" \n  | \"claude-opus\" \n  | \"gemini-pro\" \n  | \"banana-2-pro\" \n  | \"suno-v5\" \n  | \"sora-2-pro\"\n\nexport type GenMode = \"text\" | \"image\" | \"music\" | \"video\"\n\n/** æ¨¡å‹ç±»åˆ«ï¼šæ™ºèƒ½ä½“ vs ç‹¬ç«‹æ¨¡å‹ */\nexport type ModelCategory = \"agent\" | \"standalone\" | \"media\"\n\ninterface ModelCostConfig {\n  /** æ¨¡å‹ç±»åˆ« */\n  category: ModelCategory\n  /** Token å•ä»·ï¼ˆç§¯åˆ†/1K tokensï¼‰ï¼Œä»…æ–‡æœ¬æ¨¡å‹æœ‰æ•ˆ */\n  tokenRate?: number\n  /** å›ºå®šæˆæœ¬ï¼ˆç”¨äºå¤šåª’ä½“æ¨¡å‹ï¼Œå•ä½ï¼šç§¯åˆ†ï¼‰ */\n  fixedCost?: number\n  /** æ¨¡å‹æ˜¾ç¤ºåç§° */\n  displayName: string\n  /** ç”Ÿæˆæ¨¡å¼ */\n  mode: GenMode\n  /** é¢„ä¼°å¹³å‡ Token æ•°ï¼ˆç”¨äºå‰ç«¯é¢„è§ˆï¼‰ */\n  estimatedTokens?: number\n}\n\n// ============================================\n// 2. è®¡è´¹é…ç½®\n// ============================================\n\n/** æ™ºèƒ½ä½“ Token å•ä»·ï¼š10 ç§¯åˆ†/1K Token */\nexport const AGENT_TOKEN_RATE = 10\n\n/** ç‹¬ç«‹æ¨¡å‹ Token å•ä»·ï¼š20 ç§¯åˆ†/1K Token */\nexport const STANDALONE_TOKEN_RATE = 20\n\n/** åˆ©æ¶¦ç‡ç³»æ•°ï¼ˆæˆæœ¬å æ¯” 40%ï¼Œåˆ©æ¶¦ 60%ï¼‰ */\nexport const PROFIT_MARGIN = 0.4\n\n/**\n * å„æ¨¡å‹é…ç½®\n */\nexport const MODEL_COSTS: Record<ModelType, ModelCostConfig> = {\n  // ========== æ™ºèƒ½ä½“ï¼ˆ10 ç§¯åˆ†/1K Tokenï¼‰==========\n  \"standard\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"ä½œæ–‡æ‰¹æ”¹æ™ºèƒ½ä½“\",\n    mode: \"text\",\n    estimatedTokens: 2000  // é¢„ä¼°å¹³å‡ 2K tokens\n  },\n  \"teaching-pro\": { \n    category: \"agent\",\n    tokenRate: AGENT_TOKEN_RATE,\n    displayName: \"æ•™å­¦è¯„æ™ºèƒ½åŠ©æ‰‹\",\n    mode: \"text\",\n    estimatedTokens: 2500  // é¢„ä¼°å¹³å‡ 2.5K tokens\n  },\n  \n  // ========== ç‹¬ç«‹æ¨¡å‹ï¼ˆ20 ç§¯åˆ†/1K Tokenï¼‰==========\n  \"gpt-5\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"ChatGPT 5.1\",\n    mode: \"text\",\n    estimatedTokens: 1500  // é¢„ä¼°å¹³å‡ 1.5K tokens\n  },\n  \"claude-opus\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Claude Opus 4.5\",\n    mode: \"text\",\n    estimatedTokens: 2000  // é¢„ä¼°å¹³å‡ 2K tokens\n  },\n  \"gemini-pro\": { \n    category: \"standalone\",\n    tokenRate: STANDALONE_TOKEN_RATE,\n    displayName: \"Gemini 3.0 Pro\",\n    mode: \"text\",\n    estimatedTokens: 1500  // é¢„ä¼°å¹³å‡ 1.5K tokens\n  },\n  \n  // ========== å¤šåª’ä½“æ¨¡å‹ï¼ˆæŒ‰æ¬¡å›ºå®šæ‰£è´¹ï¼‰==========\n  \"banana-2-pro\": { \n    category: \"media\",\n    fixedCost: 50,  // æˆæœ¬ 50 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 125 ç§¯åˆ†\n    displayName: \"Banana 2 Pro\",\n    mode: \"image\"\n  },\n  \"suno-v5\": { \n    category: \"media\",\n    fixedCost: 100, // æˆæœ¬ 100 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 250 ç§¯åˆ†\n    displayName: \"Suno V5\",\n    mode: \"music\"\n  },\n  \"sora-2-pro\": { \n    category: \"media\",\n    fixedCost: 300, // æˆæœ¬ 300 ç§¯åˆ† â†’ ç”¨æˆ·æ‰£è´¹ 750 ç§¯åˆ†\n    displayName: \"Sora 2 Pro\",\n    mode: \"video\"\n  },\n}\n\n// ============================================\n// 3. è®¡è´¹å‡½æ•°\n// ============================================\n\n/**\n * è®¡ç®—é¢„ä¼°æ¶ˆè€—ï¼ˆå‰ç«¯é¢„è§ˆç”¨ï¼‰\n * \n * @param model - æ¨¡å‹ç±»å‹\n * @param options - å¯é€‰å‚æ•°\n * @returns é¢„ä¼°ç§¯åˆ†æ¶ˆè€—\n */\nexport function calculatePreviewCost(\n  model: ModelType,\n  options?: {\n    isLuxury?: boolean\n    estimatedInputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] æœªçŸ¥æ¨¡å‹: ${model}ï¼Œä½¿ç”¨é»˜è®¤ä»·æ ¼`)\n    return 20\n  }\n  \n  // å¤šåª’ä½“æ¨¡å‹ï¼šå›ºå®šä»·æ ¼\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // æ–‡æœ¬æ¨¡å‹ï¼šåŸºäºé¢„ä¼° Token æ•°è®¡ç®—\n  const estimatedTokens = options?.estimatedInputTokens || config.estimatedTokens || 1500\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // é¢„ä¼°æ¶ˆè€— = Token æ•° / 1000 * å•ä»·\n  const estimatedCost = Math.ceil((estimatedTokens / 1000) * tokenRate)\n  \n  return estimatedCost\n}\n\n/**\n * è®¡ç®—å®é™…æ‰£è´¹é‡‘é¢ï¼ˆåç«¯é™é»˜ç»“ç®—ç”¨ï¼‰\n * \n * @param model - æ¨¡å‹ç±»å‹\n * @param tokenUsage - å®é™… Token ä½¿ç”¨é‡\n * @returns åº”æ‰£ç§¯åˆ†æ•°\n */\nexport function calculateActualCost(\n  model: ModelType,\n  tokenUsage?: {\n    totalTokens?: number\n    inputTokens?: number\n    outputTokens?: number\n  }\n): number {\n  const config = MODEL_COSTS[model]\n  \n  if (!config) {\n    console.warn(`[Pricing] æœªçŸ¥æ¨¡å‹: ${model}ï¼Œä½¿ç”¨é»˜è®¤ä»·æ ¼`)\n    return 20\n  }\n  \n  // å¤šåª’ä½“æ¨¡å‹ï¼šå›ºå®šä»·æ ¼\n  if (config.category === \"media\" && config.fixedCost) {\n    return Math.ceil(config.fixedCost / PROFIT_MARGIN)\n  }\n  \n  // æ–‡æœ¬æ¨¡å‹ï¼šæ ¹æ®å®é™… Token æ•°è®¡è´¹\n  const tokenRate = config.tokenRate || AGENT_TOKEN_RATE\n  \n  // ä¼˜å…ˆä½¿ç”¨ totalTokensï¼Œå¦åˆ™ä½¿ç”¨ input + output\n  let totalTokens = tokenUsage?.totalTokens || 0\n  if (!totalTokens && tokenUsage) {\n    totalTokens = (tokenUsage.inputTokens || 0) + (tokenUsage.outputTokens || 0)\n  }\n  \n  // å¦‚æœæ²¡æœ‰ Token ä¿¡æ¯ï¼Œä½¿ç”¨é¢„ä¼°å€¼\n  if (!totalTokens) {\n    totalTokens = config.estimatedTokens || 1500\n  }\n  \n  // å®é™…æ¶ˆè€— = Token æ•° / 1000 * å•ä»·\n  const actualCost = Math.ceil((totalTokens / 1000) * tokenRate)\n  \n  // æœ€ä½æ¶ˆè´¹ 5 ç§¯åˆ†\n  return Math.max(actualCost, 5)\n}\n\n/**\n * è·å–æ¨¡å‹æ˜¾ç¤ºåç§°\n */\nexport function getModelDisplayName(model: ModelType): string {\n  return MODEL_COSTS[model]?.displayName || model\n}\n\n/**\n * è·å–æ¨¡å‹ç”Ÿæˆæ¨¡å¼\n */\nexport function getModelMode(model: ModelType): GenMode {\n  return MODEL_COSTS[model]?.mode || \"text\"\n}\n\n/**\n * è·å–æ¨¡å‹ç±»åˆ«\n */\nexport function getModelCategory(model: ModelType): ModelCategory {\n  return MODEL_COSTS[model]?.category || \"agent\"\n}\n\n/**\n * è·å–æ¨¡å‹ Token å•ä»·\n */\nexport function getTokenRate(model: ModelType): number {\n  const config = MODEL_COSTS[model]\n  if (!config || config.category === \"media\") return 0\n  return config.tokenRate || AGENT_TOKEN_RATE\n}\n\n// ============================================\n// 4. ä¼šå‘˜é…ç½®\n// ============================================\n\n/** éè±ªåä¼šå‘˜æ¯æ—¥å…è´¹ä½¿ç”¨é«˜çº§æ¨¡å‹æ¬¡æ•° */\nexport const DAILY_FREE_LIMIT = 20\n\n/** è±ªåä¼šå‘˜ç§¯åˆ†é˜ˆå€¼ï¼ˆç§¯åˆ†è¶…è¿‡æ­¤å€¼è§†ä¸ºè±ªåä¼šå‘˜ï¼‰ */\nexport const LUXURY_THRESHOLD = 1000\n\n/** è±ªåä¼šå‘˜å¥—é¤ç§¯åˆ† */\nexport const LUXURY_CREDITS = 12000\n\n// ============================================\n// 5. åˆ©æ¶¦éªŒè¯å‡½æ•°\n// ============================================\n\n/**\n * éªŒè¯è±ªåä¼šå‘˜ç§¯åˆ†æ¶ˆè€—æ—¶çš„æˆæœ¬å æ¯”\n * \n * å‡è®¾è±ªåä¼šå‘˜ 12,000 ç§¯åˆ†å…¨éƒ¨ç”¨äºæ™ºèƒ½ä½“å¯¹è¯ï¼š\n * - ç”¨æˆ·æ¶ˆè€—ï¼š12,000 ç§¯åˆ†\n * - æŒ‰ 10 ç§¯åˆ†/1K Token è®¡ç®—ï¼Œå¯ä½¿ç”¨ 1,200K Tokens\n * - VivaAPI æˆæœ¬ï¼ˆå‡è®¾ 4 ç§¯åˆ†/1K Tokenï¼‰ï¼š4,800 ç§¯åˆ†\n * - æˆæœ¬å æ¯”ï¼š4,800 / 12,000 = 40%\n * \n * @returns æˆæœ¬å æ¯”æ˜¯å¦ â‰¤ 40%\n */\nexport function validateProfitMargin(): boolean {\n  // å‡è®¾ VivaAPI æˆæœ¬ä¸ºç”¨æˆ·ä»·æ ¼çš„ 40%\n  const vivaApiCostRate = PROFIT_MARGIN  // 0.4\n  \n  // æ™ºèƒ½ä½“åœºæ™¯\n  const agentUserRate = AGENT_TOKEN_RATE  // 10 ç§¯åˆ†/1K Token\n  const agentCostRate = agentUserRate * vivaApiCostRate  // 4 ç§¯åˆ†/1K Token\n  \n  // è±ªåä¼šå‘˜å…¨é¢æ¶ˆè€—\n  const totalCredits = LUXURY_CREDITS  // 12,000 ç§¯åˆ†\n  const totalTokens = totalCredits / agentUserRate * 1000  // 1,200,000 Tokens\n  const totalCost = (totalTokens / 1000) * agentCostRate  // 4,800 ç§¯åˆ†\n  \n  const costRatio = totalCost / totalCredits  // 0.4 = 40%\n  \n  console.log(`[åˆ©æ¶¦éªŒè¯] è±ªåä¼šå‘˜ ${totalCredits} ç§¯åˆ†æ¶ˆè€—:`)\n  console.log(`  - å¯ä½¿ç”¨ Token: ${totalTokens.toLocaleString()}`)\n  console.log(`  - VivaAPI æˆæœ¬: ${totalCost} ç§¯åˆ†`)\n  console.log(`  - æˆæœ¬å æ¯”: ${(costRatio * 100).toFixed(1)}%`)\n  \n  return costRatio <= PROFIT_MARGIN\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1057, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/components/chat/enhanced-chat-interface.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { useState, useRef, useEffect, Suspense, useCallback } from \"react\"\nimport { useSearchParams, useRouter } from \"next/navigation\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { \n  Send, Paperclip, X, FileText, Copy, Loader2, Sparkles, User, Brain, AlertCircle, \n  ChevronDown, ChevronLeft, Bot, Film, Palette, AudioLines, ArrowDown, GraduationCap\n} from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { toast } from \"sonner\"\nimport { AnalysisStages } from \"./analysis-stages\"\nimport { MessageBubble } from \"./MessageBubble\"\nimport { ChatInput } from \"./ChatInput\"\nimport { EmptyState } from \"./EmptyState\"\nimport { AIStatusIndicator } from \"@/components/ai/AIStatusIndicator\"\nimport { ModelSelector } from \"./ModelSelector\"\nimport { WorkflowVisualizer } from \"./WorkflowVisualizer\"\nimport { useWorkflowVisualizer } from \"@/hooks/useWorkflowVisualizer\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { brandColors, slateColors } from \"@/lib/design-tokens\"\nimport { createClient } from \"@supabase/supabase-js\"\nimport { collapseSidebar, refreshCredits } from \"@/components/app-sidebar\"\nimport { \n  calculatePreviewCost, \n  ModelType, \n  GenMode,\n  MODEL_COSTS,\n  DAILY_FREE_LIMIT,\n  LUXURY_THRESHOLD,\n  getModelDisplayName\n} from \"@/lib/pricing\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuLabel\n} from \"@/components/ui/dropdown-menu\"\n\n// ğŸ”¥ å“ç‰Œæ·±ç»¿è‰²ï¼ˆå‚è€ƒä¸»é¡µæ ‡é¢˜ï¼‰\nconst BRAND_GREEN = \"#14532d\"\n\n// --- Supabase åˆå§‹åŒ– ---\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n)\n\n// --- ç±»å‹å®šä¹‰ ---\ntype UploadedFile = { name: string; type: string; size: number; data: string; preview?: string; difyFileId?: string }\ntype Message = { id: string; role: \"user\" | \"assistant\"; content: string }\ntype FileProcessingState = { status: \"idle\" | \"uploading\" | \"processing\" | \"recognizing\" | \"complete\" | \"error\"; progress: number; message: string }\n\n// --- è¾…åŠ©ç»„ä»¶ï¼šæ€è€ƒåŠ è½½å™¨ ---\nconst SimpleBrainLoader = () => (\n  <div className=\"flex items-center gap-3 py-4 px-4 bg-slate-50 rounded-2xl\">\n    <div className={`relative flex h-8 w-8 items-center justify-center rounded-xl bg-[${BRAND_GREEN}]/10`}>\n      <Brain className={`h-5 w-5 text-[${BRAND_GREEN}] animate-pulse`} />\n    </div>\n    <span className=\"text-sm text-slate-500 font-medium animate-pulse\">æ€è€ƒä¸­...</span>\n  </div>\n)\n\n// --- è¾…åŠ©ç»„ä»¶ï¼šæ–‡æœ¬æ¸²æŸ“å™¨ ---\nconst InlineText = ({ text }: { text: string }) => {\n  if (!text) return null;\n  const parts = text.split(/(\\*\\*.*?\\*\\*)/g);\n  return (\n    <>\n      {parts.map((part, index) => {\n        if (part.startsWith(\"**\") && part.endsWith(\"**\")) {\n          return <strong key={index} className={`font-semibold text-[${BRAND_GREEN}]`}>{part.slice(2, -2)}</strong>;\n        }\n        return <span key={index}>{part}</span>;\n      })}\n    </>\n  );\n};\n\n// TableBlock å¿…é¡»åœ¨ UltimateRenderer ä¹‹å‰å®šä¹‰\nconst TableBlock = ({ lines }: { lines: string[] }) => {\n  if (lines.length < 2) return null;\n  try {\n    const headerLine = lines.find(l => l.includes(\"|\") && !l.includes(\"---\"));\n    const bodyLines = lines.filter(l => l.includes(\"|\") && !l.includes(\"---\") && l !== headerLine);\n    if (!headerLine) return null;\n    const headers = headerLine.split(\"|\").filter(c => c.trim()).map(c => c.trim());\n    return (\n      <div className=\"my-4 overflow-hidden rounded-xl border border-slate-100 bg-white\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-slate-100\">\n            <thead className=\"bg-slate-50\"><tr>{headers.map((h, i) => (<th key={i} className=\"px-4 py-2.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider\">{h}</th>))}</tr></thead>\n            <tbody className=\"divide-y divide-slate-50\">{bodyLines.map((line, i) => { const cells = line.split(\"|\").filter(c => c.trim()).map(c => c.trim()); return (<tr key={i} className=\"hover:bg-slate-50/50 transition-colors\">{cells.map((cell, j) => (<td key={j} className=\"px-4 py-2.5 text-sm text-slate-600\"><InlineText text={cell} /></td>))}</tr>); })}</tbody>\n          </table>\n        </div>\n      </div>\n    );\n  } catch (e) { return null; }\n};\n\nfunction UltimateRenderer({ content }: { content: string }) {\n  if (!content) return <span className={`animate-pulse text-[${BRAND_GREEN}]`}>â–Œ</span>;\n  const lines = content.split(\"\\n\");\n  const renderedElements = [];\n  let tableBuffer: string[] = [];\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const isTableLine = line.trim().startsWith(\"|\") && line.includes(\"|\");\n    if (isTableLine) {\n      tableBuffer.push(line);\n      if (i === lines.length - 1 || !lines[i + 1].trim().startsWith(\"|\")) {\n        renderedElements.push(<TableBlock key={`tbl-${i}`} lines={tableBuffer} />);\n        tableBuffer = [];\n      }\n      continue;\n    }\n    if (line.trim().startsWith(\"# \")) {\n      renderedElements.push(<h1 key={i} className=\"mt-8 mb-4 text-xl font-bold text-slate-800\">{line.replace(/^#\\s+/, \"\")}</h1>);\n    } else if (line.trim().startsWith(\"## \")) {\n      renderedElements.push(<h2 key={i} className={`mt-6 mb-3 text-lg font-semibold text-slate-700 flex items-center gap-2`}><span className={`w-1 h-5 bg-[${BRAND_GREEN}] rounded-full`}></span>{line.replace(/^##\\s+/, \"\")}</h2>);\n    } else if (line.trim().startsWith(\"### \")) {\n      renderedElements.push(<h3 key={i} className={`mt-5 mb-2 text-base font-semibold text-[${BRAND_GREEN}]`}>{line.replace(/^###\\s+/, \"\")}</h3>);\n    } else if (line.trim().startsWith(\"- \")) {\n      renderedElements.push(<div key={i} className=\"flex gap-2.5 ml-1 my-2 text-[15px] text-slate-600 leading-relaxed\"><div className={`mt-2 w-1.5 h-1.5 rounded-full bg-[${BRAND_GREEN}]/60 shrink-0`}></div><span><InlineText text={line.replace(/^- /, \"\")} /></span></div>);\n    } else if (line.trim().startsWith(\"> \")) {\n      renderedElements.push(<blockquote key={i} className={`my-4 border-l-2 border-[${BRAND_GREEN}] bg-[${BRAND_GREEN}]/5 px-4 py-3 rounded-r-xl`}><div className=\"text-[15px] text-slate-600 leading-relaxed\"><InlineText text={line.replace(/^> /, \"\")} /></div></blockquote>);\n    } else if (line.trim() === \"---\") {\n      renderedElements.push(<div key={i} className=\"py-4\"><div className=\"h-px bg-slate-100\"></div></div>);\n    } else if (line.trim() === \"\") {\n      renderedElements.push(<div key={i} className=\"h-3\"></div>);\n    } else {\n      renderedElements.push(<p key={i} className=\"text-[15px] leading-[1.8] text-slate-600 my-2\"><InlineText text={line} /></p>);\n    }\n  }\n  return <div className=\"w-full\">{renderedElements}</div>;\n}\n\n// --- å†…éƒ¨èŠå¤©æ ¸å¿ƒç»„ä»¶ ---\nfunction ChatInterfaceInner() {\n  const searchParams = useSearchParams()\n  const router = useRouter()\n  const urlSessionId = searchParams.get(\"id\")\n  const urlAgent = searchParams.get(\"agent\")\n\n  const [userId, setUserId] = useState<string>(\"\")\n  const [userAvatar, setUserAvatar] = useState<string>(\"\")\n  const [userCredits, setUserCredits] = useState<number>(0)\n  const sessionIdRef = useRef<string | null>(null)\n  const [currentSessionId, setCurrentSessionId] = useState<string>(\"\")\n\n  const [selectedModel, setSelectedModel] = useState<ModelType>(\"standard\")\n  const [genMode, setGenMode] = useState<GenMode>(\"text\")\n  \n  const [dailyUsage, setDailyUsage] = useState<number>(0)\n  const DAILY_LIMIT = 20\n\n  const isLuxury = userCredits > 1000 \n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const userStr = localStorage.getItem('currentUser')\n      if (userStr) {\n        try {\n          const user = JSON.parse(userStr)\n          const uid = user.id || user.sub || user.userId || \"\"\n          console.log(\"ğŸ”‘ [ç”¨æˆ·åˆå§‹åŒ–] è§£æç”¨æˆ·:\", { \n            id: user.id, \n            sub: user.sub, \n            userId: user.userId,\n            finalUid: uid \n          })\n          setUserId(uid)\n          if (user.user_metadata?.avatar_url) setUserAvatar(user.user_metadata.avatar_url)\n          if (uid) fetchCredits(uid)\n        } catch (e) {\n          console.error(\"âŒ [ç”¨æˆ·åˆå§‹åŒ–] è§£æå¤±è´¥:\", e)\n        }\n      } else {\n        console.warn(\"âš ï¸ [ç”¨æˆ·åˆå§‹åŒ–] localStorage ä¸­æ—  currentUser\")\n      }\n    }\n  }, [])\n\n  const fetchCredits = async (uid: string) => {\n    console.log(\"ğŸ’° [ç§¯åˆ†æŸ¥è¯¢] æŸ¥è¯¢ç”¨æˆ·:\", uid)\n    const { data, error } = await supabase.from('user_credits').select('credits').eq('user_id', uid).single()\n    if (error) {\n      console.error(\"âŒ [ç§¯åˆ†æŸ¥è¯¢] å¤±è´¥:\", error)\n    } else if (data) {\n      console.log(\"âœ… [ç§¯åˆ†æŸ¥è¯¢] æˆåŠŸ:\", data.credits)\n      setUserCredits(data.credits)\n    } else {\n      console.warn(\"âš ï¸ [ç§¯åˆ†æŸ¥è¯¢] æ— æ•°æ®\")\n    }\n  }\n\n  useEffect(() => {\n    if (urlSessionId && urlSessionId !== currentSessionId) {\n       loadHistorySession(urlSessionId)\n    }\n  }, [urlSessionId])\n\n  const prevUrlAgentRef = useRef<string | null>(null)\n  \n  useEffect(() => {\n    const agentToModel: Record<string, ModelType> = {\n      \"teaching-pro\": \"teaching-pro\",\n      \"standard\": \"standard\",\n    }\n    \n    const targetModel = urlAgent ? (agentToModel[urlAgent] || \"standard\") : \"standard\"\n    \n    console.log(`ğŸ”— [URL Sync] urlAgent=${urlAgent}, prevUrlAgent=${prevUrlAgentRef.current}, targetModel=${targetModel}`)\n    \n    if (urlAgent !== prevUrlAgentRef.current) {\n      prevUrlAgentRef.current = urlAgent\n      \n      console.log(`ğŸ”„ [å¼ºåˆ¶æ¨¡å‹åŒæ­¥] â†’ ${targetModel}`)\n      setSelectedModel(targetModel)\n      setGenMode(\"text\")\n      \n      if (!urlSessionId) {\n        setMessages([])\n        sessionIdRef.current = null\n        setCurrentSessionId(\"\")\n      }\n    }\n  }, [urlAgent, urlSessionId])\n\n  const loadHistorySession = async (sid: string) => {\n    setIsLoading(true)\n    setMessages([]) \n    try {\n      const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('session_id', sid)\n        .order('created_at', { ascending: true })\n      \n      if (error) throw error\n\n      if (data && data.length > 0) {\n        const historyMessages = data.map((m: any) => ({\n           id: m.id,\n           role: m.role,\n           content: m.content\n        }))\n        setMessages(historyMessages)\n        setCurrentSessionId(sid)\n        sessionIdRef.current = sid\n      }\n    } catch (e) {\n      console.error(\"åŠ è½½å†å²ä¼šè¯å¤±è´¥:\", e)\n      toast.error(\"åŠ è½½å†å²ä¼šè¯å¤±è´¥\")\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const [messages, setMessages] = useState<Message[]>([])\n  const [input, setInput] = useState(\"\")\n  const [isLoading, setIsLoading] = useState(false)\n  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([])\n  const [fileProcessing, setFileProcessing] = useState<FileProcessingState>({ status: \"idle\", progress: 0, message: \"\" })\n  const [isComplexMode, setIsComplexMode] = useState(false)\n  const [analysisStage, setAnalysisStage] = useState(0)\n\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n  \n  // ğŸ”¥ æ™ºèƒ½æ»šåŠ¨çŠ¶æ€\n  const [isNearBottom, setIsNearBottom] = useState(true)\n  const [hasNewMessage, setHasNewMessage] = useState(false)\n\n  // æ£€æµ‹æ˜¯å¦åœ¨åº•éƒ¨é™„è¿‘\n  const handleScroll = () => {\n    if (scrollAreaRef.current) {\n      const { scrollTop, scrollHeight, clientHeight } = scrollAreaRef.current\n      const isNear = scrollHeight - scrollTop - clientHeight < 100\n      setIsNearBottom(isNear)\n      if (isNear) setHasNewMessage(false)\n    }\n  }\n\n  // æ»šåŠ¨åˆ°åº•éƒ¨çš„å‡½æ•°\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    setHasNewMessage(false)\n  }\n\n  // æ–°æ¶ˆæ¯æ—¶çš„æ™ºèƒ½æ»šåŠ¨å¤„ç†\n  useEffect(() => {\n    if (isNearBottom) {\n      messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" })\n    } else if (messages.length > 0) {\n      setHasNewMessage(true)\n    }\n  }, [messages, isNearBottom])\n  useEffect(() => { if (isLoading && isComplexMode && analysisStage < 4) setTimeout(() => setAnalysisStage(p => Math.min(p + 1, 4)), 2000) }, [isLoading, analysisStage, isComplexMode])\n\n  // --- æ¨¡å‹é…ç½®ï¼ˆå¢å¼ºç‰ˆï¼šæ·»åŠ æè¿°å’Œæ ‡ç­¾ï¼‰ ---\n  const modelConfig = {\n    \"standard\": { \n      name: \"ä½œæ–‡æ‰¹æ”¹\", \n      icon: Sparkles, \n      color: BRAND_GREEN,\n      description: \"ä¸“ä¸šä½œæ–‡åˆ†æä¸ç‚¹è¯„\",\n      badge: \"æ¨è\",\n      group: \"æ•™è‚²ä¸“ç”¨\"\n    },\n    \"teaching-pro\": { \n      name: \"æ•™å­¦è¯„åŠ©æ‰‹\", \n      icon: Brain, \n      color: \"#7c3aed\",\n      description: \"æ•™å­¦è¯„ä¼°ä¸åé¦ˆ\",\n      group: \"æ•™è‚²ä¸“ç”¨\"\n    },\n    \"gpt-5\": { \n      name: \"ChatGPT 5.1\", \n      icon: Bot, \n      color: \"#16a34a\",\n      description: \"é€šç”¨æ™ºèƒ½å¯¹è¯\",\n      badge: \"æ–°\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"claude-opus\": { \n      name: \"Claude Opus 4.5\", \n      icon: Bot, \n      color: \"#ea580c\",\n      description: \"æ·±åº¦æ¨ç†ä¸åˆ†æ\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"gemini-pro\": { \n      name: \"Gemini 3.0 Pro\", \n      icon: Sparkles, \n      color: \"#2563eb\",\n      description: \"å¤šæ¨¡æ€ç†è§£\",\n      group: \"é€šç”¨æ¨¡å‹\"\n    },\n    \"banana-2-pro\": { \n      name: \"Banana 2 Pro\", \n      icon: Palette, \n      color: \"#ca8a04\",\n      description: \"AI å›¾åƒç”Ÿæˆ\",\n      badge: \"çƒ­é—¨\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n    \"suno-v5\": { \n      name: \"Suno V5\", \n      icon: AudioLines, \n      color: \"#db2777\",\n      description: \"AI éŸ³ä¹åˆ›ä½œ\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n    \"sora-2-pro\": { \n      name: \"Sora 2 Pro\", \n      icon: Film, \n      color: \"#4f46e5\",\n      description: \"AI è§†é¢‘ç”Ÿæˆ\",\n      badge: \"Pro\",\n      group: \"åˆ›æ„ç”Ÿæˆ\"\n    },\n  }\n\n  // ğŸ”¥ è½¬æ¢ä¸º ModelSelector éœ€è¦çš„æ ¼å¼\n  const modelList = Object.entries(modelConfig).map(([key, config]) => ({\n    key,\n    name: config.name,\n    icon: config.icon,\n    color: config.color,\n    description: config.description,\n    badge: (config as any).badge,\n    group: config.group\n  }))\n\n  const handleModelChange = (model: ModelType) => {\n    if (model !== selectedModel) {\n      sessionIdRef.current = null\n      setCurrentSessionId(\"\")\n      setMessages([])\n      console.log(`ğŸ”„ [æ¨¡å‹åˆ‡æ¢] ${selectedModel} â†’ ${model}ï¼Œå·²æ¸…é™¤ä¼šè¯`)\n    }\n    \n    if (model !== \"standard\") {\n      if (isLuxury) {\n        toast.success(`å·²åˆ‡æ¢è‡³ ${modelConfig[model].name}`)\n      } else {\n        if (dailyUsage < DAILY_LIMIT) {\n          toast.info(`å·²åˆ‡æ¢è‡³ ${modelConfig[model].name}`, { description: `ä»Šæ—¥å…è´¹: ${dailyUsage}/${DAILY_LIMIT}` })\n        } else {\n          toast.warning(`ä»Šæ—¥å…è´¹é¢åº¦å·²ç”¨å®Œ`)\n        }\n      }\n    }\n    \n    if (model === \"banana-2-pro\") setGenMode(\"image\")\n    else if (model === \"suno-v5\") setGenMode(\"music\")\n    else if (model === \"sora-2-pro\") setGenMode(\"video\")\n    else setGenMode(\"text\")\n\n    setSelectedModel(model)\n    \n    if (model === \"standard\" || model === \"teaching-pro\") {\n      const newUrl = model === \"standard\" ? '/chat' : `/chat?agent=${model}`\n      console.log(`ğŸ”— [URL åŒæ­¥] ä¸‹æ‹‰æ¡†åˆ‡æ¢ â†’ ${newUrl}`)\n      router.push(newUrl, { scroll: false })\n    }\n    \n    if (input === \"\" || input.startsWith(\"ç”Ÿæˆ\")) {\n       setInput(\"\")\n    }\n  }\n\n  const calculateCost = () => {\n    if (!userId) return 0\n    return calculatePreviewCost(selectedModel, {\n      isLuxury,\n      estimatedInputTokens: input.length > 0 ? Math.ceil(input.length / 4) * 2 : undefined\n    })\n  }\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files; \n    if (!files || !files.length) return;\n    \n    // ğŸ”¥ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•\n    if (!userId) {\n      toast.error(\"è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶\")\n      return\n    }\n    \n    setFileProcessing({ status: \"uploading\", progress: 0, message: \"æ­£åœ¨å¤„ç†...\" })\n    \n    try {\n        const uploadPromises = Array.from(files).map(async (file) => {\n            const fileToUpload = file;\n\n            const formData = new FormData(); \n            formData.append(\"file\", fileToUpload); \n            formData.append(\"user\", userId)\n            \n            // ğŸ”¥ æ·»åŠ  X-User-Id header ä»¥é€šè¿‡ middleware éªŒè¯\n            const res = await fetch(\"/api/dify-upload\", { \n              method: \"POST\", \n              headers: {\n                \"X-User-Id\": userId\n              },\n              body: formData \n            })\n            \n            if (!res.ok) {\n                const errText = await res.text();\n                throw new Error(`ä¸Šä¼ å¤±è´¥: ${res.status} ${errText}`);\n            }\n            \n            const data = await res.json()\n            return new Promise<UploadedFile>((resolve) => {\n                if (fileToUpload.type.startsWith(\"image/\")) {\n                    resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: \"\", \n                        difyFileId: data.id, \n                        preview: URL.createObjectURL(fileToUpload) \n                    });\n                } else {\n                    const reader = new FileReader(); \n                    reader.onload = e => resolve({ \n                        name: fileToUpload.name, \n                        type: fileToUpload.type, \n                        size: fileToUpload.size, \n                        data: e.target?.result as string, \n                        difyFileId: data.id, \n                        preview: undefined \n                    });\n                    reader.readAsDataURL(fileToUpload)\n                }\n            })\n        });\n        \n        const results = await Promise.all(uploadPromises);\n        setUploadedFiles(p => [...p, ...results]);\n        setFileProcessing({ status: \"idle\", progress: 100, message: \"å®Œæˆ\" })\n        setTimeout(() => setFileProcessing({ status: \"idle\", progress: 0, message: \"\" }), 1000)\n    } catch(e: any) {\n        console.error(\"ä¸Šä¼ é”™è¯¯:\", e);\n        toast.error(\"ä¸Šä¼ å¤±è´¥\")\n        setFileProcessing({ status: \"error\", progress: 0, message: \"ä¸Šä¼ å¤±è´¥\" })\n    }\n    if(fileInputRef.current) fileInputRef.current.value=\"\"\n  }\n\n  const removeFile = (i: number) => setUploadedFiles(p => p.filter((_, idx) => idx !== i))\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault(); if (!userId) { toast.error(\"è¯·ç™»å½•\"); return }\n    const txt = (input || \"\").trim(); if (!txt && !uploadedFiles.length) return\n    \n    console.log(\"ğŸ“¤ [onSubmit] å‘é€æ¶ˆæ¯:\", {\n      model: selectedModel,\n      mode: genMode,\n      query: txt.slice(0, 50) + \"...\",\n      urlAgent,\n      sessionId: sessionIdRef.current\n    })\n    \n    const cost = calculateCost()\n    if (userCredits < cost) {\n      toast.error(\"ç§¯åˆ†ä¸è¶³\", { \n        description: `éœ€è¦ ${cost} ç§¯åˆ†ï¼Œå½“å‰ ${userCredits}`,\n        duration: 2000\n      })\n      setTimeout(() => {\n        router.push(\"/pricing\")\n      }, 1500)\n      return\n    }\n\n    setFileProcessing({ status: \"idle\", progress: 0, message: \"\" })\n    setIsLoading(true); setAnalysisStage(0); \n    setIsComplexMode(uploadedFiles.length > 0 || txt.length > 150)\n    \n    // ğŸ”¥ è‡ªåŠ¨æŠ˜å ä¾§è¾¹æ ï¼Œè¿›å…¥ä¸“æ³¨æ¨¡å¼\n    collapseSidebar()\n    \n    let sid = currentSessionId; \n    if (!sid && !urlSessionId) { \n        sid = Date.now().toString(); \n        setCurrentSessionId(sid);\n        sessionIdRef.current = sid;\n    } else if (urlSessionId) {\n        sid = urlSessionId\n        sessionIdRef.current = urlSessionId\n    }\n\n    const userMsg: Message = { id: Date.now().toString(), role: \"user\", content: txt || \"æ‰¹æ”¹ä½œæ–‡\" }\n    setMessages(p => [...p, userMsg]); setInput(\"\"); setUploadedFiles([])\n    \n    const preview = userMsg.content.slice(0, 30)\n    const { data: existing } = await supabase.from('chat_sessions').select('id').eq('id', sid).single()\n    if (!existing) {\n        await supabase.from('chat_sessions').insert({ id: sid, user_id: userId, title: userMsg.content.slice(0, 10)|| \"ä½œæ–‡\", preview })\n    } else {\n        await supabase.from('chat_sessions').update({ preview }).eq('id', sid)\n    }\n    await supabase.from('chat_messages').insert({ session_id: sid, role: \"user\", content: userMsg.content })\n\n    const botId = (Date.now()+1).toString(); setMessages(p => [...p, { id: botId, role: \"assistant\", content: \"\" }])\n    \n    let fullText = \"\"; let hasRec = false\n    try {\n        const fileIds = uploadedFiles.map(f => f.difyFileId).filter(Boolean)\n        const res = await fetch(\"/api/dify-chat\", {\n            method: \"POST\", \n            headers: { \n              \"Content-Type\": \"application/json\",\n              \"X-User-Id\": userId\n            },\n            body: JSON.stringify({ \n              query: userMsg.content, \n              fileIds, \n              userId, \n              conversation_id: sessionIdRef.current, \n              model: selectedModel,\n              mode: genMode\n            })\n        })\n        if (res.status === 402) throw new Error(\"ç§¯åˆ†ä¸è¶³\")\n        if (!res.ok) throw new Error(\"è¯·æ±‚å¤±è´¥\")\n        \n        const reader = res.body?.getReader(); \n        const decoder = new TextDecoder();\n        let buffer = \"\"; \n\n        while (true) {\n            const { done, value } = await reader!.read(); \n            if (done) break;\n            \n            buffer += decoder.decode(value, { stream: true });\n            const lines = buffer.split(\"\\n\");\n            buffer = lines.pop() || \"\";\n\n            for (const line of lines) {\n                if (!line.startsWith(\"data: \")) continue\n                const data = line.slice(6).trim(); if (data === \"[DONE]\") continue\n                try {\n                    const json = JSON.parse(data)\n                    if (json.conversation_id && sessionIdRef.current !== json.conversation_id) {\n                        sessionIdRef.current = json.conversation_id\n                    }\n                    if (json.answer) {\n                        if (!hasRec) setAnalysisStage(4); hasRec = true; fullText += json.answer\n                        setMessages(p => p.map(m => m.id === botId ? { ...m, content: fullText } : m))\n                    }\n                } catch {}\n            }\n        }\n        if (hasRec) await supabase.from('chat_messages').insert({ session_id: sid, role: \"assistant\", content: fullText })\n        \n        setUserCredits(prev => prev - cost)\n        if (selectedModel !== \"standard\" && !isLuxury && dailyUsage < DAILY_LIMIT) {\n          setDailyUsage(prev => prev + 1)\n        }\n\n    } catch (e: any) {\n        toast.error(e.message || \"å‡ºé”™äº†\"); setMessages(p => p.filter(m => m.id !== botId))\n    } finally { \n      setIsLoading(false)\n      \n      // ğŸ”¥ ç§¯åˆ†åˆ·æ–°ï¼šå¯¹è¯ç»“æŸåè§¦å‘å…¨å±€ç§¯åˆ†åˆ·æ–°\n      console.log(\"ğŸ”„ [ç§¯åˆ†åˆ·æ–°] å¯¹è¯ç»“æŸï¼Œè§¦å‘ç§¯åˆ†é‡æ–°æŸ¥è¯¢...\")\n      if (userId) {\n        fetchCredits(userId)\n      }\n      // ğŸ”¥ è§¦å‘ä¾§è¾¹æ ç§¯åˆ†åˆ·æ–°\n      refreshCredits()\n      console.log(\"âœ… [ç§¯åˆ†åˆ·æ–°] å·²è§¦å‘å…¨å±€ç§¯åˆ†åˆ·æ–°äº‹ä»¶\")\n      \n      router.refresh()\n      \n      if (genMode !== \"text\") {\n        setGenMode(\"text\")\n        setSelectedModel(\"standard\")\n      }\n    }\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) { e.preventDefault(); onSubmit(e as unknown as React.FormEvent) }\n  }\n\n  // ğŸ”¥ è¿”å›æŒ‰é’®\n  const handleBack = () => {\n    router.push(\"/\")\n  }\n\n  return (\n    <div className=\"flex h-screen w-full bg-white overflow-hidden relative\">\n      <div className=\"flex flex-1 flex-col h-full relative min-w-0\">\n        \n        {/* ğŸ”¥ é¡¶éƒ¨å¯¼èˆªæ  - ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æ˜¾ç¤ºè¿”å›æŒ‰é’® */}\n        <div className=\"flex items-center h-14 px-4 border-b border-slate-100 bg-white shrink-0\">\n          <button \n            onClick={handleBack}\n            className=\"flex items-center gap-1 text-slate-600 hover:text-slate-800 transition-colors\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n            <span className=\"text-sm font-medium\">è¿”å›</span>\n          </button>\n          <div className=\"flex-1 text-center md:text-left md:ml-4\">\n            <span className=\"text-sm font-medium text-slate-700\">{modelConfig[selectedModel].name}</span>\n          </div>\n          <div className=\"w-16 md:hidden\" />\n        </div>\n\n        {/* ğŸ”¥ æ»šåŠ¨åŒºåŸŸä¼˜åŒ– */}\n        <div className=\"flex-1 h-0 relative overflow-hidden\">\n          <div \n            ref={scrollAreaRef}\n            onScroll={handleScroll}\n            className=\"h-full overflow-y-auto custom-scrollbar\"\n          >\n            <div className=\"mx-auto max-w-3xl px-4 md:px-6 lg:px-10 py-6 md:py-8\">\n              {messages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-12 md:py-16 text-center animate-in fade-in duration-500\">\n                  <div className=\"mb-6 flex h-14 w-14 items-center justify-center rounded-2xl\" style={{ backgroundColor: `${BRAND_GREEN}15` }}>\n                    <GraduationCap className=\"h-7 w-7\" style={{ color: BRAND_GREEN }} />\n                  </div>\n                  <h1 className=\"text-xl font-semibold text-slate-800\">æ¬¢è¿ä½¿ç”¨æ²ˆç¿”æ™ºå­¦</h1>\n                </div>\n              ) : (\n                <div className=\"space-y-6 pt-4\">\n                  {messages.map((message) => (\n                    <div key={message.id} className={cn(\"flex gap-3\", message.role === \"user\" ? \"justify-end\" : \"justify-start\")}>\n                      {message.role === \"assistant\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl text-white mt-1\" style={{ backgroundColor: BRAND_GREEN }}>\n                          <Sparkles className=\"h-4 w-4\" />\n                        </div>\n                      )}\n                      <div className={cn(\n                        \"relative rounded-2xl px-4 py-3\",\n                        message.role === \"user\" \n                          ? \"text-white max-w-[75%]\" \n                          : \"bg-slate-50 w-full max-w-full\"\n                      )} style={message.role === \"user\" ? { backgroundColor: BRAND_GREEN } : {}}>\n                        {message.role === \"user\" ? (\n                          <div className=\"whitespace-pre-wrap text-[15px] leading-relaxed\">{message.content}</div>\n                        ) : (\n                           isLoading && !message.content ? (\n                              isComplexMode ? <AnalysisStages /> : <SimpleBrainLoader />\n                           ) : <UltimateRenderer content={message.content} />\n                        )}\n                        {message.role === \"assistant\" && message.content && (\n                          <div className=\"mt-4 flex items-center justify-end border-t border-slate-100 pt-3\">\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-1.5 text-xs text-slate-400 hover:bg-slate-100\" style={{ ['--hover-color' as any]: BRAND_GREEN }} onClick={() => navigator.clipboard.writeText(message.content).then(() => toast.success(\"å·²å¤åˆ¶\"))}>\n                               <Copy className=\"h-3 w-3\" /> å¤åˆ¶\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                      {message.role === \"user\" && (\n                        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-xl bg-slate-200 mt-1 overflow-hidden\">\n                          {userAvatar ? (\n                            <img src={userAvatar} alt=\"Me\" className=\"h-full w-full object-cover\" />\n                          ) : (\n                            <User className=\"h-4 w-4 text-slate-500\" />\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n              )}\n            </div>\n          </div>\n          \n          {/* ğŸ”¥ æ–°æ¶ˆæ¯æç¤ºæŒ‰é’® */}\n          <AnimatePresence>\n            {hasNewMessage && (\n              <motion.button\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: 10 }}\n                onClick={scrollToBottom}\n                className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 text-white text-sm rounded-full shadow-lg flex items-center gap-2 hover:opacity-90 transition-all\"\n                style={{ backgroundColor: BRAND_GREEN }}\n              >\n                <ArrowDown className=\"w-4 h-4\" />\n                æ–°æ¶ˆæ¯\n              </motion.button>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* ğŸ”¥ è¾“å…¥æ¡†åŒºåŸŸ */}\n        <div className=\"border-t border-slate-100 bg-white p-3 md:p-6 shrink-0 z-20\">\n          <div className=\"mx-auto max-w-3xl\">\n            {fileProcessing.status !== \"idle\" && (\n              <div className=\"mb-3 rounded-xl bg-slate-50 p-3 animate-in slide-in-from-bottom-2\">\n                <div className=\"flex items-center gap-2\">\n                  {fileProcessing.status === \"error\" ? <AlertCircle className=\"h-4 w-4 text-red-500\" /> : <Loader2 className=\"h-4 w-4 animate-spin\" style={{ color: BRAND_GREEN }} />}\n                  <p className=\"text-sm text-slate-600\">{fileProcessing.message}</p>\n                </div>\n              </div>\n            )}\n            {uploadedFiles.length > 0 && (\n              <div className=\"mb-3 flex flex-wrap gap-2\">\n                {uploadedFiles.map((f, i) => (\n                  <div key={i} className=\"flex items-center gap-2 rounded-lg bg-slate-50 px-3 py-1.5 text-sm\">\n                    <FileText className=\"h-4 w-4\" style={{ color: BRAND_GREEN }} />\n                    <span className=\"max-w-[100px] truncate text-slate-600\">{f.name}</span>\n                    <button onClick={() => removeFile(i)} className=\"text-slate-400 hover:text-red-500\"><X className=\"h-3.5 w-3.5\" /></button>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* ğŸ”¥ å¢å¼ºé˜´å½± + æ¢å¤æ™ºèƒ½ä½“ä¸‹æ‹‰æ¡† */}\n            <form onSubmit={onSubmit} className=\"relative rounded-[24px] bg-white shadow-[0_2px_8px_rgba(0,0,0,0.04),0_8px_24px_rgba(0,0,0,0.08),0_16px_48px_rgba(0,0,0,0.08),0_24px_64px_rgba(0,0,0,0.06),0_32px_80px_rgba(0,0,0,0.04)] border border-slate-100 transition-all duration-300 ease-[cubic-bezier(0.32,0.72,0,1)] focus-within:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_32px_rgba(0,0,0,0.12),0_20px_56px_rgba(0,0,0,0.12),0_28px_72px_rgba(0,0,0,0.08),0_36px_88px_rgba(0,0,0,0.06)]\" style={{ ['--focus-border' as any]: `${BRAND_GREEN}33` }}>\n              \n              {/* ğŸ”¥ ä½¿ç”¨å¢å¼ºç‰ˆ ModelSelector ç»„ä»¶ */}\n              <div className=\"flex items-center px-3 py-2 border-b border-slate-50\">\n                <ModelSelector\n                  selectedModel={selectedModel}\n                  onModelChange={(model) => handleModelChange(model as ModelType)}\n                  models={modelList}\n                  disabled={isLoading}\n                  dailyFreeInfo={{ used: dailyUsage, total: DAILY_LIMIT }}\n                />\n              </div>\n              \n              <div className=\"flex items-end gap-2 p-3\">\n                {/* æ–‡ä»¶ä¸Šä¼ æŒ‰é’® */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">æ–‡ä»¶ä¸Šä¼ </span>\n                  <Button type=\"button\" variant=\"ghost\" size=\"icon\" className=\"h-10 w-10 rounded-xl text-slate-400 hover:bg-slate-50\" onClick={() => fileInputRef.current?.click()} disabled={isLoading}>\n                    <Paperclip className=\"h-5 w-5\" />\n                  </Button>\n                </div>\n                <input ref={fileInputRef} type=\"file\" className=\"hidden\" accept=\"image/*,.txt,.doc,.docx,.pdf\" multiple onChange={handleFileUpload} />\n                \n                <Textarea\n                  ref={textareaRef}\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  placeholder={userId ? \"è¾“å…¥å†…å®¹å¼€å§‹å¯¹è¯...\" : \"è¯·å…ˆç™»å½•...\"}\n                  className=\"min-h-[48px] max-h-[160px] flex-1 resize-none border-0 bg-transparent p-2 text-[15px] text-slate-700 placeholder:text-slate-400 focus-visible:ring-0 leading-relaxed\"\n                  disabled={isLoading}\n                  rows={1}\n                />\n                \n                {/* å‘é€æŒ‰é’® */}\n                <div className=\"flex flex-col items-center gap-1 shrink-0\">\n                  <span className=\"text-[10px] font-medium text-slate-400\">å‘é€</span>\n                  <Button \n                    type=\"submit\" \n                    size=\"icon\" \n                    className=\"h-10 w-10 rounded-xl text-white shadow-[0_4px_12px_rgba(20,83,45,0.3)] hover:opacity-90 transition-all disabled:opacity-40\"\n                    style={{ backgroundColor: BRAND_GREEN }}\n                    disabled={isLoading || (!input.trim() && uploadedFiles.length === 0)}\n                  >\n                    {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <Send className=\"h-5 w-5\" />}\n                  </Button>\n                </div>\n              </div>\n            </form>\n\n            {!userId && (\n              <p className=\"mt-3 text-center text-xs text-slate-400\">æœªç™»å½•</p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport function EnhancedChatInterface() {\n  return (\n    <Suspense fallback={<div className=\"flex h-screen w-full items-center justify-center bg-white\"><Loader2 className=\"h-6 w-6 animate-spin\" style={{ color: BRAND_GREEN }} /></div>}>\n      <ChatInterfaceInner />\n    </Suspense>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}