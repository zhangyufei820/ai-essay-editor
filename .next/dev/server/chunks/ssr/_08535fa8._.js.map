{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from \"@supabase/ssr\"\n\nexport function createClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    console.warn(\"[v0] Supabase credentials not configured. Auth features will be disabled.\")\n    return null\n  }\n\n  return createBrowserClient(supabaseUrl, supabaseAnonKey)\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACd,MAAM;IACN,MAAM;IAEN;;IAKA,OAAO,IAAA,iMAAmB,EAAC,aAAa;AAC1C","debugId":null}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/aixingren/ai-essay-editor/app/settings/page.tsx"],"sourcesContent":["'use client'\n\nimport React, { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { User, Mail, Sparkles, CreditCard, Save, Loader2 } from 'lucide-react'\nimport { createClient } from '@/lib/supabase/client'\nimport { Toaster, toast } from 'sonner' \n\nexport default function SettingsPage() {\n  const router = useRouter()\n  const [user, setUser] = useState<any>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  \n  // 数据库里的真实数据\n  const [profile, setProfile] = useState<any>(null)\n  const [credits, setCredits] = useState(0)\n  \n  // 表单数据\n  const [nickname, setNickname] = useState('')\n\n  useEffect(() => {\n    // 1. 检查登录状态\n    const userStr = localStorage.getItem('currentUser')\n    if (!userStr) {\n      router.replace('/login')\n      return\n    }\n    const localUser = JSON.parse(userStr)\n    setUser(localUser)\n\n    // 2. 从数据库拉取最新数据\n    const fetchData = async () => {\n      const supabase = createClient()\n      const userId = localUser.id || localUser.sub\n\n      if (supabase && userId) {\n        // A. 获取个人资料 (昵称等)\n        const { data: profileData } = await supabase\n          .from('user_profiles')\n          .select('*')\n          .eq('user_id', userId)\n          .single()\n        \n        if (profileData) {\n          setProfile(profileData)\n          setNickname(profileData.nickname || '')\n        }\n\n        // B. 获取积分\n        const { data: creditData } = await supabase\n          .from('user_credits')\n          .select('credits')\n          .eq('user_id', userId)\n          .single()\n        \n        if (creditData) {\n          setCredits(creditData.credits)\n        }\n      }\n      setLoading(false)\n    }\n\n    fetchData()\n  }, [router])\n\n  // 保存修改\n  const handleSave = async () => {\n    if (!user) return\n    setSaving(true)\n    const supabase = createClient()\n    const userId = user.id || user.sub\n\n    try {\n      // 更新数据库\n      const { error } = await supabase!\n        .from('user_profiles')\n        .update({ nickname: nickname })\n        .eq('user_id', userId)\n\n      if (error) throw error\n\n      // 更新本地缓存\n      const newUser = { ...user, nickname, username: nickname }\n      localStorage.setItem('currentUser', JSON.stringify(newUser))\n      \n      toast.success('保存成功！请刷新页面查看侧边栏变化') \n      window.location.reload()\n      \n    } catch (e) {\n      console.error(e)\n      alert('保存失败，请重试')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex h-screen items-center justify-center bg-gray-50\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex flex-1 flex-col gap-4 p-4 md:p-8 bg-gray-50 min-h-screen\">\n      <Toaster position=\"top-center\" />\n\n      <div className=\"max-w-4xl mx-auto w-full space-y-8\">\n        \n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight text-gray-900\">账号设置</h1>\n          <p className=\"text-gray-500 mt-2\">管理您的个人资料和订阅状态。</p>\n        </div>\n\n        <div className=\"grid gap-8 md:grid-cols-3\">\n          \n          {/* 左侧：个人资料 */}\n          <div className=\"md:col-span-2 space-y-6\">\n            <div className=\"bg-white rounded-xl border shadow-sm overflow-hidden\">\n              <div className=\"p-6 border-b bg-gray-50/50\">\n                <h2 className=\"font-semibold flex items-center gap-2\">\n                  <User className=\"w-4 h-4\" /> 个人资料\n                </h2>\n              </div>\n              <div className=\"p-6 space-y-4\">\n                {/* 头像 */}\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 text-xl font-bold border-2 border-white shadow-sm overflow-hidden\">\n                     {user.photo ? (\n                       <img src={user.photo} alt=\"avatar\" className=\"w-full h-full object-cover\" />\n                     ) : (\n                       (nickname || user.email || 'U').substring(0, 2).toUpperCase()\n                     )}\n                  </div>\n                  <div>\n                    <p className=\"font-medium text-gray-900\">用户头像</p>\n                    <p className=\"text-sm text-gray-500\">头像同步自登录账号</p>\n                  </div>\n                </div>\n\n                {/* 邮箱 */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">注册邮箱</label>\n                  <div className=\"flex items-center gap-2 p-2.5 bg-gray-100 rounded-md border text-gray-500\">\n                    <Mail className=\"w-4 h-4\" />\n                    <span>{user.email}</span>\n                  </div>\n                </div>\n\n                {/* 昵称编辑 */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">显示昵称</label>\n                  <input \n                    type=\"text\" \n                    value={nickname}\n                    onChange={(e) => setNickname(e.target.value)}\n                    placeholder=\"请输入您的昵称\"\n                    className=\"w-full p-2.5 rounded-md border focus:ring-2 focus:ring-black focus:border-black outline-none transition-all\"\n                  />\n                </div>\n\n                <div className=\"pt-2\">\n                  <button \n                    onClick={handleSave}\n                    disabled={saving}\n                    className=\"flex items-center gap-2 bg-black text-white px-4 py-2 rounded-md hover:bg-gray-800 transition-colors text-sm font-medium disabled:opacity-50\"\n                  >\n                    {saving ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                    {saving ? '保存中...' : '保存修改'}\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* 右侧：积分卡片 */}\n          <div className=\"space-y-6\">\n            \n            <div className=\"bg-white rounded-xl border shadow-sm p-6 relative overflow-hidden\">\n              <div className=\"absolute top-0 right-0 w-24 h-24 bg-yellow-100 rounded-full -mr-8 -mt-8 opacity-50 blur-xl\"></div>\n              <h3 className=\"text-sm font-medium text-gray-500 mb-2 flex items-center gap-2\">\n                <Sparkles className=\"w-4 h-4 text-yellow-500\" /> 剩余积分\n              </h3>\n              <div className=\"text-3xl font-bold text-gray-900 mb-4\">\n                {credits} <span className=\"text-sm font-normal text-gray-500\">分</span>\n              </div>\n              <p className=\"text-xs text-gray-400 mb-4\">\n                {/* ✨ 这里修改了文字说明 ✨ */}\n                注册赠送 1000 积分，每次批改消耗 1 积分。\n              </p>\n              <button \n                onClick={() => router.push('/pricing')}\n                className=\"w-full py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-md text-sm font-medium transition-colors\"\n              >\n                立即充值\n              </button>\n            </div>\n\n            <div className=\"bg-white rounded-xl border shadow-sm p-6\">\n              <h3 className=\"text-sm font-medium text-gray-500 mb-2 flex items-center gap-2\">\n                <CreditCard className=\"w-4 h-4\" /> 当前套餐\n              </h3>\n              <div className=\"flex items-center justify-between mb-4\">\n                <span className=\"text-lg font-semibold text-gray-900\">免费版</span>\n                <span className=\"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full\">当前</span>\n              </div>\n              <button \n                onClick={() => router.push('/pricing')}\n                className=\"w-full py-2 border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-md text-sm font-medium transition-colors\"\n              >\n                升级专业版\n              </button>\n            </div>\n\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}"],"names":[],"mappings":"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","debugId":null}}]
}